"use strict";angular.module("msResourceUrlManager",[]),angular.module("msResourceUrlManager").factory("ResourceUrlManager",["$location",function(c){var d,e,f=function(a){var b=e+a.pageId;return a.param1?(b+="/"+a.param1,a.param2?(b+="/"+a.param2,a.param3?(b+="/"+a.param3,a.param4?b+="/"+a.param4:b):b):b):b;};return {setRouteParams:function(a,b){d=a,e=b||"";},getAllParameters:function(){return d;},setUrlParameters:function(a){var b=f(a);c.path(b);},setSearchParameters:function(){}};}]),angular.module("msLayoutManager",[]),angular.module("msLayoutManager").factory("LayoutService",["PageBuilderManager","LayoutServiceArrayHelper","LayoutServiceFactoryHelper","$q","$rootScope",function(j,k,l,i,m){var n=function(c){o(c).then(function(a){if(a){var b=a.element;a.parents.length>1&&(b=a.parents[a.parents.length-2]),k.recalculateWidths(b,12);}m.$broadcast("recalculateWidth");});},o=function(c){var d=i.defer();return j.getCurrentPage().then(function(a){var b=k.searchOnPageForElementAndParents(a,"id",c);d.resolve(b);}),d.promise;},p=function(c,d,e,f){var g=i.defer(),h={type:"page"};return o(c).then(function(a){var b=l.getNewElement(h,e);k.addElementOnArray(a.parents[0].content,a.index,b),t(c,b.content[0].id,!d),g.resolve({success:!0});}),m.$broadcast("markChanges",e.type+" content item has been added."),g.promise;},q=function(d,e){var f=i.defer();return o(d).then(function(a){var b=a.parents[0].content[a.index+1];if(b){var c=k.resizeElement(a.element,b,e);return void f.resolve({size:c});}f.resolve({size:0});}),m.$broadcast("markChanges","content item has been re-sized."),f.promise;},r=function(c,d,e,f){var g=i.defer();return f=f||0,o(c).then(function(a){if(a.parents[0].content.length>=12+f&&"col"===a.element.type)return void g.resolve({success:!1});var b=l.getNewElement(a.parents[0],e);k.addElementOnArray(a.parents[0].content,a.index+(d?1:0),b),"col"!==b.type&&"row"!==b.type||n(a.parents[0].id),g.resolve({success:!0});}),m.$broadcast("markChanges",e.type+" content item has been added."),g.promise;},v=function(d){var e=i.defer();return o(d).then(function(a){if("page"!==a.parents[0].type&&a.parents[0].id&&1===a.parents[0].content.length)v(a.parents[0].id).then(function(){e.resolve();});else{k.deleteElementOnArray(a.parents[0].content,a.index);var b=k.getClosestParent(a,"row");if(k.levelOfNestedRows(a)>1&&1===b.content.length&&1===b.content[0].content.length){var c=a.parents[0].content[0].content[0];t(c.id,b.id,!1);}n(a.parents[0].id),m.$broadcast("markChanges","content item has been deleted."),e.resolve();}}),e.promise;},t=function(e,f,g){var h=i.defer();return o(e).then(function(d){o(f).then(function(b){var c=!1;if(b.parents.length>=2&&d.parents.length>=2){c=d.parents[d.parents.length-2]===b.parents[b.parents.length-2]&&1===d.parents[0].content.length&&3===d.parents.length&&2===b.parents.length;}r(f,g,d.element,c?1:0).then(function(a){a.success&&v(e),h.resolve();});});}),m.$broadcast("markChanges","content item has been moved."),h.promise;},u=function(e,f,g){var h=i.defer();return o(e).then(function(d){o(f).then(function(b){var c=!1;if(b.parents.length>=2&&d.parents.length>=2){c=d.parents[d.parents.length-2]===b.parents[b.parents.length-2]&&1===d.parents[0].content.length&&3===d.parents.length&&2===b.parents.length;}p(f,g,d.element,c?1:0).then(function(a){a.success&&v(e),h.resolve();});});}),m.$broadcast("markChanges","content item has been moved to nested row."),h.promise;};return {getPageData:j.getCurrentPage,getAvailableWidgets:l.getAvailableWidgets,moveElement:t,addElement:r,deleteElement:v,addNestedRow:p,moveToNestedRow:u,resizeElement:q};}]),angular.module("msLayoutManager").factory("LayoutServiceArrayHelper",[function(){var i=function(a){var b=0;if(a.content){var c=0;"col"===a.type&&(c=1);for(var d=0;a.content[d];d++){var e=i(a.content[d]);"col"===a.type?c=Math.max(c,e):c+=e;}b=c;}return b;},m=function(a,b,c){var d=a.size,e=b.size,f=i(a),g=i(b),h=e+d,j=h-g;return c=Math.max(c,f),c=Math.min(c,j),a.size=c,b.size=h-c,n(a,a.size,f),n(b,b.size,g),c;},n=function(a,b,c){if(a){var d=a.content;if(d)if(c||(c=i(a)),"page"===a.type)for(var e=0;d[e];e++)n(d[e],b);else if("row"===a.type)for(var f=Math.floor(b/c),g=b-f*c,h=0;d[h];h++){var j=i(d[h]),k=j*f+Math.min(j,g);g-=Math.min(j,g),d[h].size=k,n(d[h],k,c);}else if("col"===a.type)for(var l=0;d[l];l++)"row"===d[l].type&&n(d[l],b);}},o=function(a,b,c){for(var d=0;a[d];d++){var e=a[d];if(e[b]===c)return {index:d,element:e,parents:[]};if(e.content){var f=o(e.content,b,c);if(f)return f.parents.push(e),f;}}};return {searchOnPageForElementAndParents:function(a,b,c){a.content=a.pagecontentblocks,a.type="page";var d;return d=a.content[0]?o(a.content,b,c):{index:0,element:{type:"row"},parents:[]},d&&d.parents.push(a),d;},addElementOnArray:function(a,b,c){a.splice(b,0,c);},deleteElementOnArray:function(a,b){a.splice(b,1);},recalculateWidths:n,resizeElement:m,levelOfNestedRows:function(a){for(var b=0,c=0;a&&a.parents&&a.parents[c];c++)"row"===a.parents[c].type&&b++;return b;},getClosestParent:function(a,b){for(var c=0;a&&a.parents&&a.parents[c];c++)if(a.parents[c].type===b||!b)return a.parents[c];}};}]),angular.module("msLayoutManager").factory("LayoutServiceFactoryHelper",[function(){var d=function(a){for(var b=e(),c=0;c<b.length;c++)if(b[c].type===a)return b[c].name;},e=function(){return [{name:"Text",icon:"",type:"text"},{name:"Image",icon:"",type:"single-image"},{name:"Gallery",icon:"",type:"slide-show"},{name:"Social links",icon:"",type:"social-link"},{name:"Twitter",icon:"",type:"twitter"},{name:"Contact Form",icon:"",type:"contact-form"},{name:"Map",icon:"",type:"map"},{name:"Embed",icon:"",type:"html"},{name:"Spacer",icon:"",type:"spacer"},{name:"Video",icon:"",type:"video"},{name:"Divider",icon:"",type:"divider"},{name:"File",icon:"",type:"downloadable-file"}];},f=function(a){return {id:h(),type:"col",size:12,content:[a]};},g=function(a){return {id:h(),type:"row",size:12,content:[f(a)]};},h=function(){return "id-"+(new Date).getTime()+Math.floor(1e5*Math.random());};return {getNewElement:function(a,b){return b=angular.copy(b)||{},b.id=h(),"page"===a.type?g(b):"row"===a.type?f(b):b;},getAvailableWidgets:e,getWidgetByType:d};}]),angular.module("msContentItemsControls",["msLayoutManager"]),angular.module("msContentItemsControls").directive("msContentItemControls",["LayoutService","$compile",function(h,j){return {scope:{actions:"="},restrict:"A",link:function(c,d,e){var f=c.actions.controls||[],g=angular.element('<div class="element-controls ms-tools"></div>');c.deleteElem=function(){var a=d.attr("data-id");h.deleteElement(a);},f.forEach(function(a){var b=angular.element("<div></div>");if(b.attr("class","element-control has-tooltip "+a),"delete icon-delete"===a)b.attr("ng-click","deleteElem()"),b.attr("ms-tooltip",""),b.attr("tooltip-content","Delete");else if("handle icon-drag"===a)b.attr("ms-tooltip",""),b.attr("tooltip-content","Click and drag to move");else{if("settings icon-settings"!==a||!c.actions.displaySettings)return ;b.attr("ng-click","actions.displaySettings()"),b.attr("ms-tooltip",""),b.attr("tooltip-content","Settings");}g.append(b);}),j(g)(c,function(a){d.append(a);});}};}]),angular.module("msContentItemSocialShare",[]),angular.module("msContentItemSocialShare").directive("msContentItemSocialShare",["$compile",function(e){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){var d="";angular.forEach(b.contentItemData.settings,function(a){!0!==a.selected&&"true"!==a.selected||(d+='<a class="addthis_button_'+a.name+'"></a>');}),e('<div class="addthis_toolbox">'+d+'</div><script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-53f1bcdd17460bb8"><\/script>')(b,function(a){c.html(a);});}};}]),angular.module("msContentItemSocialShare").directive("msContentItemSocialShareEdit",["$compile","$timeout","$sce",function(m,n,o){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(c,d){var e=[{name:"facebook",selected:!0},{name:"twitter",selected:!0},{name:"pinterest",selected:!0},{name:"linkedin",selected:!0}];c.contentItemData.settings&&0!==c.contentItemData.settings.length||(c.contentItemData.settings=e);var f='<a class="addthis_button_facebook at300b" title="Facebook" href="98a9ac14.scripts.js#"><span class="at16nc at300bs at15nc at15t_facebook at16t_facebook"><span class="at_a11y">Share on facebook</span></span></a>',g='<a class="addthis_button_twitter at300b" title="Tweet" href="98a9ac14.scripts.js#"><span class="at16nc at300bs at15nc at15t_twitter at16t_twitter"><span class="at_a11y">Share on twitter</span></span></a>',h='<a class="addthis_button_pinterest at300b"><span class="at_PinItButton"></span></a>',j='<a class="addthis_button_linkedin at300b" href="http://www.addthis.com/bookmark.php?v=300&amp;winname=addthis&amp;pub=ra-53f1bcdd17460bb8&amp;source=tbx-300&amp;lng=en-US&amp;s=linkedin&amp;url=http%3A%2F%2F127.0.0.1%3A9000%2F%23%2FpageBuilder%2Fhome&amp;title=MrSite&amp;ate=AT-ra-53f1bcdd17460bb8/-/-/53f2117ce3042404/3&amp;frommenu=1&amp;uid=53f2117c65916aa6&amp;ct=1&amp;uct=1&amp;tt=0&amp;captcha_provider=nucaptcha" target="_blank" title="LinkedIn"><span class="at16nc at300bs at15nc at15t_linkedin at16t_linkedin"><span class="at_a11y">Share on linkedin</span></span></a>',k="",l=function(){var b="";angular.forEach(c.contentItemData.settings,function(a){"facebook"!==a.name||!0!==a.selected&&"true"!==a.selected||(b+=f),"twitter"!==a.name||!0!==a.selected&&"true"!==a.selected||(b+=g),"pinterest"!==a.name||!0!==a.selected&&"true"!==a.selected||(b+=h),"linkedin"!==a.name||!0!==a.selected&&"true"!==a.selected||(b+=j);}),k='<div class="addthis_toolbox">'+b+'<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-53f1bcdd17460bb8"><\/script></div>';},i=function(){l(),m(k)(c,function(a){d.html(a);});};c.$watch("contentItemData.settings",i,!0);}};}]),angular.module("msContentItemSocialShare").directive("msContentItemSocialShareSettings",["$compile","$sce","$timeout",function(e,f,g){return {restrict:"A",replace:!0,scope:{settings:"="},link:function(b,c){var d=[{name:"facebook",selected:!0},{name:"twitter",selected:!0},{name:"pinterest",selected:!0},{name:"linkedin",selected:!0}];b.settings&&b.settings.length||(b.settings=d),e('<label for="{{setting.name}}" ng-repeat="setting in settings">{{setting.name}}<input type="text" id="{{setting.name}}" value="{{setting.name}}" ng-model="setting.selected"></label>')(b,function(a){c.html(a);});}};}]),angular.module("msContentItemSocialLink",[]),function(f,g,h,j,k){function l(a,b){if(b){var c=b.getAttribute("viewBox"),d=f.createDocumentFragment(),e=b.cloneNode(!0);for(c&&a.setAttribute("viewBox",c);e.childNodes.length;)d.appendChild(e.childNodes[0]);a.appendChild(d);}}function i(){var b=f.createElement("x"),c=this.s;b.innerHTML=this.responseText,this.onload=function(){c.splice(0).map(function(a){l(a[0],b.querySelector("#"+a[1].replace(/(\W)/g,"\\$1")));});},this.onload();}function m(){for(var a;a=g[0];){var b=a.parentNode,c=a.getAttribute("xlink:href").split("#"),d=c[0],c=c[1];b.removeChild(a),d.length?(a=j[d]=j[d]||new XMLHttpRequest,a.s||(a.s=[],a.open("GET",d),a.onload=i,a.send()),a.s.push([b,c]),4===a.readyState&&a.onload()):l(b,f.getElementById(c));}h(m);}k&&m();}(document,document.getElementsByTagName("use"),window.requestAnimationFrame||window.setTimeout,{},/Trident\/[567]\b/.test(navigator.userAgent)||537>(navigator.userAgent.match(/AppleWebKit\/(\d+)/)||[])[1]),angular.module("msContentItemSocialLink").directive("msContentItemSocialLink",["$compile","$window","SiteRepository","Config",function(g,h,j,k){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(d,e){d.openSettings=d.$parent.actions.displaySettings,d.socialLinks=d.socialLinks||[],j.getSiteSettings().then(function(a){9===a.socialLinks.length&&a.socialLinks.push({name:"youtube",url:""}),d.contentItemData.settings.socialLinks=a.socialLinks;}),d.contentItemData.settings.selectedStyle.id=d.contentItemData.settings.selectedStyle.name.replace(" ","-").toLowerCase(),d.contentItemData.settings.selectedColor.id=d.contentItemData.settings.selectedColor.name.toLowerCase();var f=function(){d.socialLinks=[],angular.forEach(d.contentItemData.settings.socialLinks,function(a){var b="";""!==a.url&&("facebook"===a.name&&(b="//www.facebook.com/"+a.url),"twitter"===a.name&&(b="//www.twitter.com/"+a.url),"pinterest"===a.name&&(b="//www.pinterest.com/"+a.url),"googleplus"===a.name&&(b="//plus.google.com/"+a.url+"/posts"),"instagram"===a.name&&(b="//www.instagram.com/"+a.url),"linkedin"===a.name&&(b="//linkedin.com/"+a.url),"tumblr"===a.name&&(b="//"+a.url+".tumblr.com/"),"flickr"===a.name&&(b="//flickr.com/photos/"+a.url),"email"===a.name&&(b="mailto:"+a.url),"youtube"===a.name&&(b="//www.youtube.com/"+a.url),d.socialLinks.push({name:a.name,url:b}));});var c='<div class="ms-no-settings ms-tools"><button class="ms-button primary" ng-click="openSettings()">Add your Social Links</button>';d.svgUrl=function(a,b){return b?k.GetEndPoint("modulesDirectory")+"/msContentItemSocialLink/sprites.svg#"+a+"-mask":k.GetEndPoint("modulesDirectory")+"/msContentItemSocialLink/sprites.svg#"+a;},d.socialLinks.length>0&&(c='<ul class="{{\'icon-shape-\' + contentItemData.settings.selectedStyle.shape}} {{\'icon-color-\' + contentItemData.settings.selectedColor.id}}" ng-class="{\'icon-style-mask\': contentItemData.settings.selectedStyle.mask}"><li ng-repeat="(name, setting) in socialLinks" class="social-icon {{setting.name}}"><span ng-click="open(setting.url)" ><svg role="img" class="ms-svg-icon" viewBox="0 0 64 64"><use class="ms-use-icon standard" xlink:href="{{svgUrl(setting.name)}}"></use><use class="ms-use-icon mask" xlink:href="{{svgUrl(setting.name, true)}}"></use></svg></span></li></ul>'),g(c)(d,function(a){e.html(a);});};d.open=function(a){h.open(a);},f();}};}]),angular.module("msContentItemSocialLink").directive("msContentItemSocialLinkEdit",["$compile","$timeout","$sce","$window","SiteRepository","Config",function(g,h,j,k,l,i){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(d,e){d.openSettings=d.$parent.actions.displaySettings,d.socialLinks=d.socialLinks||[],9===d.socialLinks.length&&d.socialLinks.push({name:"youtube",url:""}),l.getSiteSettings().then(function(a){9===a.socialLinks.length&&a.socialLinks.push({name:"youtube",url:""}),d.contentItemData.settings.socialLinks=a.socialLinks;}),d.contentItemData.settings.selectedStyle||(d.contentItemData.settings.selectedStyle={id:"standard",name:"Standard",shape:"standard",mask:!1}),d.contentItemData.settings.selectedColor||(d.contentItemData.settings.selectedColor={id:"dark",name:"Dark"});var f=function(){d.socialLinks=[],angular.forEach(d.contentItemData.settings.socialLinks,function(a){var b="";""!==a.url&&("facebook"===a.name&&(b="//www.facebook.com/"+a.url),"twitter"===a.name&&(b="//www.twitter.com/"+a.url),"pinterest"===a.name&&(b="//www.pinterest.com/"+a.url),"googleplus"===a.name&&(b="//plus.google.com/"+a.url+"/posts"),"instagram"===a.name&&(b="//www.instagram.com/"+a.url),"linkedin"===a.name&&(b="//linkedin.com/"+a.url),"tumblr"===a.name&&(b="//"+a.url+".tumblr.com/"),"flickr"===a.name&&(b="//flickr.com/photos/"+a.url),"email"===a.name&&(b="mailto:"+a.url),"youtube"===a.name&&(b="//www.youtube.com/"+a.url),d.socialLinks.push({name:a.name,url:b}));});var c='<div class="ms-no-settings ms-tools"><button class="ms-button primary" ng-click="openSettings()">Add your Social Links</button>';d.svgUrl=function(a,b){return b?i.GetEndPoint("modulesDirectory")+"/msContentItemSocialLink/sprites.svg#"+a+"-mask":i.GetEndPoint("modulesDirectory")+"/msContentItemSocialLink/sprites.svg#"+a;},d.socialLinks.length>0&&(c='<ul class="{{\'icon-shape-\' + contentItemData.settings.selectedStyle.shape}} {{\'icon-color-\' + contentItemData.settings.selectedColor.id}}" ng-class="{\'icon-style-mask\': contentItemData.settings.selectedStyle.mask}"><li ng-repeat="(name, setting) in socialLinks" class="social-icon {{setting.name}}"><span ng-click="open(setting.url)" ><svg role="img" class="ms-svg-icon" viewBox="0 0 64 64"><use class="ms-use-icon standard" xlink:href="{{svgUrl(setting.name)}}"></use><use class="ms-use-icon mask" xlink:href="{{svgUrl(setting.name, true)}}"></use></svg></span></li></ul>'),g(c)(d,function(a){e.html(a);});};d.open=function(a){k.open(a);},d.$watch("contentItemData.settings",f,!0);}};}]),angular.module("msContentItemSocialLink").directive("msContentItemSocialLinkSettings",["$compile","$sce","$timeout","SiteRepository","$rootScope","Config",function(j,k,l,i,m,n){return {restrict:"A",replace:!0,scope:{settings:"="},templateUrl:n.GetSessionStoredValue("modulesDirectory")+"/msContentItemSocialLink/SocialLinkSettings.html",link:function(d,e){d.settings=d.settings||{},d.socialIconStyles=[{id:"standard",name:"Standard",shape:"standard",mask:!1},{id:"square",name:"Square",shape:"square",mask:!1},{id:"square-mask",name:"Square Mask",shape:"square",mask:!0},{id:"circle",name:"Circle",shape:"circle",mask:!1},{id:"circle-mask",name:"Circle Mask",shape:"circle",mask:!0}],d.socialIconColors=[{id:"dark",name:"Dark"},{id:"light",name:"Light"},{id:"standard",name:"Standard"}];var f=function(){if(!d.settings.selectedStyle&&d.$parent.contentItemData.settings.selectedStyle)for(var a=0;a<d.socialIconStyles.length;a++)if(d.socialIconStyles[a].id===d.$parent.contentItemData.settings.selectedStyle.id){d.settings.selectedStyle=d.socialIconStyles[a];break;}},g=function(){if(!d.settings.selectedColor&&d.$parent.contentItemData.settings.selectedColor)for(var a=0;a<d.socialIconColors.length;a++)if(d.socialIconColors[a].id===d.$parent.contentItemData.settings.selectedColor.id){d.settings.selectedColor=d.socialIconColors[a];break;}},h=function(){d.$parent.contentItemData&&d.$parent.contentItemData.settings&&(f(),g());};(function(){i.getSiteSettings().then(function(a){9===a.socialLinks.length&&a.socialLinks.push({name:"youtube",url:""}),d.settings=a,h(),d.settings.selectedStyle=d.settings.selectedStyle||d.socialIconStyles[0],d.settings.selectedColor=d.settings.selectedColor||d.socialIconColors[0];});})(),d.$watch("settings.selectedStyle",function(a,b){d.settings.selectedStyle=a;}),d.$watch("settings",function(b,c){c!==b&&(m.$broadcast("markChanges","social link settings has been changed."),i.updateSiteSettings(d.settings).then(function(a){}));},!0);}};}]),angular.module("msConfig",[]),angular.module("msConfig").factory("Config",["$http","$window","$location","ConfigConstants","$sessionStorage",function(c,d,e,f,g){angular.forEach(f,function(a,b){g.put(b,a);});var h=function(a){return g.get(a);};return {GetEndPoint:function(a){return f[a]||h(a);},GetSessionStoredValue:h};}]),angular.module("msRestangular",["restangular","msConfig"]).config(["RestangularProvider",function(a){a.setDefaultHttpFields({cache:!1});}]),angular.module("msRestangular").factory("ApiRestangular",["Restangular","Config",function(b,c){return b.withConfig(function(a){a.setBaseUrl(c.GetEndPoint("apiEndpoint")+"shops/");});}]),angular.module("msRestangular").factory("BaseApiRestangular",["Restangular","Config",function(b,c){return b.withConfig(function(a){a.setBaseUrl(c.GetEndPoint("apiEndpoint")+"shops/");});}]),angular.module("msRestangular").factory("AppRestangular",["Restangular",function(b){return b.withConfig(function(a){a.setBaseUrl("/");});}]),angular.module("msRestangular").factory("BlogRestangular",["Restangular","Config","$window","$rootScope","$q","RestangularManager",function(i,m,n,o,p,q){return i.withConfig(function(h){var j=p.defer(),k=!1;q.init(h),h.addFullRequestInterceptor(function(a,b,c,d,e,f,g){return j.promise.then(function(){return {};});});var l=function(){k&&j.resolve();};o.$on("auth:tokenChange",function(a,b){h.setDefaultHeaders(b.headers);}),o.$on("auth:blogIdChange",function(a,b){h.setBaseUrl(m.GetEndPoint("agoraApiEndpoint")+"blogs/"+b.blogId),k=b&&b.blogId,l();});});}]),angular.module("msRestangular").factory("BaseBlogRestangular",["Restangular","Config","$window",function(b,c){return b.withConfig(function(a){a.setFullResponse(!0),a.setBaseUrl(c.GetEndPoint("agoraApiEndpoint")+"blogs/");});}]),angular.module("msRestangular").factory("DiscussionRestangular",["Restangular","Config","$rootScope","RestangularManager",function(d,e,f,g){return d.withConfig(function(c){g.init(c),f.$on("auth:tokenChange",function(a,b){c.setDefaultHeaders(b.headers);}),c.setBaseUrl(e.GetEndPoint("agoraApiEndpoint")+"discussions/");});}]),angular.module("msRestangular").factory("GuestbookRestangular",["Restangular","Config","$rootScope","RestangularManager",function(d,e,f,g){return d.withConfig(function(c){g.init(c),f.$on("auth:tokenChange",function(a,b){c.setDefaultHeaders(b.headers);}),c.setBaseUrl(e.GetEndPoint("agoraApiEndpoint")+"guestbooks/");});}]),angular.module("msRestangular").factory("IdServerRestangular",["Restangular","Config","RestangularManager",function(b,c,d){return b.withConfig(function(a){d.init(a),a.setBaseUrl(c.GetEndPoint("idServerEndpoint"));});}]),angular.module("msRestangular").factory("MessagingRestangular",["Restangular","Config","$location","RestangularManager",function(b,c,d,e){return b.withConfig(function(a){e.init(a),a.setBaseUrl(c.GetEndPoint("messagingEndpoint")+"mail/");});}]),angular.module("msRestangular").factory("MetaDataRestangular",["Restangular","Config","$location","$rootScope","RestangularManager",function(d,e,f,g,h){return d.withConfig(function(c){h.init(c),g.$on("auth:tokenChange",function(a,b){c.setDefaultHeaders(b.headers);}),c.setBaseUrl(e.GetEndPoint("metaDataApiEndpoint")+"metadatas/");});}]),angular.module("msRestangular").factory("RestangularManager",["$rootScope","$q",function(e,f){return {init:function(d){d.setFullResponse(!0),d.setErrorInterceptor(function(a,b,c){return 401===a.status&&e.$broadcast("restangular:needLogin",{response:a}),!0;});}};}]),angular.module("msRestangular").service("ShopRestangular",["Restangular","Config","$window","$rootScope","$q","RestangularManager",function(i,m,n,o,p,q){return i.withConfig(function(h){var j=p.defer(),k=!1;q.init(h),h.addFullRequestInterceptor(function(a,b,c,d,e,f,g){return j.promise.then(function(){return {};});});var l=function(){k&&j.resolve();};o.$on("auth:tokenChange",function(a,b){h.setDefaultHeaders(b.headers);}),o.$on("auth:shopIdChange",function(a,b){h.setBaseUrl(m.GetEndPoint("shopApiEndpoint")+"shops/"+b.shopId),k=b&&b.shopId,l();});});}]),angular.module("msRestangular").factory("SiteRestangular",["Restangular","Config","$location","$rootScope","RestangularManager",function(g,h,j,k,l){return g.withConfig(function(c){l.init(c),k.$on("auth:tokenChange",function(a,b){c.setDefaultHeaders(b.headers);}),k.$on("auth:siteIdChange",function(a,b){b.siteId&&c.setBaseUrl(h.GetEndPoint("siteApiEndpoint")+"sites/"+b.siteId);});var d=j.host();"127.0.0.1"!==d&&"localhost"!==d||(d="evianevian.dev.clienthost.mrsite.web");var e=h.GetEndPoint("subDomains");if(e){var f=d.split(".")[0];-1!==e.indexOf(f)&&(d=d.replace(f+".",""));}c.setBaseUrl(h.GetEndPoint("siteApiEndpoint")+"sites/"+d);});}]),angular.module("msRestangular").factory("BaseSiteRestangular",["Restangular","Config","RestangularManager",function(b,c,d){return b.withConfig(function(a){d.init(a),a.setBaseUrl(c.GetEndPoint("siteApiEndpoint")+"sites/");});}]),angular.module("msRestangular").factory("ThemeRestangular",["Restangular","Config","RestangularManager",function(b,c,d){return b.withConfig(function(a){d.init(a),a.setBaseUrl(c.GetEndPoint("siteApiEndpoint")+"themes/");});}]),angular.module("msSiteRepository",["msRestangular","msConfig"]),angular.module("msSiteRepository").factory("SiteRepository",["SiteRestangular","BaseSiteRestangular","$q",function(f,g,h){var j,k=function(){var c=h.defer();return j=c.promise,f.one("").get().then(function(a){var b=a.data.SiteData;b.images=b.images||{},b.images.headerLogo=b.images.headerLogo||{value:"",themeImage:"",isRemove:!1},b.images.footerLogo=b.images.footerLogo||{value:"",themeImage:"",isRemove:!1},c.resolve(b);}),j;},l=function(){var b=h.defer();return k().then(function(a){return b.resolve(a.siteId),j;}),b.promise;},i=function(b){var c=h.defer();return g.all("").post(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},m=function(b){var c=h.defer();return b.siteData=void 0,b.SiteData=void 0,f.all("").customPUT(b).then(function(a){c.resolve(!0);},function(a){c.resolve(a);}),c.promise;},n=function(){var b=h.defer();return f.one("").get().then(function(a){b.resolve(a.data.SiteData.settings);}),b.promise;},o=function(){var b=h.defer();return f.one("").get().then(function(a){b.resolve(a.data.SiteData.extensions);}),b.promise;},p=function(){var c=h.defer(),d=[];return d.push({name:"facebook",url:""}),d.push({name:"twitter",url:""}),d.push({name:"pinterest",url:""}),d.push({name:"googleplus",url:""}),d.push({name:"instagram",url:""}),d.push({name:"linkedin",url:""}),d.push({name:"tumblr",url:""}),d.push({name:"flickr",url:""}),d.push({name:"email",url:""}),n().then(function(b){b.socialLinks=d,q(b).then(function(a){c.resolve(b);});}),c.promise;},q=function(b){var c=h.defer();return f.all("settings").customPUT(b).then(function(a){c.resolve(a.data);},function(a){c.resolve(a);}),c.promise;},r=function(c){var d=h.defer();return f.all("themes").post('"'+c+'"').then(function(a){var b=a.data.trim();b=b.replace(/(^"|"$)/g,""),d.resolve(b);},function(a){d.resolve(a);}),d.promise;},v=function(b){var c=h.defer();return f.one("themes/"+b).get().then(function(a){c.resolve(a.data);},function(a){c.resolve(a);}),c.promise;},t=function(){var b=h.defer();return f.one("themes").get().then(function(a){b.resolve(a.data.Themes);},function(a){b.resolve(a);}),b.promise;},u=function(d){var e=h.defer();return v(d).then(function(b){var c=b.Theme;c.IsLive=!0,f.all("themes/"+d).customPUT(c).then(function(a){e.resolve(!0);},function(a){e.resolve(a);});}),e.promise;},w=function(b){var c=h.defer();return f.all("themes/"+b).remove().then(function(a){c.resolve(a.data);},function(a){c.resolve(a);}),c.promise;},x=function(b){var c=h.defer();return f.all("contentsnapshots").post(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},y=function(){var e=h.defer();return f.all("themes").get("updates").then(function(a){for(var b=a.data,c=[],d=0;b[d];d++)c.push(b[d]);e.resolve(c);}),e.promise;},z=function(b){var c=h.defer();return f.all("themes/"+b).one("update").customPUT().then(function(a){c.resolve(a.data);}),c.promise;};return {createNewPage:function(b,c){var d=h.defer(),e={name:b,type:c};return f.all("pages").post(e).then(function(a){d.resolve(a.data);}),d.promise;},getSite:k,getSiteId:l,createSite:i,updateSite:m,getSiteExtensions:o,getSiteSettings:n,setDefaultSocialSettings:p,updateSiteSettings:q,getMyThemes:t,installTheme:r,setThemeToLive:u,deleteMyThemeById:w,saveContentSnapShot:x,getThemeUpdates:y,updateTheme:z};}]),angular.module("msMessagingManager",["msRestangular","msSiteRepository"]),angular.module("msMessagingManager").factory("MessagingManager",["MessagingRestangular","$q","SiteRepository",function(c,d,e){return {sendMessage:function(b){return e.getSiteId().then(function(a){return b.siteId=a,c.all("").customPOST(b);});}};}]),angular.module("msContentItemContactForm",["msMessagingManager","ui.bootstrap"]),angular.module("msContentItemContactForm").directive("msContentItemContactForm",["MessagingManager","Config","Helper","$timeout",function(f,g,h,j){return {restrict:"A,E",replace:!0,scope:{contentItemData:"="},templateUrl:g.GetSessionStoredValue("modulesDirectory")+"/msContentItemContactForm/contactForm.html",link:function(c,d){c.defaultFormItems=[{id:h.guid(),type:"text",label:"Name",placeholder:"Enter your name",required:!1},{id:h.guid(),type:"text",label:"Email",placeholder:"Enter your email address",required:!1},{id:h.guid(),type:"textarea",label:"Message",placeholder:"Enter your message",required:!1}],c.contentItemData.settings.toEmail=c.contentItemData.settings.toEmail||"mail@yourwebsite.com",c.contentItemData.settings.subject=c.contentItemData.settings.subject||"You have a new contact form message",c.contentItemData.settings.buttonText=c.contentItemData.settings.buttonText||"Send",c.contentItemData.settings.formItems=c.contentItemData.settings.formItems||c.defaultFormItems,c.formData=[],c.formSubmitted=!1,angular.forEach(c.contentItemData.settings.formItems,function(a){void 0===a.id&&(a.id=h.guid());var b={};c.formData.push(b);});var e=d.find(".submit-button");c.submitForm=function(b){b.$valid?(e.addClass("sending"),f.sendMessage({to:c.contentItemData.settings.toEmail,subject:c.contentItemData.settings.subject,messageFields:c.formData}).then(function(a){201===a.status?(e.removeClass("sending"),e.addClass("sent"),e.find("span").text("Your message has been sent"),j(function(){e.removeClass("sent"),e.find("span").text("Send");},2e3)):(e.addClass("error"),e.find("span").text("There was an error sending your message"),j(function(){e.find("span").text("Send"),e.removeClass("error");},2e3));})):c.formSubmitted=!0;};}};}]),angular.module("msContentItemContactForm").directive("msContentItemContactFormEdit",["Config","$timeout","$compile","Helper","MessagingManager",function(e,f,g,h,j){return {restrict:"A,E",replace:!0,scope:{contentItemData:"="},templateUrl:e.GetSessionStoredValue("modulesDirectory")+"/msContentItemContactForm/contactForm.html",link:function(b,c){b.formData=[],b.defaultFormItems=[{id:h.guid(),type:"text",label:"Name",placeholder:"Enter your name",required:!1},{id:h.guid(),type:"text",label:"Email",placeholder:"Enter your email address",required:!1},{id:h.guid(),type:"textarea",label:"Message",placeholder:"Enter your message",required:!1}],b.contentItemData.settings.toEmail=b.contentItemData.settings.toEmail||"mail@yourwebsite.com",b.contentItemData.settings.subject=b.contentItemData.settings.subject||"You have a new contact form message",b.contentItemData.settings.buttonText=b.contentItemData.settings.buttonText||"Send",b.contentItemData.settings.formItems=b.contentItemData.settings.formItems||b.defaultFormItems,b.formSubmitted=!1,angular.forEach(b.contentItemData.settings.formItems,function(a){void 0===a.id&&(a.id=h.guid());});var d=function(){var a={};b.formData.push(a);};angular.forEach(b.contentItemData.settings.formItems,function(){d();}),b.$on("newFieldAdded",function(){d();}),b.submitForm=function(a){a.$valid||(b.formSubmitted=!0);};}};}]),angular.module("msContentItemContactForm").directive("fieldDirective",["Config",function(h){return {restrict:"E",replace:!0,scope:{field:"=",formData:"="},link:function(f){f.formData=f.formData;var g=function(d){var e="";return d.split(" ").forEach(function(a,b){var c=a.toLowerCase();e+=0===b?c:c[0].toUpperCase()+c.slice(1);}),e;};f.setData=function(){f.formData.label=f.field.label,f.field.name=g(f.field.label),"dropdown"===f.field.type?f.formData.value=f.field.options[0]:"checkbox"===f.field.type?f.formData.value=f.field.value:f.formData.value="";},f.$watch("field",function(){f.setData();},!0),f.getTemplateUrl=function(){var a=h.GetSessionStoredValue("modulesDirectory")+"/msContentItemContactForm/fields/";return a+=f.field.type+".tpl.html";};},template:'<div ng-include="getTemplateUrl()"></div>'};}]),angular.module("msContentItemContactForm").directive("msContentItemContactFormSettings",["$compile","$sce","$rootScope","Config","$timeout","ngDialog","Helper",function(h,j,k,l,i,m,n){return {restrict:"A,E",replace:!0,scope:{settings:"="},templateUrl:l.GetSessionStoredValue("modulesDirectory")+"/msContentItemContactForm/msContactFormSettings.tpl.html",link:function(e,f){e.formFieldTypes=[{type:"text",label:"Text",placeholder:"",required:!1},{type:"textarea",label:"Text Area",placeholder:"",required:!1},{type:"checkbox",label:"Checkbox",placeholder:void 0,required:!1,value:!1},{type:"radio",label:"Radio",placeholder:void 0,required:!1,options:["Option 1","Option 2"]},{type:"dropdown",label:"Drop Down",placeholder:void 0,required:!1,options:["Option 1","Option 2"]}],e.settings=e.settings||{},e.settings.buttonText=e.settings.buttonText||"Send",e.settings.toEmail=e.settings.toEmail||"mail@yourwebsite.com",e.settings.subject=e.settings.subject||"You have a new contact form message",e.settings.formItems=e.settings.formItems;var g=function(c){var d=[];angular.forEach(c,function(b){angular.forEach(e.settings.formItems,function(a){a.id===b&&d.push(a);});}),e.settings.formItems=[],e.settings.formItems=d,e.$apply();};i(function(){$("ul.field-items",f).sortable({items:"> li",handle:".basic-info .actions .icon-reorder",axis:"y",containment:"parent",stop:function(a,b){var c=$(this).sortable("toArray","id");g(c);}});},100),e.showNewItems=function(){m.open({template:l.GetSessionStoredValue("modulesDirectory")+"/msContentItemContactForm/newFieldPopUp.tpl.html",scope:e,className:"add-form-item"});},e.addFormItem=function(a){var b=angular.copy(a);b.id=n.guid(),e.settings.formItems.push(b),k.$broadcast("newFieldAdded"),k.$broadcast("repositionSettings");},e.deleteField=function(a){e.settings.formItems.splice(a,1);},e.showSettings=function(a){$(a.target).parents(".field-item").siblings().children(".field-settings").slideUp(),$(a.target).parents().siblings(".field-settings").slideToggle();};}};}]),angular.module("msContentItemTwitter",[]),angular.module("msContentItemTwitter").directive("msContentItemTwitter",["$compile","$timeout","$interval",function(o,p,q){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(h,j){var k=function(d,e,f){if(d.getElementById(f)){var g=d.getElementById(f);g.parentElement.removeChild(g);}p(function(){var a,b=d.getElementsByTagName(e)[0],c=/^http:/.test(d.location)?"http":"https";d.getElementById(f)||(a=d.createElement(e),a.id=f,a.src=c+"://platform.twitter.com/widgets.js",b.parentNode.insertBefore(a,b));});},l=function(b){var c="";c=b?'<a class="twitter-timeline" data-widget-id="'+b+'"></a>':"",o(c)(h,function(a){j.html(a),k(document,"script","twitter-wjs");}),q(function(){j.find("iframe").css({"max-width":"100%",width:"100%"});},100,20);},i=_.debounce(l,500),m=!0,n=function(a){m?(m=!1,l(a)):i(a);};h.$watch("contentItemData.settings.widgetId",n);}};}]),angular.module("msContentItemTwitter").directive("msContentItemTwitterEdit",["$compile","$timeout","$interval",function(o,p,q){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(h,j){h.openSettings=h.$parent.actions.displaySettings;var k=function(d,e,f){if(d.getElementById(f)){var g=d.getElementById(f);g.parentElement.removeChild(g);}p(function(){var a,b=d.getElementsByTagName(e)[0],c=/^http:/.test(d.location)?"http":"https";d.getElementById(f)||(a=d.createElement(e),a.id=f,a.src=c+"://platform.twitter.com/widgets.js",b.parentNode.insertBefore(a,b));});},l=function(b){var c="";c=b?'<a class="twitter-timeline" data-widget-id="'+b+'"></a>':'<div class="ms-no-settings ms-tools"><button class="ms-button primary" ng-click="openSettings()">Add your Twitter feed</button>',o(c)(h,function(a){j.html(a),k(document,"script","twitter-wjs");}),q(function(){j.find("iframe").css({"max-width":"100%",width:"100%"});},100,20);},i=_.debounce(l,500),m=!0,n=function(a){m?(m=!1,l(a)):i(a);};h.$watch("contentItemData.settings.widgetId",n);}};}]),angular.module("msContentItemTwitter").directive("msContentItemTwitterSettings",["$compile","$sce","$rootScope",function(d,e,f){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><p>Click on the button below to go to Twitter. In the \'Username\' box, type in your Twitter username, then click on \'Create widget\'. Copy the long piece of code below the \u2018Preview\u2019 box  and paste it into the \u2018Twitter code\u2019 box below.</p></div><div class="col-fix14"><a target="_blank" href="https://twitter.com/settings/widgets/new" class="ms-button info">Click here to get your twitter code</a></div><div class="col-fix14"><label>Twitter code</label><input type="text" ng-model="settings.embeded"/></div></div>',link:function(c){c.settings=c.settings||{},c.settings.embeded=c.settings.embeded||"",c.settings.widgetId=c.settings.widgetId||"",c.$watch("settings.embeded",function(){var a=c.settings.embeded.split('widget-id="');if(c.settings.widgetId=c.settings.embeded,a[1]){var b=a[1].split('"');b[0]&&(c.settings.widgetId=b[0]);}}),c.$watch("settings",function(a,b){a!==b&&f.$broadcast("markChanges","twitter settings has been changed.");},!0);}};}]),angular.module("msCkEditor",[]),angular.module("msCkEditor").directive("ckInline",["$compile","$sce",function(h,j){return {scope:{editorContent:"="},restrict:"AE",link:function(b,c,d){var e={};void 0!==d.ckplaceholder&&(e.placeholder=d.ckplaceholder);var f=CKEDITOR.inline(c[0],e),g=b.$watch("editorContent",function(a){a&&setTimeout(function(){f.setData(a);});});f.on("change",function(){b.$apply(function(){b.editorContent=f.getData(),b.editorContent&&g();});});}};}]),angular.module("msCkEditor").directive("ckStandard",["$compile","$sce",function(h,j){return {scope:{editorContent:"="},restrict:"AE",link:function(b,c,d){var e={};void 0!==d.ckplaceholder&&(e.placeholder=d.ckplaceholder);var f=CKEDITOR.replace(c[0],e),g=b.$watch("editorContent",function(a){a&&setTimeout(function(){f.setData(a);});});f.on("change",function(){b.$apply(function(){b.editorContent=f.getData(),b.editorContent&&g();});});}};}]),angular.module("msContentItemText",["msCkEditor"]),angular.module("msContentItemText").directive("msContentItemText",["$sce",function(c){return {restrict:"A",replace:!0,scope:{contentItemData:"="},template:'<div style="color:{{contentItemData.settings.fontcolor}};background-color:{{contentItemData.settings.backgroundcolor}};line-height:{{contentItemData.settings.lineHeight}}" ng-bind-html="trustedHTML"></div>',link:function(a){a.contentItemData.value=a.contentItemData.value||"";var b=a.contentItemData.value;0!==a.contentItemData.value.indexOf("<p>")&&(b="<p>"+b+"</p>"),a.trustedHTML=c.trustAsHtml(b);}};}]),angular.module("msContentItemText").directive("msContentItemTextEdit",["$rootScope",function(d){return {restrict:"A",replace:!0,scope:{contentItemData:"="},template:'<div style="color:{{contentItemData.settings.fontcolor}};background-color:{{contentItemData.settings.backgroundcolor}};line-height:{{contentItemData.settings.lineHeight}}"><div ck-inline editor-content="contentItemData.value" contenteditable="true"></div></div>',link:function(c){c.contentItemData.value=c.contentItemData.value||"",c.$watch("contentItemData.value",function(a,b){a!==b&&d.$broadcast("markChanges","text has been changed.");});}};}]),angular.module("msContentItemText").directive("msContentItemTextSettings1",["$compile","$sce",function(b,c){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div>Font color: <input type="text" ng-model="settings.fontcolor"/>Background color: <input type="text" ng-model="settings.backgroundcolor"/>Line height: <input type="range"step="0.1" min="0.1" max="5" ng-model="settings.lineHeight"/></div>',link:function(a){a.settings=a.settings||{},a.settings.fontcolor=a.settings.fontcolor||"",a.settings.backgroundcolor=a.settings.backgroundcolor||"",a.settings.lineHeight=a.settings.lineHeight||"";}};}]),angular.module("msPageRepository",["msSiteRepository"]),angular.module("msPageRepository").factory("PageRepository",["SiteRepository","$q",function(e,f){var g,h=e.getSite,j=function(){var b=f.defer();return h().then(function(a){b.resolve(a.pages);}),b.promise;};return {getCurrentPage:function(){var a=f.defer();return a.resolve(g),a.promise;},setCurrentPage:function(c){var d=f.defer();return h().then(function(b){g=b.pages.filter(function(a){return String(a.url).substring(1).toLowerCase()===c;})[0],g||(g={name:"404",url:"/404"},"admin"===c&&(g={name:"403",url:"/403"})),d.resolve(g);}),d.promise;},getPages:j};}]),angular.module("msContentItemNavigation",["msPageRepository"]),angular.module("msContentItemNavigation").directive("msContentItemNavigation",["SiteRepository","Config","$timeout","$rootScope","MenuRepository","PageBuilderManager","Helper","$q",function(l,i,m,n,o,p,q,r){return {restrict:"A",replace:!0,templateUrl:i.GetSessionStoredValue("modulesDirectory")+"/msContentItemNavigation/msContentItemNavigation.tpl.html",link:function(d,e){d.shopUrl=void 0,d.svgUrl=function(a){return i.GetEndPoint("modulesDirectory")+"/msContentItemNavigation/sprites.svg#"+a;},o.getMenu().then(function(b){d.menu=b,p.getPages().then(function(a){d.pages=a,f(),g(d.menu);});}),p.getWebsiteData().then(function(a){d.isShopEnable=a.isShopEnable||!1;});var f=function(){for(var a=0;a<d.pages.length;a++){var b=d.pages[a];if("shop"===b.type.toLowerCase()){d.shopUrl=b.url;break;}}},g=function(a){for(var b=0;b<a.length;b++){var c=a[b];"category"===c.type.toLowerCase()&&(void 0===d.shopUrl&&(c.hideInMenu=!0),c.fakeUrl="/"+c.categories.join("/")),c.hasOwnProperty("subMenuItems")&&g(c.subMenuItems);}},h=e.find(".mobile-menu"),j=e.find(".mobile-menu-close"),k=angular.element("body");h.on("click",function(){e.addClass("open"),k.addClass("menu-open"),k.css({overflow:"hidden"});}),j.on("click",function(){e.removeClass("open"),k.removeClass("menu-open"),k.css({overflow:"visible"});});e.find("ul.nav");d.linkClicked=function(){e.removeClass("open"),k.removeClass("menu-open"),k.css({overflow:"visible"});},n.$on("menuChanged",function(){o.getMenu().then(function(a){d.menu=a,f();});});}};}]),angular.module("msContentItemMap",[]),angular.module("msContentItemMap").directive("msContentItemMap",["$compile","msContentItemMapManager",function(e,f){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){b.openSettings=b.$parent.actions.displaySettings,b.contentItemData.settings=f.resetSettings(b.contentItemData.settings);var d=f.getMapIframe(b.contentItemData.settings);e(d)(b,function(a){c.html(a);});}};}]),angular.module("msContentItemMap").directive("msContentItemMapEdit",["$compile","msContentItemMapManager","$timeout",function(j,k,l){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(c,d){c.openSettings=c.$parent.actions.displaySettings,c.contentItemData.settings=k.resetSettings(c.contentItemData.settings);var e=function(){if(c.contentItemData.settings.place){var b=k.getMapIframe(c.contentItemData.settings);j(b)(c,function(a){d.html(a);});}},f=_.debounce(function(){e(),c.$apply();},1e3),g=!0,h=function(){g?l(function(){g=!1;}):c.contentItemData.settings.place&&f();};c.$watch("contentItemData.settings.apiKey",h),c.$watch("contentItemData.settings.place",h),c.$watch("contentItemData.settings.height",h),e();}};}]),angular.module("msContentItemMap").factory("msContentItemMapManager",[function(){var b=function(a){return a=a||{},a.place=a.place||"mrsite",a.height=a.height||"450",a;};return {resetSettings:b,getMapIframe:function(a){return a=a||b(a),'<iframe width="100%" height="{{contentItemData.settings.height}}" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?q='+a.place+'&key=AIzaSyDHzR_F3yvth5q1FGwQfcqmNb0cRwwO6po"></iframe>';}};}]),angular.module("msContentItemMap").directive("msContentItemMapSettings",["$compile","msContentItemMapManager",function(e,f){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Address</label><input type="text" ng-model="settings.place" /></div></div><div class="row-fix"><div class="col-fix14"><label>Height</label><div class="slider"></div></div></div></div>',link:function(c,d){$(".slider",d).slider({min:50,max:800,range:"min",value:c.settings.height,slide:function(a,b){c.settings.height=b.value,c.$apply();}}),c.settings=f.resetSettings(c.settings);}};}]),angular.module("msContentItemHtml",[]),angular.module("msContentItemHtml").directive("msContentItemHtml",["$compile",function(e){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){var d="";b.contentItemData.settings.htmlCode&&(d=b.contentItemData.settings.htmlCode),e(d)(b,function(a){c.html(a);});}};}]),angular.module("msContentItemHtml").directive("msContentItemHtmlEdit",["$compile",function(g){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(d,e){var f=function(b){var c='<div class="ms-no-settings">Embed means you can insert media from other websites.</div>';d.contentItemData.settings.htmlCode&&(c=d.contentItemData.settings.htmlCode),g(c)(d,function(a){e.html(a);});};f(d.contentItemData.settings.htmlCode),d.$watch("contentItemData.settings.htmlCode",function(a,b){f(d.contentItemData.settings.htmlCode);});}};}]),angular.module("msContentItemHtml").directive("msContentItemHtmlSettings",["$compile","$rootScope",function(d,e){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Embed Code</label></div></div><div class="row-fix"><div class="col-fix14"><textarea rows="10" cols="100"  ng-model="settings.htmlCode"/></div></div></div>',link:function(c){c.$watch("settings",function(a,b){a!==b&&e.$broadcast("markChanges","html settings has been changed.");},!0);}};}]),angular.module("msUpload",["blueimp.fileupload"]),angular.module("msUpload").directive("msUpload",["$timeout","$sce","$window","$compile","Config","$rootScope","$sessionStorage",function(l,i,m,n,o,p,q){return {restrict:"A",replace:!1,scope:{files:"=msUpload",title:"@msTitle",enableMultiple:"=msEnableMultiple",uploadStyle:"@msUploadStyle",buttonText:"@msButtonText",fileType:"@msFileType"},link:function(g,h){g.fileLoadingError=!1,g.fileLoadingErrorMessage="Your file is too big - please resize it.";var j={Authorization:"Bearer "+q.get("token")};g.$on("fileuploadadd",function(c,d){d.headers=j,d.url=o.GetEndPoint("mediaApiEndpoint")+"sites/"+q.get("siteId")+"/"+g.fileType,d.context={find:function(b){return {button:function(a){}};}},g.$parent.fileLoadingClass=!0,g.$parent.fileLoadingError=!1;});var k;g.$on("fileuploadstop",function(){g.$parent.fileLoadingClass=!1;}),g.$on("fileuploadfail",function(a,b){g.fileLoadingErrorMessage=b.errorThrown;var c=b.result;c&&c.message&&(g.fileLoadingErrorMessage=c.message),g.fileLoadingError=!0;}),g.$on("fileuploaddragover",function(){l(function(){g.$parent.fileDragOverClass="file-drag-over";}),l.cancel(k),k=l(function(){g.$parent.fileDragOverClass=!1;},100);}),g.$on("fileuploaddrop",function(){g.$parent.fileDragOverClass=!1;}),g.$on("fileuploaddone",function(a,b){var c=b._response.result,d=0;if(g.files=g.files||[],5!==g.files.length)for(g.files=[];c[d];)g.files[d]={url:c[d].location},d++;else for(;c[d];){if(5===g.files.length){for(var e=0;e<g.files.length;e++)if(!g.files[e]||!g.files[e].url){g.files[e]={url:c[d].location};break;}}else if(g.files.length>0){for(var f=0;f<g.files.length;f++)if(!g.files[f]||!g.files[f].url){g.files[f]={url:c[f].location};break;}}else g.files.push({url:c[d].location});d++;}p.$broadcast("modalClose");}),g.clickUploadButton=function(a){var b=angular.element(a.currentTarget),c=b.parent();$(".image-upload",c).click();},void 0!==g.files&&(0!==g.files.length&&g.files[0].url||l(function(){h.find(".upload-wrap").addClass("no-images");},200)),$(document).bind("dragover",function(a){var b=$(".dropZone"),c=window.dropZoneTimeout;c?clearTimeout(c):b.addClass("in");var d=!1,e=a.target;do {if(e===b[0]){d=!0;break;}e=e.parentNode;}while(null!==e);d?b.addClass("hover"):b.removeClass("hover"),window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,b.removeClass("in hover");},100);}),g.getTemplate=function(){return g.enableMultiple?"bower_components/msUpload/moduleUpload"+g.uploadStyle+"-multiple.html":"bower_components/msUpload/moduleUpload"+g.uploadStyle+"-single.html";};},template:'<div class="upload-wrap" ng-include="getTemplate()"></div>'};}]),angular.module("msMediaLibrary",["msUpload"]),angular.module("msMediaLibrary").directive("msMediaLibrary",["$compile","$rootScope","MediaLibraryManager",function(f,g,h){return {restrict:"E",scope:{title:"=",uploadedFiles:"=",editableId:"=",multipleUpload:"=",mode:"=",buttonText:"@buttonText",fileType:"@fileType"},link:function(c,d){c.buttonText=c.buttonText||"+",c.fileType=c.fileType||"files",c.$watch("uploadedFiles",function(a,b){a!==b&&g.$broadcast("modalClose");},!0),d.addClass("ms-tools clearfix");var e="";"dialog"===c.mode?e='<div class="align-center upload-box dropZone" ng-class="{loading : fileLoadingClass}"><div ms-upload="uploadedFiles" ms-button-text="{{buttonText}}" ms-upload-style="{{mode}}" ms-title="{{title}}"  ms-enable-multiple=multipleUpload ms-file-type="{{fileType}}"></div></div>':"hover"===c.mode?(d.addClass("media-wrap"),d.parent().css({position:"relative"}),e='<div ms-upload="uploadedFiles" ng-class="{loading : fileLoadingClass}" ms-button-text="{{buttonText}}" ms-upload-style="{{mode}}" ms-title="{{title}}"  ms-enable-multiple=multipleUpload class="ms-media-library {{mode}}" ms-file-type="{{fileType}}"></div>'):e='<div ms-upload="uploadedFiles" ng-class="{loading : fileLoadingClass}" ms-button-text="{{buttonText}}" ms-upload-style="{{mode}}" ms-title="{{title}}"  ms-enable-multiple=multipleUpload class="ms-media-library {{mode}}" ms-file-type="{{fileType}}"></div>',f(e)(c,function(a){d.html(a);});}};}]),angular.module("msMediaLibrary").factory("MediaLibraryManager",["$q",function(d){var e={};return {setActiveFile:function(a,b){e={editableId:a,file:b};},getSelectedFile:function(){var a=d.defer();return setTimeout(function(){a.resolve(e);},2e3),a.promise;},loadFiles:function(){return 1;},randomString:function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(a[19]&&3||8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("");}};}]),angular.module("msContentItemSingleImage",["msMediaLibrary"]),angular.module("msContentItemSingleImage").directive("msContentItemSingleImage",["$compile",function(f){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){var d="";if(b.contentItemData.settings.imageUrl)if(b.contentItemData.settings.linkUrl){var e=new RegExp("https*://");b.contentItemData.settings.linkUrl.replace(e,"").length>0&&(d='<div><a ng-href="{{contentItemData.settings.linkUrl}}" target="{{contentItemData.settings.imageTarget}}"><img title="{{contentItemData.settings.title}}" alt="{{contentItemData.settings.alt}}" ng-src="{{contentItemData.settings.imageUrl}}" /><div class="caption" ng-if="contentItemData.settings.caption">{{contentItemData.settings.caption}}</div></a></div>');}else d='<div><img title="{{contentItemData.settings.title}}" alt="{{contentItemData.settings.alt}}" ng-src="{{contentItemData.settings.imageUrl}}" /><div class="caption" ng-if="contentItemData.settings.caption">{{contentItemData.settings.caption}}</div></div>';f(d)(b,function(a){c.html(a);});}};}]),angular.module("msContentItemSingleImage").directive("msContentItemSingleImageEdit",["$compile","MediaLibraryManager",function(g,h){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(d,e){var f=function(){var b='<ms-media-library mode="\'dialog\'" editable-id="editableId" uploaded-files="images" title=modalTitle multiple-upload=false></ms-media-library>';if(d.contentItemData.settings.imageUrl)if(d.contentItemData.settings.linkUrl){var c=new RegExp("https*://");d.contentItemData.settings.linkUrl.replace(c,"").length>0&&(b='<div><a ng-href="{{contentItemData.settings.linkUrl}}" target="{{contentItemData.settings.imageTarget}}"><img title="{{contentItemData.settings.title}}" alt="{{contentItemData.settings.alt}}" ng-src="{{contentItemData.settings.imageUrl}}" /><div class="caption" ng-if="contentItemData.settings.caption">{{contentItemData.settings.caption}}</div></a></div>');}else b='<div><img title="{{contentItemData.settings.title}}" alt="{{contentItemData.settings.alt}}" ng-src="{{contentItemData.settings.imageUrl}}" /><div class="caption" ng-if="contentItemData.settings.caption">{{contentItemData.settings.caption}}</div></div>';else d.images=[],d.images.push({url:d.contentItemData.settings.imageUrl,default:0}),d.editableId=h.randomString(),d.modalTitle="Single image",d.$watch("images",function(){d.contentItemData.settings.imageUrl=d.images[0].url;});g(b)(d,function(a){e.html(a);});};d.$watch("contentItemData",function(){f();},!0);}};}]),angular.module("msContentItemSingleImage").directive("msContentItemSingleImageSettings",["$compile","$sce","MediaLibraryManager","$rootScope",function(f,g,h,j){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><div class="image-wrap"><img ng-if="settings.imageUrl" title="{{settings.title}}" alt="{{settings.alt}}" ng-src="{{settings.imageUrl}}"/><ms-media-library mode="\'dialog\'" editable-id="editableId" uploaded-files="images" title=modalTitle multiple-upload=false></ms-media-library></div></div></div><div class="row-fix"><div class="col-fix7"><label>Alt</label><input type="text" ng-model="settings.alt" /></div><div class="col-fix7"><label>Title</label><input type="text" ng-model="settings.title" /></div></div><div class="row-fix"><div class="col-fix7"><label>Link URL</label><input type="url" class="link-url" ng-model="settings.linkUrl" /></div><div class="col-fix7"><label>Link Target</label><select ng-options="target.value as target.label for target in linkTarget" ng-model="settings.imageTarget"></select></div></div><div class="row-fix"><div class="col-fix14"><label>Caption</label><textarea rows="4" ng-model="settings.caption"></textarea></div></div></div>',link:function(c,d){c.settings.alt=c.settings.alt||"",c.settings.title=c.settings.title||"",c.settings.imageUrl=c.settings.imageUrl||"",c.settings.linkUrl=c.settings.linkUrl||"",c.settings.caption=c.settings.caption||"",c.images=[],c.images.push({url:c.settings.imageUrl,default:0}),c.editableId=h.randomString(),c.modalTitle="Single image",c.linkTarget=[{value:"_self",label:"Same tab"},{value:"_blank",label:"New tab"}],c.settings.imageTarget=c.settings.imageTarget||c.linkTarget[1].value,c.$watch("images",function(a,b){c.settings.imageUrl=c.images[0].url;}),c.$watch("settings",function(a,b){a!==b&&j.$broadcast("markChanges","single image settings has been changed.");},!0);var e=d.find("input.link-url");e.on("focus",function(){$(this).select();}),e.on("blur",function(){0!==e.val().indexOf("http://")&&0!==e.val().indexOf("https://")&&(c.settings.linkUrl="http://"+e.val());});}};}]),angular.module("msLightbox",[]),angular.module("msLightbox").provider("msLightbox",function(){this.$get=["$timeout","$window","$document","Config",function(g,h,j,k){var l,i=angular.element,m=j.find("body"),n=i('<div class="gallery-popup-wrapper"></div>'),o=i('<div class="popup-control prev"></div>'),p=i('<div class="popup-control next"></div>'),q=i('<div class="close-popup"></div>'),r=0,v={checkforCss:function(){var a=k.GetEndPoint("modulesDirectory")+"/msLightbox/lightbox.css";$('link[href="'+a+'"]').length||$("head").append('<link href="http://www.shawnkatz.com/scripts/'+a+'" type="text/css" rel="stylesheet" />');}},t={items:[],index:0,textPosition:"right"},u={open:function(a){a||(a=t),v.checkforCss(),l=a.items,n.append(q),q.on("click",function(){u.close();}),p.on("click",function(){u.changeItem($(this).data("toImage"),a.position);}),o.on("click",function(){u.changeItem($(this).data("toImage"),a.position);}),l.length>1&&n.append(o,p),n.append(u.addItem(a.items[a.index],a.position)),n.css({top:h.pageYOffset}),m.append(n).css({overflow:"hidden","min-height":"100%",height:"100%"}),g(function(){n.addClass("open");},100),r=a.index,u.setData();},addItem:function(a,b){var c;c=a.image?a.image:a;var d=a.caption,e=a.description,f=i('<div class="gallery-popup"><div class="image"><img src="http://www.shawnkatz.com/scripts/'+c+'"/></div></div>');return d||e?("right"===b?f.addClass("text-right"):"below"===b&&f.addClass("text-bottom"),d&&e?f.append('<div class="info"><h2>'+d+"</h2><p>"+e+"</p></div>"):d&&!e?f.append('<div class="info"><h2>'+d+"</h2></div>"):!d&&e&&f.append('<div class="info"><p>'+e+"</p></div>")):f.addClass("no-text"),f;},close:function(){var a=m.find(".gallery-popup-wrapper");a.removeClass("open"),g(function(){a.remove(),m.removeAttr("style"),n.html("");},500);},setData:function(){var a=function(){return r===l.length-1?"end":r+1;},b=function(){return 0===r?"end":r-1;};p.data("to-image",a()).attr("data-to-image",a()),o.data("to-image",b()).attr("data-to-image",b());},changeItem:function(a,b){if("end"!==a){n.find(".gallery-popup").fadeOut(function(){$(this).remove();}),n.append(u.addItem(l[a],b).hide().fadeIn()),r=a,u.setData();}}};return u;}];}),angular.module("msContentItemSlideShow",["msMediaLibrary","ui.bootstrap","msContentItemSingleImage","msLightbox"]),angular.module("msContentItemSlideShow").directive("msImageSettings",["$compile","$sce",function(l,i){return {restrict:"A,E",replace:!0,scope:{settings:"="},link:function(e,f){e.backupSettings=angular.copy(e.settings),e.settings.caption=e.settings.caption||"",e.settings.description=e.settings.description||"";var g=(f.parent(),f.find(".image"),$("body").find(".imageSettingsPlaceHolder")),h=$("body").find(".settingsOverlay"),j=function(){g.removeClass("active image-settings"),h.removeClass("active").removeAttr("style"),f.find(".ms-block").removeClass("active"),g.removeAttr("style"),$("body").removeClass("ov-hidden"),$(".image-settings",".image-wrap").remove(),$(".images, .upload-box").show();};e.ok=function(){g.removeClass("active image-settings"),j();},h.on("click",function(){e.ok();}),e.displaySettings=function(){var b='<div class="buttons"><div class="ms-buttons"><button ng-click="ok()" class="ms-button info">Done</button></div></div>',c='<div class="image-settings"><h2 class="title">Image settings</h2><div class="wrapper"><div class="settings-mask"><div class="row-fix"><div class="col-fix13"><label>Title</label><input type="text" value="settings.caption" ng-model="settings.caption" /></div><div class="col-fix13"><label>Description</label><textarea value="settings.description" ng-model="settings.description" ng-maxlength="250"></textarea></div></div></div>'+b+"</div></div>",d=angular.element(c);$("body").find(".ms-block").removeClass("active"),l(d)(e,function(a){$(".image-wrap.slide-show").append(a),$("body").addClass("ov-hidden"),$(".images, .upload-box").hide();});};var k=function(){var b=angular.element('<span ng-click="displaySettings()" class="settings icon-settings control"></span>');b.attr("ms-tooltip",""),b.attr("tooltip-content","Settings"),l(b)(e,function(a){f.append(a);});};e.$watch("settings",function(){k();});}};}]),angular.module("msContentItemSlideShow").directive("msContentItemSlideShow",["$compile","$timeout","Config","MediaLibraryManager","msLightbox",function(g,h,j,k,l){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(d,e){d.editableId=k.randomString(),d.openSettings=d.$parent.actions.displaySettings,d.contentItemData.settings.images=d.contentItemData.settings.images||[];var f=function(){d.contentItemData.settings.selectedType=d.contentItemData.settings.selectedType||{id:"slideshow",name:"Slideshow"},d.contentItemData.settings.textPosition=d.contentItemData.settings.textPosition||{id:"right",name:"Right"},d.contentItemData.settings.height=d.contentItemData.settings.height||300,d.contentItemData.settings.interval=d.contentItemData.settings.interval||5e3,d.contentItemData.settings.itemsPerRow=d.contentItemData.settings.itemsPerRow||3,d.contentItemData.settings.showCaptionsInGrid=d.contentItemData.settings.showCaptionsInGrid||!1,d.contentItemData.settings.cropImages=d.contentItemData.settings.cropImages||!1;var b=d.slides=[];if(d.addSlide=function(a){b.push({image:a.url,caption:a.caption,description:a.description});},d.getGalleryTemplate=function(){if(d.contentItemData.settings.images.length>0)return j.GetEndPoint("modulesDirectory")+"/msContentItemSlideShow/gallery."+d.contentItemData.settings.selectedType.id+".tpl.html";},"slideshow"===d.contentItemData.settings.selectedType.id){var c=function(){h(function(){$(".carousel-control, .carousel-indicators").hide();});};d.contentItemData.settings.showControls||c();}else "grid"===d.contentItemData.settings.selectedType.id&&(d.itemsPerRowClass="items-per-row-"+d.contentItemData.settings.itemsPerRow);d.contentItemData.settings.images.length>0?d.contentItemData.settings.images.forEach(function(a){d.addSlide(a);}):h(function(){d.contentItemData.settings.opened||(angular.element("#open-settings").trigger("click"),d.contentItemData.settings.opened=!0);},1);};d.openItem=function(a){l.open({items:d.slides,index:a,position:d.contentItemData.settings.textPosition.id});},d.$watch("contentItemData.settings",function(){f();},!0);},template:'<div ng-include="getGalleryTemplate()"></div>'};}]),angular.module("msContentItemSlideShow").directive("msContentItemSlideShowEdit",["$compile","$timeout","Config","MediaLibraryManager","$window","msLightbox",function(j,k,l,i,m,n){return {restrict:"A,E",replace:!0,scope:{contentItemData:"="},link:function(f,g){f.editableId=i.randomString(),f.openSettings=f.$parent.actions.displaySettings,f.contentItemData.settings.images=f.contentItemData.settings.images||[];var h=function(){var b={id:"slideshow",name:"Slideshow"},c={id:"right",name:"Right"};f.contentItemData.settings.selectedType=f.contentItemData.settings.selectedType||b,f.contentItemData.settings.textPosition=f.contentItemData.settings.textPosition||c,f.contentItemData.settings.height=f.contentItemData.settings.height||300,f.contentItemData.settings.interval=f.contentItemData.settings.interval||5e3,f.contentItemData.settings.itemsPerRow=f.contentItemData.settings.itemsPerRow||3,f.contentItemData.settings.showCaptionsInGrid=f.contentItemData.settings.showCaptionsInGrid||!1,f.contentItemData.settings.cropImages=f.contentItemData.settings.cropImages||!1;var d=f.slides=[];if(f.addSlide=function(a){d.push({image:a.url,caption:a.caption,description:a.description});},f.getGalleryTemplate=function(){return f.contentItemData.settings.images.length>0?l.GetEndPoint("modulesDirectory")+"/msContentItemSlideShow/gallery."+f.contentItemData.settings.selectedType.id+".tpl.html":l.GetEndPoint("modulesDirectory")+"/msContentItemSlideShow/gallery.noimages.tpl.html";},"slideshow"===f.contentItemData.settings.selectedType.id){var e=function(){k(function(){$(".carousel-control, .carousel-indicators").hide();});};f.contentItemData.settings.showControls||e();}else "grid"===f.contentItemData.settings.selectedType.id&&(f.itemsPerRowClass="items-per-row-"+f.contentItemData.settings.itemsPerRow);f.contentItemData.settings.images.length>0?f.contentItemData.settings.images.forEach(function(a){f.addSlide(a);}):k(function(){f.contentItemData.settings.opened||(angular.element("#open-settings").trigger("click"),f.contentItemData.settings.opened=!0);},1);};f.openItem=function(a){n.open({items:f.slides,index:a,position:f.contentItemData.settings.textPosition.id});},f.$watch("contentItemData.settings",function(){h();},!0);},template:'<div ng-include="getGalleryTemplate()"></div>'};}]),angular.module("msContentItemSlideShow").directive("msContentItemSlideShowSettings",["$compile","$sce","MediaLibraryManager","Config","$rootScope","$window","$timeout",function(h,j,k,l,i,m,n){return {restrict:"A,E",replace:!0,scope:{settings:"="},templateUrl:l.GetSessionStoredValue("modulesDirectory")+"/msContentItemSlideShow/slideShowSettings.html",link:function(e,f){e.galleryTypes=[{id:"slideshow",name:"Slideshow"},{id:"grid",name:"Grid"}],e.textPosition=[{id:"right",name:"Right"},{id:"below",name:"Below"}],e.settings.selectedType=e.settings.selectedType||e.galleryTypes[0],e.settings.selectedPosition=e.settings.textPosition||e.textPosition[0],e.settings.images=e.settings.images||[],e.settings.showCaptionsInGrid=e.settings.showCaptionsInGrid||!1,e.settings.cropImages=e.settings.cropImages||!1,e.images=[],e.deleteImage=function(a){e.settings.images.splice(a,1);},e.editableId=k.randomString();var g=function(c){var d=[];angular.forEach(c,function(b){angular.forEach(e.settings.images,function(a){a.$$hashKey===b&&d.push(a);});}),e.settings.images=[],e.settings.images=d;};$(".image-wrap",f).sortable({items:".image",tolerance:"pointer",distance:1,stop:function(a,b){var c=$(this).sortable("toArray","id");g(c);}}),$("#height",f).slider({min:175,max:900,range:"min",value:e.settings.height,slide:function(a,b){e.settings.height=b.value,e.$apply();}}),$("#itemsPerRow",f).slider({min:1,max:10,range:"min",value:e.settings.itemsPerRow,slide:function(a,b){e.settings.itemsPerRow=b.value,e.$apply();}}),$("#interval",f).slider({min:10,max:1e4,step:10,range:"min",value:e.settings.interval,slide:function(a,b){e.settings.interval=b.value,e.$apply();}}),e.$watch("images",function(){e.images.length>0&&e.settings.images.push({url:e.images[0].url,caption:e.images[0].caption});}),e.$watch("settings",function(a,b){a!==b&&i.$broadcast("slideshowSettingsChange");},!0);}};}]),angular.module("msMetaTags",[]),angular.module("msMetaTags").directive("metaTags",["$compile","MetaTagsManager","Config",function(e,f,g){return {scope:{metaTags:"="},restrict:"AE",templateUrl:g.GetSessionStoredValue("modulesDirectory")+"/msMetaTags/msMetaTags.tpl.html",link:function(b,c,d){b.getMetaTagType=f.getMetaTagType,b.delete  =function(a){b.metaTags.splice(a,1);},b.add=function(){var a=f.parseMetaTag(b.newMetaTag);a?(b.error=!1,b.newMetaTag="",b.metaTags.push(a)):b.error=!0;},b.metaTags=b.metaTags||[];}};}]).factory("MetaTagsManager",[function(){var f={"google-site-verification":"Google verification","p:domain_verify":"Pinterest verification"};return {getMetaTagType:function(a){return a?a.name?f[a.name]?f[a.name]:a.name:a.attributes&&a.attributes[0]?a.attributes[0].name:"":"";},parseMetaTag:function(a){var b;if(a.match(/^\s*<meta(\s*([^="'\s]+)=("|')([^'"]+)("|'))*\s*\/>\s*$/)){var c=a.match(/([^="'\s]+)=("|')([^'"]+)("|')/g);if(c&&c.length>0){b={attributes:[]};for(var d=0;c[d];d++){var e=c[d].match(/([^="'\s]+)=(?:"|')([^'"]+)(?:"|')/);e&&e.length>2&&("name"===e[1]&&(b.name=e[2]),b.name||(b.name=e[1]),b.attributes.push({name:e[1],value:e[2]}));}}}return b;}};}]),angular.module("msSettingsPopup",["msMetaTags"]),angular.module("msSettingsPopup").directive("msSettingsPopup",[function(d){return {restrict:"A",link:function(a,b,c){}};}]),angular.module("msContentItemSpacer",[]),angular.module("msContentItemSpacer").directive("msContentItemSpacer",["Helper",function(b){return {restrict:"A",replace:!0,scope:{contentItemData:"="},template:'<div style="height:{{contentItemData.settings.height}}px" class="ms-spacer"></div>',link:function(a){a.contentItemData.id=a.contentItemData.id||b.guid(),a.contentItemData.settings=a.contentItemData.settings||{},a.contentItemData.settings.height=a.contentItemData.settings.height||20;}};}]),angular.module("msContentItemSpacer").directive("msContentItemSpacerSettings",["$rootScope",function(e){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Height</label><div class="slider"></div></div></div></div>',link:function(c,d){c.settings=c.settings||{height:100},$(".slider",d).slider({min:5,max:800,range:"min",value:c.settings.height,slide:function(a,b){c.settings.height=b.value,c.$apply();}}),c.$watch("settings",function(a,b){a!==b&&e.$broadcast("markChanges","spacer settings has been changed.");},!0);}};}]),angular.module("msContentItemVideo",[]),angular.module("msContentItemVideo").directive("msContentItemVideo",["$compile","moduleMsContentItemVideoManager","Config",function(g,h,j){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){var d='<div class="ms-no-settings">Add your embed code in the widget settings</div>',e="",f=h.getVideoCodeFromUrl(b.contentItemData.settings.url);f&&("youtube"===f.type?(e="//www.youtube.com/embed/"+f.id,d='<div class="video-wrapper"><iframe width="560px" height="315px" src="http://www.shawnkatz.com/scripts/'+e+'"  frameborder="0" allowfullscreen></iframe></div>'):"vimeo"===f.type&&(e="//player.vimeo.com/video/"+f.id,d='<div class="video-wrapper"><iframe src="http://www.shawnkatz.com/scripts/'+e+'" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>')),g(d)(b,function(a){c.html(a);});}};}]),angular.module("msContentItemVideo").directive("msContentItemVideoEdit",["$compile","moduleMsContentItemVideoManager","Config",function(h,j,k){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(e,f){e.contentItemData.settings.height=e.contentItemData.settings.height||315,e.url=e.url||"";var g=function(b){var c='<div class="ms-no-settings ms-tools">Video<input type="text" ng-model="url" placeholder="Enter YouTube or Vimeo link here" /><button ng-click="ok()" class="ms-button primary" >OK</button></div>',d="";b&&("youtube"===b.type?(d="//www.youtube.com/embed/"+b.id,c='<div class="video-wrapper"><iframe width="560px" height="315px" src="http://www.shawnkatz.com/scripts/'+d+'"  frameborder="0" allowfullscreen></iframe></div>'):"vimeo"===b.type&&(d="//player.vimeo.com/video/"+b.id,c='<div class="video-wrapper"><iframe src="http://www.shawnkatz.com/scripts/'+d+'" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>')),h(c)(e,function(a){f.html(a);});};g(e.contentItemData.settings.url),e.ok=function(){e.contentItemData.settings.url=e.url;},e.$watch("contentItemData.settings",function(){var a=j.getVideoCodeFromUrl(e.contentItemData.settings.url);g(a);},!0);}};}]),angular.module("msContentItemVideo").factory("moduleMsContentItemVideoManager",[function(){return {getVideoCodeFromUrl:function(a){var b=!1,c={};if(a){if(a.match("//(www.)?youtube|youtu.be")){var d="";d=a.match("embed")?a.split(/embed\//)[1].split('"')[0]:a.split(/v\/|v=|youtu.be\//)[1].split(/[?&]/)[0],c.type="youtube",c.id=d,b=!0;}else if(a.match("//(player.)?vimeo\\.com")){var e="";if(a.match("video"))e=a.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0];else{var f=a.split(/\/\/vimeo\.com\//)[1].split(/[/]/);e=f[f.length-1];}c.type="vimeo",c.id=e,b=!0;}return b?c:"No valid media id detected";}return !1;}};}]),angular.module("msContentItemVideo").directive("msContentItemVideoSettings",["$compile","$rootScope",function(e,f){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Youtube or Vimeo video url</label><input type="text" value="{{settings.url}}" ng-model="settings.url" /></div></div></div>',link:function(c,d){$(".videoHeightSlider",d).slider({min:0,max:1e3,range:"min",value:c.settings.height,slide:function(a,b){c.settings.height=b.value,c.$apply();}}),c.$watch("settings",function(a,b){a!==b&&f.$broadcast("markChanges","video settings has been changed.");},!0);}};}]),angular.module("msBasketRepository",[]),angular.module("msBasketRepository").factory("BasketRepository",["$q","$window","$sessionStorage",function(c,d,e){var f,g=function(){f={items:[]};},h=function(){var a=c.defer();return a.resolve(f.items),a.promise;},j=function(a){for(var b=0;f.items[b];b++)if(f.items[b].id===a)return b;},k=function(a){var b=j(a);return void 0!==b?f.items[b]:void 0;},l=function(){e.put("basket",JSON.stringify(f));},i=function(){e.get("basket")&&(f=JSON.parse(e.get("basket")));};return g(),i(),{getItems:h,saveItems:l,getItemById:k,getItemIndexById:j,reset:g};}]),angular.module("msBasketManager",["msBasketRepository"]),angular.module("msBasketManager").factory("BasketManager",["$q","BasketRepository",function(l,i){var m=function(a,b,c,d,e,f,g){return {id:a,name:b,imgUrl:c,quantity:d,price:e,attributes:f,stockLevel:g};},n=function(d){var e=l.defer();return i.getItems().then(function(a){var b=i.getItemIndexById(d);if((b||0===b)&&a[b]){var c=a[b];return c.quantity<0&&(c.quantity=0),0===c.quantity?u(d):void 0;}}).then(function(){e.resolve();}),e.promise;},o=function(c,d){var e=l.defer();return i.getItems().then(function(a){var b=i.getItemById(c);return !!b&&(b.quantity=d,n(c));}).then(function(a){i.saveItems(),e.resolve(a);}),e.promise;},p=function(c,d){var e=l.defer();return i.getItems().then(function(a){var b=i.getItemById(c);if(b)return b.quantity+=d,n(c);}).then(function(){i.saveItems(),e.resolve();}),e.promise;},q=function(c,d,e,f,g,h,j){var k=l.defer();return i.getItems().then(function(a){var b=i.getItemById(c);return b?b.quantity+=f:a.push(m(c,d,e,f,g,h,j)),n(c);}).then(function(){i.saveItems(),k.resolve();}),k.promise;},r=function(a,b,c,d,e,f,g){return i.getItemById(a);},v=function(){return i.getItems();},t=function(){return i.reset();},u=function(c){var d=l.defer();return i.getItems().then(function(a){var b=i.getItemIndexById(c);(b||0===b)&&(a[b].quantity=0,a.splice(b,1));}).then(function(){i.saveItems(),d.resolve();}),d.promise;};return {updateQuantity:o,incrementQuantity:p,addItem:q,getItemById:r,listItems:v,deleteItem:u,emptyBasket:t};}]),angular.module("msShopModules",["msBasketManager"]),angular.module("msShopModules").directive("msAddItem",["$timeout","Config",function(g,h){return {restrict:"A",scope:{model:"=model",autoCompleteItems:"=autoCompleteItems"},templateUrl:h.GetSessionStoredValue("modulesDirectory")+"/msShopModules/addItem.html",link:function(b,c,d){g(function(){b.model;}),b.inputAdd="",b.buttonText=d.buttonText,b.label=d.label,b.showError=!1,g(function(){c.find("input.ui-autocomplete-input").attr("placeholder",d.placeholder);},500);var e,f=c.find("input");b.setErrorFalse=function(){g(function(){f.hasClass("ms-focused")||(b.showError=!1);},1500);},b.setError=function(){b.showError=!1,0===f.val().trim().length&&(b.showError="You must enter a name"),angular.forEach(b.model,function(a){if(f.val().trim().toLowerCase()===a.name.trim().toLowerCase())return void (b.showError="You've already added '"+f.val().trim()+"'");});},b.addItem=function(){if(g(function(){$(f).trigger("focus");}),b.setError(),b.showError)return !1;e={name:f.val(),options:[]},g(function(){$(f).val("");},100),b.model.push(e);};}};}]),angular.module("msShopModules").factory("AppRestangular",["Restangular",function(b){return b.withConfig(function(a){a.setBaseUrl("/");});}]),angular.module("msShopModules").factory("ApiRestangular",["Restangular","Config",function(b,c){return b.withConfig(function(a){a.setBaseUrl(c.GetEndPoint("siteApiEndpoint"));});}]),angular.module("msShopModules").factory("AppVersionService",["AppRestangular","ApiRestangular","HelperService",function(c,d,e){var f={};return f.getAppVersion=function(b){c.one("version.txt").get().then(function(a){b(a.data);},function(a){b(e.getMessage(a.data));});},f.getApiVersion=function(b){d.one("version").get().then(function(a){b(a.data);},function(a){b(e.getMessage(a.data));});},f;}]),angular.module("msShopModules").factory("$authShop",["Restangular","$window","$sessionStorage",function(b,c,d){var e={};e.isLoggedIn=function(){return void 0!==d.get("token")&&""!==d.get("token")&&"null"!==d.get("token")&&(void 0===b.defaultHeaders.Authorization&&f(),!0);},e.setToken=function(a){return d.put("token",a),f(),!0;},e.setIdToken=function(a){return d.put("idToken",a),f(),!0;},e.setShopId=function(a){return d.put("shopId",a),f(),!0;};var f=function(){b.setDefaultHeaders({"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+d.get("token"),"Authorization-Id":"Bearer "+d.get("idToken")});};return e;}]),angular.module("msShopModules").directive("msAutocomplete",["$timeout",function(h){return {restrict:"A",scope:{autoCompleteItems:"=autoCompleteItems",model:"=model"},link:function(d,e){if(d.model){d.autoCompleteItems=d.autoCompleteItems?d.autoCompleteItems:[],$(e).parent().addClass("ui-front"),$(e).autocomplete({source:d.autoCompleteItems,autoFocus:!0}).bind("focus",function(){$(this).autocomplete("search");});var f=d.autoCompleteItems,g=[];d.$watchCollection("model",function(c){f=d.autoCompleteItems,g=[],angular.forEach(c,function(a,b){g[b]=a.name;}),f=f.filter(function(a){return g.indexOf(a)<0;}),$(e).autocomplete("option",{source:f});});}}};}]),angular.module("msShopModules").directive("msAviary",["$timeout","HelperService","$window","$http","$sessionStorage",function(l,i,m,n,o){return {restrict:"A",scope:{images:"=msAviaryImages"},template:'<li data-ng-repeat="(key, img) in images">  <img ng-src="{{img.url}}"" id="img-{{key}}"" data-ng-click="launchEditor($index)"" width="300" /> </li>',link:function(g){var h,j,k={Authorization:"Bearer "+o.get("token"),"Content-Type":"image/jpeg"};j=new Aviary.Feather({apiKey:"166143ab5f52e45a",apiVersion:3,theme:"light",tools:"crop,brightness,contrast,orientation",cropPresets:["Original",["Square","1:1"],"3:2","5:3","4:3","5:4","6:4","7:5","10:8","16:9"],appendTo:"",onSave:function(e,f){h=document.getElementById(e),h.src=f,n({method:"POST",url:"http://192.168.1.160/api/upload",data:f,headers:k}).success(function(a,b,c,d){}).error(function(a,b,c,d){});},onError:function(a){alert(a.message);}}),g.launchEditor=function(a){return j.launch({image:"img-"+a,url:g.images[a].url}),!1;};}};}]),angular.module("msShopModules").directive("msDraggable",["$timeout",function(j){return {restrict:"A",transclude:!0,scope:{ngModel:"=msDraggable"},replace:!0,template:"<ul ng-transclude></ul>",link:function(c,d,e){var f,g,h;$(d).sortable({delay:150,revert:!0,scroll:!1,placeholder:"sortable-placeholder",cancel:".ui-state-disabled",forcePlaceholderSize:!0,forceHelperSize:!0,containment:"parent",axis:"y",tolerance:"pointer",start:function(a,b){f=$(b.item).index(),$(this).addClass("no-float");},update:function(a,b){$(this).removeClass("no-float"),g=$(b.item).index(),h=c.ngModel[f],c.ngModel.splice(f,1),c.ngModel.splice(g,0,h),$(this).children("li").eq(g).insertBefore($(this).children("li").eq(f)),c.$apply();}}).disableSelection().sortable("disable"),c.$watch("ngModel",function(a,b){a!==b&&c.ngModel.length>1&&$(d).sortable("enable");},!0);}};}]),angular.module("msShopModules").directive("msExpander",function(){return {restrict:"A",link:function(c,d,e){var f,g,h,j,k,l,i;d.on("click","a.edit",function(){function a(){if(f.hasClass("expanded"))return !1;d.find("li.expanded").removeClass("expanded"),d.find(".expander").not(":eq("+h+")").hide(),i.show(),f.addClass("expanded");}function b(){if(f.hasClass("expanded"))return !1;d.find("li.expanded").removeClass("expanded"),d.find(".expander").not(":eq("+h+")").slideUp(),i.slideDown(),f.addClass("expanded");}f=$(this).parents("li"),i=f.find(".expander"),g=f.outerHeight(),h=f.index(),j=i.outerHeight(),k=d.find("li.expanded").offset(),l=f.offset(),0===d.find("li.expanded").length?b():k.top===l.top?a():b();}).on("click","a.close",function(){i.slideUp(),f.removeClass("expanded");});}};}),angular.module("msShopModules").directive("msFilter",["$timeout","HelperService","Config",function(h,j,k){return {restrict:"A",scope:{searchQuery:"=msFilterSearchQuery",response:"=msFilterResponse",staticFilters:"=msStaticFilters"},templateUrl:k.GetSessionStoredValue("modulesDirectory")+"/msShopModules/filter.html",link:function(e,f){e.filtered={},void 0===e.searchQuery?e.searchQuery={Facets:{},PageNum:0,PageSize:10,Query:""}:void 0!==e.searchQuery.Facets&&(e.filtered=e.searchQuery.Facets),e.filterCount=0,e.setTagitVisibility=function(){e.tagitVisibilityClass=Object.keys(e.filtered).length>0;},e.setTagitVisibility(),e.removeActiveFilters=function(d){return angular.forEach(e.filtered,function(b,c){angular.forEach(b.Values,function(a){void 0!==d&&void 0!==d[c]&&void 0!==d[c][a]&&delete  d[c][a];});}),d;},e.$watch("response.FacetList",function(a){void 0!==a&&(e.filters=e.removeActiveFilters(e.response.FacetList));}),e.doSearch=function(){e.searchQuery.PageNum=0,e.setTagitVisibility();},e.$watch("searchQuery.Query",j.debounce(function(){e.searchQuery.Query=this.last;},500,!1)),e.addItem=function(a,b){e.filterCount++,void 0===e.filtered[a]&&(e.filtered[a]={Values:[]}),e.filtered[a].Values.push(b),e.filterGroupSelect=0,e.filterSelect=0,e.searchQuery.Facets=e.filtered,e.doSearch();},e.deleteItem=function(a,b){e.filterCount--,e.filtered[a].Values.splice(b,1),e.searchQuery.Facets=e.filtered,e.doSearch();};var g=f.find("select.select-value");e.triggerSelectValue=function(){h(function(){if(g.find("option.default").insertBefore(g.find("option:first-child")),g[0].selectedIndex=0,document.createEvent){var a=document.createEvent("MouseEvents");a.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),g[0].dispatchEvent(a);}else f.fireEvent&&g[0].fireEvent("onmousedown");});};}};}]),angular.module("msShopModules").filter("removeInvalidChars",function(){return function(a){return a.replace(/[^a-zA-Z\s]/g," ");};}).filter("fixedOrder",function(){return function(a){return a?Object.keys(a):[];};}).filter("addAnotherFilterHere",function(){return function(a){return a+"s";};}),angular.module("msShopModules").directive("msFocus",[function(){var f="ms-focused";return {restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$focused=!1,c.bind("focus",function(a){c.addClass(f),b.$apply(function(){e.$focused=!0;}),d.msFocus&&b.$eval(d.msFocus);}).bind("blur",function(a){c.removeClass(f),b.$apply(function(){e.$focused=!1;}),d.msFocusBlur&&b.$eval(d.msFocusBlur);});}};}]),angular.module("msShopModules").factory("HelperService",["$timeout","$rootScope","MessageModel",function(l,i,m){var n={};return n.combineArr=function(f){function g(a,b){for(var c=0,d=f[b].length;c<d;c++){var e=a.slice(0);e.push(f[b][c]),b===j?h.push(e):g(e,b+1);}}var h=[],j=f.length-1;return g([],0),h;},n.appendUrl=function(a){return a;},n.getMessage=function(a){var b=m.create();return void 0!==a&&void 0!==a.ModelState&&(b.title=a.Message,b.message=a.ModelState[""].join(", "),b.exception=a.ExceptionMessage),b;},n.setMesasge=function(a,b,c){var d=m.create();return d.title=a,d.message=b,d.exception=c,d;},n.getAvailableTags=function(a,b){return a.collection[b];},n.getTitle=function(a){for(var b=[],c=0;c<a.length;c++)void 0!==a[c].options&&a[c].options.length&&(b[c]=a[c].name);return b;},n.debounce=function(b,c,d){var e,f,g,h,j,k=function(){var a=(new Date).getTime()-h;a<c?e=l(k,c-a):(e=null,d||(j=b.apply(g,f),g=f=null));};return function(){g=this,f=arguments,h=(new Date).getTime();var a=d&&!e;return e||(e=l(k,c)),a&&(j=b.apply(g,f),g=f=null),j;};},n.getModelMessages=function(a){return i.rootMessage=a,a;},n;}]),angular.module("msShopModules").factory("ListModel",function(){var c;return c=function(){var a=this;a.FacetList={},a.ResourceList=[],a.SearchQuery={},a.TotalResults="";},{create:function(a){if(void 0!==a){var b=new c;return b.FacetList=a.FacetList?a.FacetList:{},b.ResourceList=a.ResourceList?a.ResourceList:[],b.SearchQuery=a.SearchQuery?a.SearchQuery:{},b.TotalResults=a.TotalResults?a.TotalResults:"",b;}return new c;}};}),angular.module("msShopModules").factory("listService",["Restangular",function(c){var d={};return d.search=function(a,b){return "products"===b?c.one("search/products").get(a):c.one(b).get(a);},d.remove=function(a,b){return c.one(b,a).remove();},d;}]),angular.module("msShopModules").directive("msMaxHeight",["$timeout","HelperService",function(q,r){return {restrict:"A",scope:{maxHeightModel:"=msMaxHeightModel"},transclude:!0,replace:!0,template:'<div ng-transclude class="max-height" style="max-height: {{msMaxHeight}}px; -webkit-transition: max-height .3s; transition: max-height .3s;"></div>',link:function(c,d,e){function f(){g=void 0===g?$("."+k[0]):g,h=void 0===h?$("."+k[1]):h,j=void 0===j?$("."+k[2]):j,i=void 0!==g?g.outerHeight(!0):0,m=void 0!==h?h.offset().top+h.outerHeight(!0):0,n=void 0!==j?j.outerHeight(!0):0,l=i-(m+n)-o,c.msMaxHeight=l||100;}if(e.msMaxHeight){var g,h,j,k=e.msMaxHeight.split(" "),l=0,i=0,m=0,n=0,o=e.msMaxHeightOffset?e.msMaxHeightOffset:0,p=$(window);p.on("resize",r.debounce(function(){f();},500,!1)),c.$watch("msMaxHeightModel",function(a,b){q(function(){f();},1e3);}),e.msMaxHeightOverflowYHidden&&$("."+e.msMaxHeightOverflowYHidden).css("overflow-y","hidden"),c.$on("$destroy",function(){$("."+e.msMaxHeightOverflowYHidden).attr("style",""),p.off("resize");});}}};}]),angular.module("msShopModules").factory("MessageModel",function(){var c;return c=function(){var a=this;a.title="",a.message="",a.exception="";},{create:function(a){if(void 0!==a){var b=new c;return b.title=a.title,b.message=a.message,b.exception=a.exception,b;}return new c;}};}),angular.module("msShopModules").directive("msModal",function(){return {restrict:"A",scope:{msAddshadow:"@"},link:function(a,b,c){var d=b.find(".modal"),e=b.find(".modal-open"),f=b.find(".modal-close");e.on("click",function(){d.before('<div class="modal-overlay"></div>'),d.addClass("show");}),f.on("click",function(){$(".modal-overlay").remove(),d.removeClass("show");});}};}),angular.module("msShopModules").factory("OrderModel",function(){var c=function(){var a=this;a.id="",a.customerName="",a.customerEmail="",a.customerPhone="",a.billing={},a.billing.name="",a.billing.company="",a.billing.phone="",a.billing.address={},a.billing.address.addressLine1="",a.billing.address.addressLine2="",a.billing.address.city="",a.billing.address.country="",a.billing.address.postCode="",a.shipping={},a.shipping.name="",a.shipping.company="",a.shipping.phone="",a.shipping.address={},a.shipping.address.addressLine1="",a.shipping.address.addressLine2="",a.shipping.address.city="",a.shipping.address.country="",a.shipping.address.postCode="",a.shippingMethod="",a.billingMethod="",a.orderItems=[],a.notes=[],a.status="New",a.tAndC="",a.tax="",a.total="",a.created="",a.modified="",a.modifiedBy="";};return {create:function(a){if(void 0===a)return new c;var b=new c;return b.id=a.id,b.customerName=a.customerName,b.customerEmail=a.customerEmail,b.customerPhone=a.phone,b.billing={},b.billing.name=a.billing.name,b.billing.company=a.billing.company,b.billing.phone=a.billing.phone,b.billing.address={},b.billing.address.addressLine1=a.billing.address.addressLine1,b.billing.address.addressLine2=a.billing.address.addressLine2,b.billing.address.city=a.billing.address.city,b.billing.address.country=a.billing.address.country,b.billing.address.postCode=a.billing.address.postCode,b.shipping={},b.shipping.name=a.shipping.name,b.shipping.company=a.shipping.company,b.shipping.phone=a.shipping.phone,b.shipping.address={},b.shipping.address.addressLine1=a.shipping.address.addressLine1,b.shipping.address.addressLine2=a.shipping.address.addressLine2,b.shipping.address.city=a.shipping.address.city,b.shipping.address.country=a.shipping.address.country,b.shipping.address.postCode=a.shipping.address.postCode,b.shippingMethod=a.shippingMethod,b.billingMethod=a.billingMethod,b.orderItems=a.orderItems,b.notes=a.orderNotes,b.status=a.status,b.tAndC=a.termsAndCondition,b.tax="",b.total=a.totalAmount,b.created="",b.modified="",b.modifiedBy="",b;}};}),angular.module("msShopModules").factory("OrderService",["ShopRestangular","$q",function(f,g){var h=function(b){for(var c={},d=0;b[d];d++)c[b[d].id]=b[d].quantity;var e=g.defer();return f.all("orders").post(c).then(function(a){e.resolve(a.data);},function(a){e.resolve(a);}),e.promise;};return {GetAllOrder:function(c){var d=g.defer();return c=c||"All",f.one("orders/"+c+"/list").get().then(function(a){var b=a.data;d.resolve(b);},function(a){d.resolve(a);}),d.promise;},GetOrderById:function(c){var d=g.defer();return f.one("orders",c).get().then(function(a){var b=a.data;d.resolve(b);},function(a){d.resolve(a);}),d.promise;},createOrder:h,UpdateOrderStatus:function(b,c){var d=g.defer(),e={Status:c};return f.all("orders/"+b+"/status").customPUT(e).then(function(a){d.resolve(a);},function(a){d.resolve(a);}),d.promise;}};}]),angular.module("msShopModules").directive("msPager",["Config",function(h){return {restrict:"A",scope:{searchQuery:"=msSearchQuery",response:"=msPagerResponse"},templateUrl:h.GetSessionStoredValue("modulesDirectory")+"/msShopModules/pager.html",link:function(e){void 0===e.searchQuery&&(e.searchQuery={Facets:{},PageNum:0,PageSize:10,Query:""});var f,g=[];e.$watch("response",function(a){if(void 0!==a&&a.TotalResults){if(f=Math.ceil(a.TotalResults/e.searchQuery.PageSize),e.totalPages=a.TotalResults>1?f:0,g=[],e.searchQuery.PageNum+1<=3)for(var b=0;b<5;b++)g.push(b+1);else if(e.searchQuery.PageNum+1<f-2)for(var c=e.searchQuery.PageNum-2;c<e.searchQuery.PageNum+3;c++)g.push(c+1);else if(e.searchQuery.PageNum+1>=f-3)for(var d=f-5;d<f;d++)g.push(d+1);e.pageNumbers=g;}else e.pageNumbers=0,e.totalPages=0;},!0),e.first=function(){e.searchQuery.PageNum=0;},e.back=function(){e.searchQuery.PageNum--;},e.next=function(){e.searchQuery.PageNum++;},e.last=function(){e.searchQuery.PageNum=e.totalPages-1;},e.goTo=function(a){e.searchQuery.PageNum=a-1;};}};}]),angular.module("msShopModules").factory("ProductListModel",function(){var c;return c=function(){var a=this;a.FacetList={},a.ProductList=[],a.SearchQuery={},a.Total="";},{create:function(a){if(void 0!==a){var b=new c;return b.FacetList=a.FacetList,b.ResourceList=a.ResourceList,b.SearchQuery=a.SearchQuery,b.TotalResults=a.TotalResults,b;}return new c;}};}),angular.module("msShopModules").factory("ProductModel",function(){return {create:function(a){return void 0===a?{name:"",description:"",images:[],attributes:[],variants:[],categories:[],tags:[],fields:[],published:!1,productSettings:{taxSettings:{taxExempt:!1},additionalShipping:0}}:{id:a.id,name:a.name,description:a.description,images:a.images,attributes:a.attributes.ResourceList,variants:a.variants.ResourceList,categories:a.categories,tags:a.tags,fields:a.fields,published:a.published,productSettings:a.productSettings};}};}),angular.module("msShopModules").factory("ProductService",["ShopRestangular","$q",function(e,f){var g,h={},j=0;return h.getAll=function(b){if(!g||b){var c=f.defer();e.one("products","").get().then(function(a){return a&&a.data&&a.data.ResourceList?a.data.ResourceList:[];},function(a){if(++j<=5)return h.getAll(!0);}).then(function(a){c.resolve(a);}),g=c.promise;}return g;},h.get=function(c){var d=f.defer();return e.one("products",c).get().then(function(a){var b=a.data;d.resolve(b);},function(a){d.resolve(a);}),d.promise;},h.save=function(a){return g=void 0,e.all("products").post(a);},h.update=function(a,b){return g=void 0,e.all("products/"+a).customPUT(b);},h.remove=function(a){return g=void 0,e.all("products/"+a).remove();},h;}]),angular.module("msShopModules").directive("msAddshadow",function(){return {restrict:"A",scope:{msAddshadow:"@"},link:function(a,b,c){var d=$("."+a.msAddshadow).scrollTop();$("."+a.msAddshadow).on("scroll",function(){d>5?b.addClass("shadow"):b.removeClass("shadow");});}};}),angular.module("msShopModules").factory("ShopModel",function(){var c=function(){var a=this;a.owner="",a.categories=["Food","Fruit","Baby","Clothes","Jeans","Book"],a.tags=["Food","Fruit","Baby","Clothes","Jeans","Book","3D","Adsense","advertising","AJAX","animation","Apps","Art","ASCII","Avatars","Backgrounds","Best Of","Best Practices","blogging","Books","branding","Browsers","brushes","Business","Business cards","buttons","Calendars","Calligraphy","cartoons","carts","CG","charts","Cheat Sheets","Christmas","Clients","CMS","CMYK","coding","colors","Communication","Community","Conferences","Content","Contests","contracts","Copywriting","corporate","covers","Creativity","CSS","data visualization","Design","development","diagrams","Discussions","domains","Downloads","drawing","dreamweaver","E-Commerce","eBooks","editors","Email","Emotional Design","Errors","Events","FAQ","favicons","Flash","Fonts","Forms","Freebies","Free Fonts","gadgets","galleries","Global Web Design","Google","Graphics","grids","guidelines","halloween","Icons","ideas","illustrations","Illustrator","Infographics","innovation","Inspiration","Internet Explorer","Interviews","layouts","legacy","logo design","Mac","magazines","Marketing","movies","Music","Navigation","Open Source","Opinion Column","optimization","paintings","PDF","Performance","Photography","Photoshop","Portfolios","Posters","principles","print","Process","productivity","PSD","psychology","retro","reviews","SEO","Showcases","signs","Skills","Smashing Book","Smashing Daily","Smashing Library","Smashing Magazine","Social","software","Studies","Techniques","Templates","testing","Textures","The Lost Files","Themes","The Smashing Newsletter","time management","time savers","Tools","Trends","Tutorials","Twitter","Typography","Useful","User Interaction","vectors","Videos","vintage","visualizations","Wallpapers","Web","web 2.0","Web Design","weblogs","Wireframing","WordPress","Workflow"],a.attributes=["Colour","Size","Material"],a.fields=["Author"],a.productTypes=["Food","Fruit","Book"],a.collection={Author:["Bob","Jimi"],RAM:["1mb","green","blue"],Colour:["red","green","blue"],Material:["plastic","metal","fiber"],Size:["small","medium","large","1","2","3","4","5","6","7","8","9","10"]};};return {create:function(a){if(void 0===a)return new c;var b=new c;return b.owner=a.owner,b.categories=a.categories,b.attributes=a.attributes,b.fields=a.fields,b.productTypes=a.productTypes,b.collection=a.collection,b;}};}),angular.module("msShopModules").factory("ShopService",["MenuRepository","MenuManager","ShopRestangular","$q","$locale",function(f,g,h,j,k){var l,i=function(){var c=j.defer();return h.one("categories").get().then(function(a){var b=a.data;c.resolve(b);},function(a){c.resolve(a);}),c.promise;},m=function(){var c=j.defer();return h.one("categoryhierarchies").get().then(function(a){var b=a.data;c.resolve(b.categoryHierarchies);},function(a){c.resolve(a);}),c.promise;},n=function(b){var c=j.defer();return h.all("categoryhierarchies").customPUT({categoryHierarchies:b}).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},o=function(){q().then(function(a){var b;a.Currency&&a.Currency.Symbol&&(b=a.Currency.Symbol),p({symbol:b||"\xa3"});});},p=function(a){k.NUMBER_FORMATS.CURRENCY_SYM=a.symbol||k.NUMBER_FORMATS.CURRENCY_SYM,k.NUMBER_FORMATS.DECIMAL_SEP=a.decimal||k.NUMBER_FORMATS.DECIMAL_SEP,k.NUMBER_FORMATS.GROUP_SEP=a.GROUP_SEP||k.NUMBER_FORMATS.GROUP_SEP;},q=function(){if(!l){var c=j.defer();h.one("").get().then(function(a){var b=a.data;c.resolve(b);},function(a){c.resolve(a);}),l=c.promise;}return l;},r=function(){var c=j.defer();return h.one("checkoutinfo").get().then(function(a){var b=a.data;c.resolve(b);},function(a){c.resolve(a);}),c.promise;},v=function(){var c=j.defer();return h.one("stocksettings").get().then(function(a){var b=a.data;c.resolve(b);},function(a){c.resolve(a);}),c.promise;},t=function(b){var c=j.defer();return h.all("address").customPUT(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},u=function(b,c,d){var e=j.defer();return h.all("").customPUT({TimezoneCode:b,CurrencyCode:c,UnitCode:d}).then(function(a){l=void 0,e.resolve(a);},function(a){e.resolve(a);}),e.promise;},w=function(b){var c=j.defer();return h.all("paymentgateways").customPUT(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},x=function(b){var c=j.defer();return h.all("stocksettings").customPUT(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;};return {GetCategories:i,GetShop:q,GetShopCheckoutInfo:r,GetShopStockManagementSettings:v,UpdateShopAddress:t,UpdateShopPaymentGateways:w,UpdateShopShippingSettings:function(b){var c=j.defer();return h.all("shipping").customPUT(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},SetCurrency:p,SetAppCurrencyFromShopSettings:o,updateShopLocalSettings:u,getCategoryHierarchies:m,updateCategoryHierarchies:n,UpdateShopStockManagementSettings:x};}]),angular.module("msShopModules").directive("msTagit",["$timeout",function(h){return {restrict:"A",scope:{tagsAvailable:"=tagsAvailable"},require:"?ngModel",link:function(c,d,e,f){function g(){var a=d.val();void 0!==a&&a.length&&(a=a.split(",")),f.$setViewValue(a);}f&&($(d).parent().addClass("ui-front"),h(function(){$(d).tagit({availableTags:c.tagsAvailable,itemName:"item",showAutocompleteOnFocus:!0,placeholderText:"Type here...",allowSpaces:!0,onTagExists:function(a,b){return b.existingTag.addClass("tag-used").attr("data-used-tag","This tag exists"),h(function(){b.existingTag.removeClass("tag-used");},1500),!1;},afterTagAdded:function(a,b){b.duringInitialization||c.$apply(g);},afterTagRemoved:function(a,b){b.duringInitialization||c.$apply(g);}}).next(".tagit").addClass(e.ngClass),g();},150,!1));}};}]),angular.module("msShopModules").directive("msToDigit",function(){return function(b,c,d){var e=[8,9,37,39,46,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,110,190];c.bind("keydown",function(a){-1!==$.inArray(a.which,e)&&!0!==a.shiftKey||a.preventDefault();});};}),angular.module("msShopModules").factory("UnauthorizedInterceptor",["$q","$location",function(b,c){return {responseError:function(a){return 401===a.status?(c.path("/login"),b.reject(a)):b.reject(a);}};}]),angular.module("msShopModules").directive("msUploadDuplicated",["$timeout","Config","$window","$sessionStorage",function(i,m,n,o){return {restrict:"A",scope:{files:"=msUpload",title:"@msTitle",enableMultiple:"=msEnableMultiple"},templateUrl:m.GetSessionStoredValue("modulesDirectory")+"/msShopModules/upload.html",link:function(e,f){function g(a){switch(e.height=a<=3?"100%":"50%",a){case 1:e.cols=24;break;case 3:e.cols=8;break;default:e.cols=12;}}var h={Authorization:"Bearer "+o.get("token")};e.$on("fileuploaddone",function(a,b){b.headers=h;for(var c=b._response.result,d=0;c[d];)e.files.push({url:c[d].Url}),d++;}),e.$on("fileuploadadd",function(a,b){b.headers=h,b.url=m.GetEndPoint("siteApiEndpoint")+"shops/"+b.scope.$parent.$root.shopId+"/upload",e.$parent.fileLoadingClass=" loading",e.fileLoadingError=!1;}),e.$on("fileuploadstop",function(){e.$parent.fileLoadingClass="";}),e.$on("fileuploadfail",function(){e.$parent.fileLoadingError=!0;});var j;e.$on("fileuploaddragover",function(){i(function(){e.$parent.fileDragOverClass="file-drag-over";}),i.cancel(j),j=i(function(){e.$parent.fileDragOverClass=!1;},100);}),e.$on("fileuploaddrop",function(){e.$parent.fileDragOverClass=!1;}),e.deleteItem=function(a){e.files.splice(a,1);};var k,l;e.setActive=function(a){0!==a&&(l=f.find(".grid"),k=e.files[a],e.files.splice(a,1),l.animate({scrollTop:"0"}),i(function(){e.files.unshift(k);},300));},e.$watch("files.length",function(a,b){a!==b&&g(a);});}};}]),angular.module("msShopModules").factory("UserModel",function(){var c=function(){var a=this;a.UserName="",a.Password="",a.PasswordConfirm="";};return {create:function(a){if(void 0===a)return new c;var b=new c;return b.UserName=a.name,b;}};}),angular.module("msShopModules").factory("UserService",["Restangular","HelperService","$window","$sessionStorage",function(c,d,e,f){var g={};return f.put("token",void 0),g.register=function(a){return c.all("account/register").post(a,{});},g.login=function(a){var b="grant_type=password&username="+a.UserName+"&password="+a.Password;return c.all("token").post(b,{"Content-Type":"application/x-www-form-urlencoded"});},g;}]),angular.module("msShopModules").factory("VariantService",["ShopRestangular","$q",function(f,g){return {Generate:function(b){var c=b,d=g.defer();return f.all("variants").post(c,{}).then(function(a){d.resolve(a);},function(a){d.resolve(a);}),d.promise;},Regenerate:function(b,c){var d=c,e=g.defer();return f.all("products/"+b+"/regeneratevariants").post(d,{}).then(function(a){e.resolve(a);},function(a){e.resolve(a);}),e.promise;}};}]),angular.module("msShopModules").directive("msVersionDuplicated",["$http","AppVersionService",function(d,e){return {restrict:"A",replace:!0,scope:!1,template:"<span>We're running </br> API Version: {{ version.api.build }} </br>  APP Version: {{ version.app.build }} </span>",link:function(b){var c={};e.getAppVersion(function(a){c.app={build:a};}),e.getApiVersion(function(a){c.api=a,b.version=c;});}};}]),function(m){m.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null},_create:function(){var f=this;this.element.is("input")?(this.tagList=m("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last(),this.tagInput=m('<input type="text" />').addClass("ui-widget-content"),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(b,c){var d=b.term.toLowerCase(),e=m.grep(this.options.availableTags,function(a){return 0===a.toLowerCase().indexOf(d);});this.options.allowDuplicates||(e=this._subtractArray(e,this.assignedTags())),c(e);}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(a,b){f._showAutocomplete();}),void 0===this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0)),m.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=m.proxy(this.options.autocomplete.source,this)),m.isFunction(this.options.tagSource)&&(this.options.tagSource=m.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(m('<li class="tagit-new"></li>').append(this.tagInput)).click(function(a){var b=m(a.target);if(b.hasClass("tagit-label")){var c=b.closest(".tagit-choice");c.hasClass("removed")||f._trigger("onTagClicked",a,{tag:c,tagLabel:f.tagLabel(c)});}else f.tagInput.focus();});var g=!1;if(this.options.singleField)if(this.options.singleFieldNode){var h=m(this.options.singleFieldNode),j=h.val().split(this.options.singleFieldDelimiter);h.val(""),m.each(j,function(a,b){f.createTag(b,null,!0),g=!0;});}else this.options.singleFieldNode=m('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);if(g||this.tagList.children("li").each(function(){m(this).hasClass("tagit-new")||(f.createTag(m(this).text(),m(this).attr("class"),!0),m(this).remove());}),this.tagInput.keydown(function(a){if(a.which==m.ui.keyCode.BACKSPACE&&""===f.tagInput.val()){var b=f._lastTag();!f.options.removeConfirmation||b.hasClass("remove")?f.removeTag(b):f.options.removeConfirmation&&b.addClass("remove ui-state-highlight");}else f.options.removeConfirmation&&f._lastTag().removeClass("remove ui-state-highlight");(a.which===m.ui.keyCode.COMMA&&!1===a.shiftKey||a.which===m.ui.keyCode.ENTER||a.which==m.ui.keyCode.TAB&&""!==f.tagInput.val()||a.which==m.ui.keyCode.SPACE&&!0!==f.options.allowSpaces&&('"'!=m.trim(f.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==m.trim(f.tagInput.val()).charAt(0)&&'"'==m.trim(f.tagInput.val()).charAt(m.trim(f.tagInput.val()).length-1)&&m.trim(f.tagInput.val()).length-1!=0))&&(a.which===m.ui.keyCode.ENTER&&""===f.tagInput.val()||a.preventDefault(),f.options.autocomplete.autoFocus&&f.tagInput.data("autocomplete-open")||(f.tagInput.autocomplete("close"),f.createTag(f._cleanedInput())));}).blur(function(a){f.tagInput.data("autocomplete-open")||f.createTag(f._cleanedInput());}),this.options.availableTags||this.options.tagSource||this.options.autocomplete.source){var k={select:function(a,b){return f.createTag(b.item.value),!1;}};m.extend(k,this.options.autocomplete),k.source=this.options.tagSource||k.source,this.tagInput.autocomplete(k).bind("autocompleteopen.tagit",function(a,b){f.tagInput.data("autocomplete-open",!0);}).bind("autocompleteclose.tagit",function(a,b){f.tagInput.data("autocomplete-open",!1);}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete");}},destroy:function(){return m.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){m(this).hasClass("tagit-new")?m(this).remove():(m(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),m(this).text(m(this).children(".tagit-label").text()));}),this.singleFieldNode&&this.singleFieldNode.remove()),this;},_cleanedInput:function(){return m.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"));},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)");},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)");},assignedTags:function(){var a=this,b=[];return this.options.singleField?(b=m(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),""===b[0]&&(b=[])):this._tags().each(function(){b.push(a.tagLabel(this));}),b;},_updateSingleTagsField:function(a){m(this.options.singleFieldNode).val(a.join(this.options.singleFieldDelimiter)).trigger("change");},_subtractArray:function(a,b){for(var c=[],d=0;d<a.length;d++)-1==m.inArray(a[d],b)&&c.push(a[d]);return c;},tagLabel:function(a){return this.options.singleField?m(a).find(".tagit-label:first").text():m(a).find("input:first").val();},_showAutocomplete:function(){this.tagInput.autocomplete("search","");},_findTagByLabel:function(b){var c=this,d=null;return this._tags().each(function(a){if(c._formatStr(b)==c._formatStr(c.tagLabel(this)))return d=m(this),!1;}),d;},_isNew:function(a){return !this._findTagByLabel(a);},_formatStr:function(a){return this.options.caseSensitive?a:m.trim(a.toLowerCase());},_effectExists:function(a){return Boolean(m.effects&&(m.effects[a]||m.effects.effect&&m.effects.effect[a]));},createTag:function(b,c,d){var e=this;if(b=m.trim(b),this.options.preprocessTag&&(b=this.options.preprocessTag(b)),""===b)return !1;if(!this.options.allowDuplicates&&!this._isNew(b)){var f=this._findTagByLabel(b);return !1!==this._trigger("onTagExists",null,{existingTag:f,duringInitialization:d})&&this._effectExists("highlight")&&f.effect("highlight"),!1;}if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:d}),!1;var g=m(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(b),h=m("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(g);if(this.options.readOnly)h.addClass("tagit-choice-read-only");else{h.addClass("tagit-choice-editable");var j=m("<span></span>").addClass("ui-icon ui-icon-close"),k=m('<a><span class="text-icon">\xd7</span></a>').addClass("tagit-close").append(j).click(function(a){e.removeTag(h);});h.append(k);}if(!this.options.singleField){var l=g.html();h.append('<input type="hidden" value="'+l+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />');}if(!1!==this._trigger("beforeTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d})){if(this.options.singleField){var i=this.assignedTags();i.push(b),this._updateSingleTagsField(i);}this._trigger("onTagAdded",null,h),this.tagInput.val(""),this.tagInput.parent().before(h),this._trigger("afterTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d}),this.options.showAutocompleteOnFocus&&!d&&setTimeout(function(){e._showAutocomplete();},0);}},removeTag:function(b,c){if(c=void 0===c?this.options.animate:c,b=m(b),this._trigger("onTagRemoved",null,b),!1!==this._trigger("beforeTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})){if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(b);d=m.grep(d,function(a){return a!=e;}),this._updateSingleTagsField(d);}if(c){b.addClass("removed");var f=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],g=this;f.push(function(){b.remove(),g._trigger("afterTagRemoved",null,{tag:b,tagLabel:g.tagLabel(b)});}),b.fadeOut("fast").hide.apply(b,f).dequeue();}else b.remove(),this._trigger("afterTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)});}},removeTagByLabel:function(a,b){var c=this._findTagByLabel(a);if(!c)throw "No such tag exists with the name '"+a+"'";this.removeTag(c,b);},removeAll:function(){var c=this;this._tags().each(function(a,b){c.removeTag(b,!1);});}});}(jQuery),angular.module("msContentItemShop",["msBasketManager","msShopModules"]),angular.module("msContentItemShop").filter("paginate",function(){return function(a,b){var c=[];if(!a)return c;b=b||{},b.page=b.page||0,b.pageSize=b.pageSize||6;var d=b.page*b.pageSize,e=d+b.pageSize;b.pages=[];var f=Math.ceil(a.length/b.pageSize);b.page=Math.max(0,b.page),b.page=Math.min(f-1,b.page);for(var g=0;g<f;g++)b.pages.push(g);for(var h=d;a[h]&&h<e;h++)c.push(a[h]);return c;};}),angular.module("msContentItemShop").directive("msShopAddToCart",["BasketManager","Config",function(g,h){return {restrict:"AE",replace:!0,scope:{product:"=",variant:"=",disabled:"=",showRemove:"@"},templateUrl:h.GetSessionStoredValue("modulesDirectory")+"/msContentItemShop/msShopAddToCart.tpl.html",link:function(c,d,e){c.setShowQuantityHigherThanStockLevelMessage=function(a){c.$parent&&c.$parent.useStockLevels&&(!1===c.$parent.allowOutOfStockOrders&&a>c.variant.StockLevel?c.variant.showQuantityHigherThanStockLevelMessage=!0:!1===c.$parent.allowOutOfStockOrders&&(c.variant.showQuantityHigherThanStockLevelMessage=!1));};var f=function(){if(!c.product)return c.item=c.product,void (c.$parent.productVariant&&(c.$parent.productVariant.Quantity=c.item.quantity));var a=c.product.id;if(c.variant&&c.variant.VariantId&&(a=c.variant.VariantId),a){c.item=g.getItemById(a);var b=c.item?c.item.quantity:c.variant.Quantity;c.setShowQuantityHigherThanStockLevelMessage(b),c.showVariantMessage=!1;}else c.showVariantMessage=!0;};c.removeFromBasket=function(a){g.deleteItem(a.id);},c.increaseQuantity=function(a){a.quantity++,c.$parent.productVariant&&(c.$parent.productVariant.Quantity=a.quantity),c.setShowQuantityHigherThanStockLevelMessage(a.quantity);},c.decreaseQuantity=function(a){var b=a.quantity-1;0===b?c.removeFromBasket(a):a.quantity=b,c.$parent.productVariant&&(c.$parent.productVariant.Quantity=a.quantity),c.setShowQuantityHigherThanStockLevelMessage(a.quantity);},c.$watch("product",function(){f();}),c.$watch("variant",function(){f();}),c.$watch("item.quantity",function(a,b){null!==a&&0===a&&b!==a&&(f(),c.item&&c.removeFromBasket(c.item));}),c.addToCart=function(a,b){b||(b=1,c.$parent.productVariant&&(c.$parent.productVariant.Quantity=b)),g.addItem(c.variant.VariantId,a.Name,a.Images[0],b,c.variant.Price,c.variant.AttributeOptions,c.variant.StockLevel).then(function(){f();});};}};}]),angular.module("msContentItemShop").directive("msContentItemShopCategory",["$compile","ShopService","Config",function(k,l,i){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},template:"<div></div>",link:function(d,e){var f=function(a){var b=a.param1,c="ms-content-item-shop-product-list";switch(b){case "products":d.$emit("maincontentItem",{context:"shop",type:"product",id:a.param2}),c="ms-content-item-shop-product";break;case "basket":d.$emit("maincontentItem",{context:"shop",type:"basket"}),c="ms-content-item-shop-basket";break;case "categories":d.$emit("maincontentItem",{context:"shop",type:"category",id:a.param2}),c="ms-content-item-shop-product-list";break;default:c="ms-content-item-shop-product-list";}return '<div><div ng-hide="!contentItemMetaData.loading" style="position: absolute;margin-left: 50%;margin-top: 10%;">Loading...</div><div '+c+' content-item-data="contentItemData" content-item-meta-data="contentItemMetaData"></div></div>';},g=function(){var a=i.GetEndPoint("modulesDirectory")+"/msContentItemShop/shop.css";$('link[href="'+a+'"]').length||$("head").append('<link href="http://www.shawnkatz.com/scripts/'+a+'" type="text/css" rel="stylesheet" />');},h=function(){l.GetShop().then(function(a){var b;a.Currency&&a.Currency.Symbol&&(b=a.Currency.Symbol);var c={symbol:b||"\xa3"};l.SetCurrency(c),j();});},j=function(){k(f((d.contentItemMetaData||{}).urlParams))(d,function(a){e.html(a);});};g(),h();}};}]),angular.module("msContentItemShopBasket",["msBasketManager","msShopModules"]),angular.module("msContentItemShopBasket").directive("msContentItemShopBasket",["$compile","OrderService","ShopService","BasketManager","Config","$window",function(l,i,m,n,o,p){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:o.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopBasket/msShopBasket.tpl.html",link:function(f,g,h){f.svgUrl=function(a){return o.GetEndPoint("modulesDirectory")+"/msContentItemShop/sprites.svg#"+a;},f.checkoutInfo={HasPaymentGateway:!0},f.disableCheckoutButtons=!1,f.cartItemQuantityHigherThanAvailableStock=!1;var j=function(a){if(f.stockSettings&&f.stockSettings.UseStockLevels){for(var b=!1,c=0;c<a.length;c++){var d=a[c];if(d.quantity>d.stockLevel){b=!0;break;}}f.cartItemQuantityHigherThanAvailableStock=b,f.disableCheckoutButtons=!f.stockSettings.EnableBuyButtonWhenProductOutOfStock&&!0===f.cartItemQuantityHigherThanAvailableStock;}};m.GetShopCheckoutInfo().then(function(a){f.checkoutInfo=a;}),m.GetShopStockManagementSettings().then(function(a){f.stockSettings=a,f.cart&&j(f.cart);}),f.goToCheckout=function(){f.disableCheckoutButtons||i.createOrder(f.cart).then(function(a){if(!a||500!==a.status){var b=o.GetEndPoint("checkoutEndpoint"),c=o.GetSessionStoredValue("siteId");n.emptyBasket(),p.location.href=b+"Checkout/Index/"+c+"/"+a;}});},f.checkoutWithPayPal=function(){f.disableCheckoutButtons||i.createOrder(f.cart).then(function(a){if(!a||500!==a.status){var b=o.GetEndPoint("checkoutEndpoint"),c=o.GetSessionStoredValue("siteId");n.emptyBasket(),p.location.href=b+"Checkout/Ecs/"+c+"/"+a;}});},f.removeItem=function(a){n.deleteItem(a.id);},f.goToShop=function(){f.contentItemMetaData.setUrlParamsByPageType("shop");};var k=function(a){for(var b=0,c=0;a&&a[c];c++){var d=a[c],e=d.quantity*d.price;b+=Math.round(100*e)/100;}f.total=Math.round(100*b)/100;};f.$watch("cart",function(a){k(a),j(a);},!0),n.listItems().then(function(a){f.cart=a,j(a);});}};}]),angular.module("msContentItemShopMiniCart",["msBasketManager","msShopModules"]),angular.module("msContentItemShopMiniCart").directive("msContentItemShopMiniBasket",["BasketManager","Config",function(l,i){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:i.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopMiniCart/msShopMiniCart.tpl.html",link:function(f,g,h){var j=function(a){for(var b=0,c=0;a&&a[c];c++){var d=a[c],e=d.quantity*d.price;b+=Math.round(100*e)/100;}f.total=Math.round(100*b)/100;},k=function(a){for(var b=0,c=0;a&&c<a.length;c++){b+=a[c].quantity;}f.cartSize=b;};f.svgUrl=function(a){return i.GetEndPoint("modulesDirectory")+"/msContentItemShop/sprites.svg#"+a;},f.$watch("cart",function(a){j(a),k(a);},!0),l.listItems().then(function(a){f.cart=a;}),f.showCartAction=function(){f.contentItemMetaData.setUrlParamsByPageType("shop","basket");},g.on("click",function(){$(window).width()<=640&&(f.showCartAction(),f.$apply());});}};}]),angular.module("msContentItemShopProduct",["msBasketManager","msShopModules"]),angular.module("msContentItemShopProduct").directive("msContentItemShopProduct",["$compile","ShopService","ProductService","Config","$sce","msLightbox",function(z,A,C,B,E,F){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:B.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopProduct/msShopProduct.tpl.html",link:function(i,m){i.back=function(){i.contentItemMetaData.setUrlParamsByPageType("shop");},A.GetShop().then(function(a){i.unit=a.Unit,i.useStockLevels=a.StockSettings.UseStockLevels,i.hideOutOfStockProducts=a.StockSettings.HideProductWhenOutOfStock,i.allowOutOfStockOrders=a.StockSettings.EnableBuyButtonWhenProductOutOfStock,i.showStockLevel=a.StockSettings.ShowStockLevel,i.outOfStockOrdersMessage=a.StockSettings.OutOfStockOrdersMessage;});var n=function(a){return "_"+a+"_";},o=[];i.productVariant=void 0;var p=function(a,b){if(a&&b)for(var c=0;a[c];c++){for(var d=a[c],e=!0,f=0;d.AttributeOptions[f];f++){var g=d.AttributeOptions[f],h=n(g.Key);if(b[h]!==g.Value){e=!1;break;}}if(e)return d;}};i.checkValues=function(a,b){if(i.product){if(a){var c=n(a);o[c]=b;}i.productVariant=p(i.product.Variants,o),i.productVariant?i.disableAddtoCartButton=i.useStockLevels&&!i.allowOutOfStockOrders&&0===i.productVariant.StockLevel:i.useStockLevels;}};var q=function(){if(i.product)if(i.product.Variants){for(var a=i.product.Variants[0].Price,b=i.product.Variants[0].Price,c=0;c<i.product.Variants.length;c++){var d=i.product.Variants[c];d.Price<a&&(a=d.Price),d.Price>b&&(b=d.Price);}i.product.PriceRange={Min:a,Max:b,Same:a===b};}else i.product.PriceRange={};},r=function(a,b){for(var c=i.product.Variants,d=0;c[d];d++)for(var e=c[d],f=0;f<e.AttributeOptions.length;f++){var g=e.AttributeOptions[f];if(g.Key===a&&g.Value===b&&e.StockLevel>0)return !1;}return !0;},v=function(b){b.resetForCurrentSelection=function(){for(var a=0;a<this.Options.length;a++)this.Options[a].resetForCurrentSelection();};},t=function(a){a.resetForCurrentSelection=function(){this.outOfStockForCurrentSelection=!1;};},u=function(){if(!i.useStockLevels)return void (i.stockAwareProductAttributes={attributes:{collection:[]},resetForCurrentSelection:function(){},findByAttributeNameAndValue:function(a,b){}});i.stockAwareProductAttributes={attributes:{collection:angular.copy(i.product.Attributes),resetForCurrentSelection:function(){for(var a=0;a<this.collection.length;a++)this.collection[a].resetForCurrentSelection();},setOutOfStockForCurrentSelectionByAttributeNameAndValue:function(a,b){for(var c,d=0;d<this.collection.length;d++)if(this.collection[d].Name===a){c=this.collection[d];break;}if(c)for(var e=c.Options,f=0;f<e.length;f++)if(e[f]===b){e[f].outOfStockForCurrentSelection=!0;break;}}}};for(var g=0;g<i.stockAwareProductAttributes.attributes.collection.length;g++)v(i.stockAwareProductAttributes.attributes.collection[g]);for(var h=0;h<i.stockAwareProductAttributes.attributes.collection.length;h++)for(var j=i.stockAwareProductAttributes.attributes.collection[h],k=0;k<j.Options.length;k++){var l=j.Options[k];j.Options[k]={value:l,allOutOfStock:r(j.Name,l),outOfStockForCurrentSelection:!1},t(j.Options[k]);}},w=function(e){if(!e)return void (i.error="Product not defined");i.contentItemMetaData.loading=!0,C.get(e).then(function(a){if(o=[],i.contentItemMetaData.loading=!1,delete  i.error,delete  i.product,a.status)i.error="Error product not found";else{i.product=a;var b=angular.copy(i.product.Images);i.product.Images=[];for(var c=0;c<b.length;c++){var d=b[c];d&&i.product.Images.push(d);}i.product.Description=E.trustAsHtml(i.product.Description),u(),i.checkValues(),q();}});},x="shop-product"===i.contentItemData.type;i.openImage=function(a){F.open({items:i.product.Images,index:a,position:"bottom"});};var y;i.showLeftBar=!0,i.showBackToShopButton=!0,x?(i.$watch("contentItemData.settings.productId",function(a){w(a);}),i.showLeftBar=!1,i.showBackToShopButton=!1):i.contentItemMetaData&&i.contentItemMetaData.urlParams&&i.contentItemMetaData.urlParams.param2&&(y=i.contentItemMetaData.urlParams.param2,w(y));}};}]),angular.module("msContentItemShopProduct").directive("msContentItemShopProductSettings",["$compile","ProductService",function(d,e){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Product Id</label><select ng-model="settings.productId" ng-options="product.ProductId as product.Name for product in products"><option>--Choose a product--</option></select></div></div></div>',link:function(b,c){e.getAll().then(function(a){b.products=a;});}};}]),angular.module("msContentItemShopProductList",["msBasketManager","msShopModules"]),angular.module("msContentItemShopProductList").directive("msShopSearch",["Config",function(f){return {restrict:"AE",replace:!0,scope:{searchText:"=",category:"="},templateUrl:f.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopProductList/msShopSearch.tpl.html",link:function(b,c,d){b.svgUrl=function(a){return f.GetEndPoint("modulesDirectory")+"/msContentItemShop/sprites.svg#"+a;};var e=c.find("div.title")||c;e&&e.length||(e=c),e.on("click",function(a){$(window).width()<=640&&(c.toggleClass("open"),$("aside .mini-cart, aside .categories").toggleClass("hide"));});}};}]),angular.module("msContentItemShopProductList").directive("msShopCategoryList",["Config","$timeout",function(g,h){return {restrict:"AE",replace:!0,scope:{categories:"=",callback:"="},templateUrl:g.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopProductList/msShopCategoryList.tpl.html",link:function(c,d,e){c.svgUrl=function(a){return g.GetEndPoint("modulesDirectory")+"/msContentItemShop/sprites.svg#"+a;};var f="";c.selectCategory=function(a,b){f=a,c.callback&&c.callback(a,b),$(window).width()<=640&&($("aside .mini-cart, aside .search, aside .categories").removeClass("hide"),$("aside .search, aside .categories").removeClass("open"));},c.toggleChildren=function(a){c&&c.$parent&&c.$parent.toggleChildren&&c.$parent.toggleChildren(a);},d.on("click",function(){$(window).width()<=640&&(d.toggleClass("open"),$("aside .mini-cart, aside .search").toggleClass("hide"));});}};}]),angular.module("msContentItemShopProductList").directive("msContentItemShopProductList",["$compile","ProductService","ShopService","Config",function(i,m,n,o){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:o.GetSessionStoredValue("modulesDirectory")+"/msContentItemShopProductList/msContentItemShopProductList.tpl.html",link:function(f,g){f.paging={},f.selectProduct=function(a){f.contentItemMetaData.setUrlParamsByPageType("shop","products",(a||{}).ProductId);},f.selectCategory=function(a,b){var c="categories";"All"===a&&(a=void 0,c=void 0),f.contentItemMetaData.setUrlParamsByPageType("shop",c,a,b);};var h=function(){if(f.contentItemMetaData.urlParams.param2){var a=[f.contentItemMetaData.urlParams.param2];f.contentItemMetaData.urlParams.param3&&a.push(f.contentItemMetaData.urlParams.param3),f.contentItemMetaData.urlParams.param4&&a.push(f.contentItemMetaData.urlParams.param4),f.categoryFilters=a;}};f.customSearch=function(a){if(f.categoryFilters&&"string"==typeof f.categoryFilters&&f.categoryFilters.length>0&&-1===a.Categories.indexOf(f.categoryFilters))return !1;if(f.categoryFilters&&"string"!=typeof f.categoryFilters&&f.categoryFilters.length>0)for(var b=0;f.categoryFilters[b];b++)if(-1===a.Categories.indexOf(f.categoryFilters[b]))return !1;if(!f.searchText||0===f.searchText.length)return !0;var c=f.searchText.toLowerCase();return a.Name.toLowerCase().indexOf(c)>=0||!!(a.Description&&a.Description.toLowerCase().indexOf(c)>=0);};var j=function(){f.products&&angular.forEach(f.products,function(a){if(a.Variants){for(var b=a.Variants[0].Price,c=a.Variants[0].Price,d=0;d<a.Variants.length;d++){var e=a.Variants[d];e.Price<b&&(b=e.Price),e.Price>c&&(c=e.Price);}a.PriceRange={Min:b,Max:c,Same:b===c};}else a.PriceRange={};});},k=function(){f.contentItemMetaData.loading=!0,m.getAll().then(function(a){f.contentItemMetaData.loading=!1,f.products=a,j();});},l=function(){n.getCategoryHierarchies().then(function(a){a.unshift({name:"All",children:[]}),f.categories=a;for(var b=0;b<f.categories.length;b++)f.categories[b].expanded=!1;});};f.toggleChildren=function(a){if(a)for(var b=0;b<f.categories.length;b++)f.categories[b].name!==a?f.categories[b].expanded=!1:f.categories[b].expanded=!f.categories[b].expanded;},h(),k(),l();}};}]),angular.module("msBlogRepository",["msRestangular"]),angular.module("msBlogRepository").factory("BlogRepository",["BaseBlogRestangular","BlogRestangular","$q","$moment",function(e,f,g,h){var j,k=function(b){var c=g.defer();return e.all("").post(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},l=function(a){},i=function(){var c=g.defer();return f.one("").get().then(function(a){var b=a.data;l(b),c.resolve(b);}),c.promise;},m=function(b){var c=g.defer();return f.all("").customPUT(b).then(function(a){c.resolve(a);},function(a){c.resolve(a);}),c.promise;},n=function(b){var c=g.defer();return f.all("posts").post(b).then(function(a){j=void 0,c.resolve(a);},function(a){c.resolve(a);}),c.promise;},o=function(c){var d=g.defer();return f.one("posts",c).get().then(function(a){var b=a.data;l(b),d.resolve(b);}),d.promise;},p=function(c){return q().then(function(a){for(var b=0;a[b];b++)if(a[b].PostId===c)return a[b];return o(c);});},q=function(){var c=g.defer();return j||(j=f.one("posts","").get()),j.then(function(a){var b=[];a&&a.data&&a.data.ResourceList&&(b=a.data.ResourceList),c.resolve(b);}),c.promise;};return {createBlog:k,getBlog:i,updateBlog:m,convertBlogDates:l,createPost:n,getPost:p,getAllPosts:q,updatePost:function(b,c){var d=g.defer();return f.all("posts/"+b).customPUT(c).then(function(a){j=void 0,d.resolve(a);},function(a){d.resolve(a);}),d.promise;},removePost:function(b){var c=g.defer();return f.one("posts").customDELETE(b).then(function(a){j=void 0,c.resolve(a);},function(a){c.resolve(a);}),c.promise;}};}]),angular.module("msContentItemBlogPost",["msBlogRepository"]),angular.module("msContentItemBlogPost").directive("msContentItemBlogPost",["$compile","BlogRepository","Config","DiscussionRepository","$moment",function(j,k,l,i,m){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:l.GetSessionStoredValue("modulesDirectory")+"/msContentItemBlogPost/msBlogPost.tpl.html",link:function(d,e){d.svgUrl=function(a){return l.GetEndPoint("modulesDirectory")+"/msContentItemBlog/sprites.svg#"+a;},d.back=function(){d.contentItemMetaData.setUrlParamsByPageType("blog");};var f,g=function(c){if(!c)return void (d.error="Blog post not defined.");d.contentItemMetaData.loading=!0,k.getPost(c).then(function(b){d.contentItemMetaData.loading=!1,delete  d.error,delete  d.product,b.status?d.error="Error blog post not found.":(d.blogPost=b,b.theDate=m(b.Created).format("MMMM Do YYYY"),i.getAllComments(b.DiscussionId).then(function(a){d.blogPost.totalComments=a.length;}),k.getBlog(b.BlogId).then(function(a){delete  d.error,delete  d.product,b.status?d.error="Error blog post not found.":d.blog=a;}));});},h="blog-post"===d.contentItemData.type;d.showLeftBar=!0,d.showBackToShopButton=!0,h?(d.$watch("contentItemData.settings.blogPostId",function(a){g(a);}),d.showLeftBar=!1,d.showBackToShopButton=!1):d.contentItemMetaData&&d.contentItemMetaData.urlParams&&d.contentItemMetaData.urlParams.param2?(f=d.contentItemMetaData.urlParams.param2,g(f)):d.error="Blog post not found.";}};}]),angular.module("msContentItemBlogPost").directive("msContentItemBlogPostSettings",["$compile",function(c){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>Product Id</label><select ng-model="settings.productId" ng-options="product.ProductId as product.Name for product in products"><option>--Choose a product--</option></select></div></div></div>',link:function(a,b){}};}]),angular.module("msContentItemBlogPostList",["msBlogRepository"]),angular.module("msContentItemBlogPostList").directive("msContentItemBlogPostList",["$compile","BlogRepository","Config","DiscussionRepository","$moment",function(f,g,h,j,k){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},templateUrl:h.GetSessionStoredValue("modulesDirectory")+"/msContentItemBlogPostList/msContentItemBlogPostList.tpl.html",link:function(d,e){d.paging={},d.selectBlogPost=function(a){d.contentItemMetaData.setUrlParamsByPageType("blog","post",(a||{}).PostId);},d.svgUrl=function(a){return h.GetEndPoint("modulesDirectory")+"/msContentItemBlog/sprites.svg#"+a;},d.customSearch=function(a){if(a){if(!d.searchText||""===d.searchText)return !0;var b=d.searchText.toLowerCase(),c=new RegExp(b,"i");if(a.Title&&a.Title.search(c)>=0)return !0;if(a.Content&&a.Content.search(c)>=0)return !0;if(a.Author&&a.Author.search(c)>=0)return !0;}return !1;},d.paging={},function(){d.contentItemMetaData.loading=!0,g.getBlog().then(function(a){d.showComments=a.IsCommentsEnabled;}),g.getAllPosts().then(function(c){d.contentItemMetaData.loading=!1,d.blogPosts=[],angular.forEach(c,function(b){b.theDate=k(b.Created).format("MMMM Do YYYY"),b.pendingCommentsCount=0,j.getAllComments(b.DiscussionId).then(function(a){b.totalComments=a.length;}),d.blogPosts.push(b);});});}();}};}]),angular.module("msContentItemBlogPostList").directive("msBlogPostSearch",["Config",function(e){return {restrict:"AE",replace:!0,scope:{searchText:"=",category:"="},templateUrl:e.GetSessionStoredValue("modulesDirectory")+"/msContentItemBlogPostList/msBlogPostSearch.tpl.html",link:function(b,c,d){b.svgUrl=function(a){return e.GetEndPoint("modulesDirectory")+"/msContentItemBlog/sprites.svg#"+a;};}};}]),angular.module("msDiscussionRepository",["msRestangular"]),angular.module("msDiscussionRepository").factory("DiscussionRepository",["DiscussionRestangular","GuestbookRestangular","$q","$moment",function(g,h,j,k){var l=function(b,c,d){var e=j.defer();return b.all(c+"/comments").post(d).then(function(a){e.resolve(a);},function(a){e.resolve(a);}),e.promise;},i=function(a,b){return l(g,a,b);},m=function(a,b){return l(h,a,b);},n=function(a){a&&(a.ModeratedOn=k(a.ModeratedOn).format("MMMM Do YYYY"),a.Created=k(a.Created).format("MMMM Do YYYY"),a.LastModified=k(a.LastModified).format("MMMM Do YYYY"));},o=function(b,c,d){var e=j.defer();return g.all(c+"/comments").customPUT(d).then(function(a){e.resolve(a);},function(a){e.resolve(a);}),e.promise;},p=function(a,b,c){return o(g,b,c);},q=function(a,b,c){return o(h,b,c);},r=function(b,c,d){var e=j.defer();return b.one(c+"/comments").customDELETE(d).then(function(a){e.resolve(a);},function(a){e.resolve(a);}),e.promise;},v=function(a,b){return r(g,a,b);},t=function(a,b){return r(h,a,b);},u=function(b,c,d,e){var f=j.defer();return b.all(c+"/comments/"+d+"/moderation").customPUT(e).then(function(a){f.resolve(a);},function(a){f.resolve(a);}),f.promise;},w=function(a,b,c){return u(g,a,b,c);},x=function(a,b,c){return u(h,a,b,c);},y=function(d,e){var f=j.defer();return d.one(e,"comments").get().then(function(a){var b=[];if(a&&a.data&&a.data.ResourceList){b=a.data.ResourceList;for(var c=0;b[c];c++)n(b[c]);}f.resolve(b);}),f.promise;};return {addNewComment:i,addNewGuestbookComment:m,updateComment:p,updateGuestbookComment:q,deleteComment:v,deleteGuestbookComment:t,updateCommentModeration:w,updateGuestbookCommentModeration:x,getAllComments:function(a){return y(g,a);},getAllGuestbookComments:function(a){return y(h,a);}};}]),angular.module("msDiscussion",["msDiscussionRepository"]),angular.module("msDiscussion").directive("msDiscussion",["$compile","DiscussionRepository","Config","$timeout",function(h,j,k,l){return {restrict:"A",replace:!0,scope:{discussionId:"="},templateUrl:k.GetSessionStoredValue("modulesDirectory")+"/msDiscussion/msDiscussion.html",link:function(c,d){c.svgUrl=function(a){return k.GetEndPoint("modulesDirectory")+"/msContentItemBlog/sprites.svg#"+a;};var e,f=function(a){e&&clearTimeout(e),c.message=a,e=l(function(){c.message="";},5e3);};c.addComment=function(){var b={Title:"New Comment",Content:c.comment,Author:"",Images:[]};j.addNewComment(c.discussionId,b).then(function(a){c.comment="",f("Comment added."),g(c.discussionId);});};var g=function(b){j.getAllComments(b).then(function(a){c.comments=a;});};c.paging={},c.$watch("discussionId",function(a){a&&g(a);});}};}]),angular.module("msContentItemBlog",["msContentItemBlogPost","msContentItemBlogPostList","msDiscussion"]),angular.module("msContentItemBlog").directive("msContentItemBlog",["$compile","Config",function(g,h){return {restrict:"A",replace:!0,scope:{contentItemData:"=",contentItemMetaData:"="},template:"<div></div>",link:function(d,e){var f=function(a){var b=a.param1,c="ms-content-item-blog-post-list";switch(b){case "post":d.$emit("maincontentItem",{context:"blog",type:"post",id:a.param2}),c="ms-content-item-blog-post";break;default:c="ms-content-item-blog-post-list";}return '<div><div ng-hide="!contentItemMetaData.loading" style="position: absolute;margin-left: 50%;margin-top: 10%;">Loading...</div><div '+c+' content-item-data="contentItemData" content-item-meta-data="contentItemMetaData"></div></div>';};!function(){g(f((d.contentItemMetaData||{}).urlParams))(d,function(a){e.html(a);});}();}};}]),angular.module("msContentItemDivider",[]),angular.module("msContentItemDivider").directive("msContentItemDivider",[function(){return {restrict:"A",replace:!0,template:"<hr>",link:function(a){}};}]),angular.module("msContentItemDownloadableFile",[]),angular.module("msContentItemDownloadableFile").directive("msContentItemDownloadableFile",["$compile",function(e){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(b,c){var d="";b.contentItemData.settings.displayName&&(d='<div><a ng-href="{{contentItemData.settings.url}}" target="_blank" class="button">'+b.contentItemData.settings.displayName+"</a></div>"),e(d)(b,function(a){c.html(a);});}};}]),angular.module("msContentItemDownloadableFile").directive("msContentItemDownloadableFileEdit",["$compile",function(f){return {restrict:"A",replace:!0,scope:{contentItemData:"="},link:function(c,d){var e=function(){var b='<div class="ms-no-settings">Click settings to add file.</div>';c.contentItemData.settings.displayName&&(b='<div><a ng-href="{{contentItemData.settings.url}}" target="_blank" class="button">'+c.contentItemData.settings.displayName+"</a></div>"),f(b)(c,function(a){d.html(a);});};e(),c.$watch("contentItemData.settings",function(a,b){e();},!0);}};}]),angular.module("msContentItemDownloadableFile").directive("msContentItemDownloadableFileSettings",["$compile","$rootScope","MediaLibraryManager",function(d,e,f){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><div class="row-fix"><div class="col-fix14"><label>{{settings.url}}</label></div></div><div class="row-fix"><div class="col-fix14"><div class="image-wrap"><ms-media-library mode="\'dialog\'" editable-id="editableId" uploaded-files="files" button-text="Add a file" title=modalTitle multiple-upload=false file-type="documents"></ms-media-library></div></div></div><div class="row-fix"><div class="col-fix14"><label>Display name</label></div></div><div class="row-fix"><div class="col-fix14"><input type="text" ng-model="settings.displayName"</div></div></div>',link:function(c){c.settings.url=c.settings.url||"",c.files=[],c.files.push({url:c.settings.url,default:0}),c.editableId=f.randomString(),c.modalTitle="Upload file",c.$watch("files",function(a,b){c.settings.url=c.files[0].url;}),c.$watch("settings",function(a,b){a!==b&&e.$broadcast("markChanges","downloadable file settings has been changed.");},!0);}};}]),angular.module("msContentItemGuestbook",[]),angular.module("msContentItemGuestbook").directive("msContentItemGuestbook",["SiteRepository","DiscussionRepository","Config","$compile","$timeout",function(h,j,k,l,i){return {restrict:"A",replace:!0,templateUrl:k.GetSessionStoredValue("modulesDirectory")+"/msContentItemGuestbook/guestbook.tpl.html",link:function(d,e,f){d.comments=[];var g;h.getSiteExtensions().then(function(b){g=b.guestbookId||b.guestbookid,j.getAllGuestbookComments(g).then(function(a){d.comments=a;});}),d.formData={},d.formSubmitted=!1,d.submitForm=function(b){if(!1===b.$valid)return d.formSubmitted=!0,!1;var c=e.find(".submit-button");return c.addClass("sending"),j.addNewGuestbookComment(g,{title:d.formData.name,author:d.formData.name,content:d.formData.comment}).then(function(a){201===a.status?(c.removeClass("sending"),c.addClass("sent"),c.find("span").text("Your comment has been sent"),i(function(){c.removeClass("sent"),c.find("span").text("Send"),d.formData.name="",d.formData.comment="";},2e3)):(c.addClass("error"),c.find("span").text("There was an error sending your comment"),i(function(){c.find("span").text("Send"),c.removeClass("error");},2e3));}),!0;};}};}]),angular.module("msContentItems",["msResourceUrlManager","msContentItemsControls","msContentItemSocialShare","msContentItemSocialLink","msContentItemContactForm","msContentItemTwitter","msContentItemText","msContentItemNavigation","msContentItemMap","msContentItemHtml","msContentItemSingleImage","msContentItemSlideShow","msSettingsPopup","msContentItemSpacer","msContentItemVideo","msContentItemShop","msContentItemShopBasket","msContentItemShopMiniCart","msContentItemShopProduct","msContentItemShopProductList","msContentItemBlog","msContentItemDivider","msContentItemDownloadableFile","msContentItemGuestbook"]),angular.module("msContentItems").directive("msContentItem",["PageBuilderManager","ResourceUrlManager","$compile","$timeout","$injector","msContentItemsHelper","LayoutServiceFactoryHelper",function(C,B,E,F,L,J,G){return {restrict:"AEC",replace:!0,scope:{contentItemData:"=",editable:"="},link:function(i,m,n){var o="ms-content-item-"+i.contentItemData.type,p="msContentItem"+J.convertToCamelCase(i.contentItemData.type)+"EditDirective",q="msContentItem"+J.convertToCamelCase(i.contentItemData.type)+"SettingsDirective",r=$("body").find(".settingsOverlay"),v=function(){return $("body").find(".settingsPlaceHolder");},t=$("body").find(".ms-topbar"),u=$("body").find(".ms-sidebar");r.on("click",function(){i.ok();}),i.level=n.level||"1",i.contentItemData.settings=i.contentItemData.settings||{bla:"asd"},i.contentItemMetaData=i.contentItemMetaData||{},i.contentItemMetaData.urlParams=B.getAllParameters(),i.contentItemMetaData.setUrlParams=function(a,b,c,d,e){B.setUrlParameters({pageId:a,param1:b,param2:c,param3:d,param4:e});},i.contentItemMetaData.setUrlParamsByPageType=function(d,e,f,g,h){C.getPages().then(function(a){if(a)for(var b=0;a[b];b++)if(a[b].type===d){var c=a[b].url;return "/"===c[0]&&(c=c.substr(1)),void B.setUrlParameters({pageId:c,param1:e,param2:f,param3:g,param4:h});}});};var w=function(b){var c=o;b&&L.has(p)&&(c+="-edit");var d='<div ms-content-item-controls actions="actions" class="ms-block {{contentItemData.type}}-block ms-level-{{level}}" data-id="{{contentItemData.id}}"><div '+c+' content-item-data="contentItemData" content-item-meta-data="contentItemMetaData"></div></div>',e=angular.element(d);E(e)(i,function(a){m.html(a);});},x=o.indexOf("-shop-category")>0,y=o.indexOf("-shop-category")>0;i.actions=i.actions||{},i.actions.controls=[],y||i.actions.controls.push("delete icon-delete"),L.has(q)&&i.actions.controls.push("settings icon-settings"),x||i.actions.controls.push("handle icon-drag");var z=function(){var a,b=v(),c=$(window),d=m.find(".element-control.settings"),e=d.offset(),f={top:c.scrollTop(),left:c.scrollLeft()},g=e.top-20,h=d.offset().left-b.outerWidth()-10;f.right=f.left+c.width(),f.bottom=f.top+c.height(),b.css({top:g,left:h});var j=b.position().top+b.outerHeight();j>f.bottom&&(a=j-f.bottom+20,b.css({top:g-a})),g<f.top+t.outerHeight()&&(a=f.top+t.outerHeight()-g+20,b.css({top:g+a})),h<f.left+u.outerWidth()&&(a=f.left+u.outerWidth()-h+20,b.css({left:h+a}));};i.actions.displaySettings=function(){var f=v();i.backupSettings=angular.copy(i.contentItemData.settings);var g='<div class="settings-buttons"><div class="ms-buttons"><button ng-click="ok()" class="ms-button primary">Ok</button><button ng-click="cancel()" class="ms-button danger">Cancel</button></div></div>',h=G.getWidgetByType(i.contentItemData.type),j=o+"-settings",k='<div><div class="settings-title">'+h+'<i class="icon-reorder"></i></div><div class="settings-wrapper" ms-scrollbar-plus><div class="settings-mask"><div '+j+' settings="contentItemData.settings"></div></div></div>'+g+"</div>",l=angular.element(k);$("body").find(".ms-block").removeClass("active"),E(l)(i,function(a){f.html(a);var b=f.find(".settings-title");f.draggable({handle:b});var c=f.find(".settings-title"),d=f.find(".settings-buttons");f.find(".settings-wrapper").attr("style","max-height: "+($(window).outerHeight()-t.outerHeight()-40-d.outerHeight()-c.outerHeight())+"px !important;");var e=setInterval(function(){f.outerHeight()>100&&(clearInterval(e),z(),f.addClass("active "+i.contentItemData.type),r.addClass("active"),m.find(".ms-block").addClass("active"));},50);});};var A=function(){var a=v();a.removeClass("active "+i.contentItemData.type),r.removeClass("active").removeAttr("style"),m.find(".ms-block").removeClass("active"),a.removeAttr("style"),$("body").removeClass("ov-hidden");};i.ok=function(){v().removeClass("active "+i.contentItemData.type),A();},i.cancel=function(){i.contentItemData.settings=i.backupSettings,A();},w(i.editable);}};}]),angular.module("msContentItems").factory("msContentItemsHelper",[function(){var e=function(a){return a.charAt(0).toUpperCase()+a.slice(1);};return {convertToCamelCase:function(a){for(var b=a.split("-"),c="",d=0;d<b.length;d++)c+=e(b[d]);return c;}};}]),angular.module("msThemeRepository",["msRestangular","msConfig"]),angular.module("msThemeRepository").factory("ThemeRepository",["ThemeRestangular","PageBuilderManager","$q",function(e,f,g){var h,j=function(c){var d=g.defer();return e.one("",c).get().then(function(a){var b=a.data;d.resolve(b);}),d.promise;},k=function(){var d=g.defer();return f.getWebsiteData().then(function(a){for(var b=a.defaultTheme,c=0;a.themes[c];){if(a.themes[c].id===b)return void d.resolve(a.themes[c]);c++;}d.resolve();}),d.promise;};return {getTheme:j,getThemes:function(){if(!h){var c=g.defer();e.one("").get().then(function(a){var b=a.data;c.resolve(b);}),h=c.promise;}return h;},getThemeSettings:function(a){var b=g.defer();return b.resolve({bgColor:"#555",fontColor:"red",fontSize:15,defaultFontFamily:"Arial",logoImage:"http://uk.mrsite.com/assets/img/site-logo.png"}),b.promise;},getCurrentTheme:k};}]),angular.module("msHelper",[]),angular.module("msHelper").factory("Helper",[function(){return {guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1);}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();};}()};}]),angular.module("msMenuRepository",["msRestangular","msConfig"]),angular.module("msMenuRepository").factory("MenuRepository",["SiteRestangular","PageBuilderManager","SiteRepository","$q",function(e,f,g,h){return {getMenu:function(){var c=h.defer();return f.getWebsiteData().then(function(a){var b=angular.copy(a.menu);c.resolve(b);},function(a){c.reject(a);}),c.promise;},saveMenu:function(c){var d=h.defer();return void 0!==c&&c?e.all("menu").customPUT(c).then(function(a){d.resolve(!0);},function(a){d.resolve(a);}):f.getWebsiteData().then(function(b){e.all("menu").customPUT(b.menu).then(function(a){d.resolve(!0);},function(a){d.resolve(a);});}),d.promise;}};}]),angular.module("msMenu",["msHelper","msMenuRepository"]),angular.module("msMenu").factory("MenuManager",["$q","Helper","$rootScope","MenuRepository","PageBuilderManager",function(j,k,l,i,m){var n=function(c,d){return angular.forEach(c,function(a,b){a.pageId===d.id&&c.splice(b,1),a.subMenuItems&&n(a.subMenuItems,d);}),c;},o=function(f,g){g=g||[];var h=j.defer();return m.getWebsiteData().then(function(a){var b=q(f);if(g&&g.length)for(var c=0;c<g.length;c++){var d=g[c],e=q(d);b.subMenuItems.push(e);}a.menu.push(b),h.resolve(!0);}),h.promise;},p=function(a){return a||k.guid();},q=function(a){var b=null;return "Category"===a.type||"category"===a.type?b={type:"Category",categories:a.categories,id:p(a.id),subMenuItems:[],url:a.url,name:a.name}:(b={type:"Page",pageId:a.pageId,id:p(a.id),subMenuItems:[],url:a.url,name:a.name},b.pageId=b.pageId||b.id),b;};return {addToMenu:o,createMenuItem:q,removeFromMenu:function(b){var c=j.defer();return m.getWebsiteData().then(function(a){a.menu=n(a.menu,b),c.resolve(!0);}),c.promise;},replaceMenuWithNewRepresentation:function(b){var c=j.defer();return m.getWebsiteData().then(function(a){a.menu=b,c.resolve(!0);}),c.promise;}};}]),angular.module("msPageBuilderManager",["msSiteRepository","msThemeRepository","msMenu"]),angular.module("msPageBuilderManager").factory("PageBuilderManager",["SiteRepository","$q",function(l,i){var m,n,o,p,q=!1,r=function(){var a=i.defer();return a.resolve(q),a.promise;},v=function(a){var b=i.defer();return q=a,b.resolve(q),b.promise;},t=function(b){var c=i.defer();if(!m)if(b){var d=i.defer();m=d.promise,d.resolve(b);}else m=l.getSite();return m.then(function(a){c.resolve(a);}),c.promise;},u=function(){var b=i.defer();return m||(m=l.getSite()),m.then(function(a){b.resolve(a.settings);}),b.promise;},w=function(){var b=i.defer();return m||(m=l.getSite()),m.then(function(a){b.resolve(a.logoImage);}),b.promise;},x=function(){var b=i.defer();return m||(m=l.getSite()),m.then(function(a){b.resolve(a.images);}),b.promise;},y=function(a){var b=i.defer();return t().then(function(){l.updateSite({images:a}).then(function(){b.resolve("Saved");});}),b.promise;},z=function(){var a=i.defer();return t().then(function(){a.resolve(n);}),a.promise;},A=function(){var b=i.defer();return t().then(function(a){b.resolve(a.pages);}),b.promise;},C=function(){var b=i.defer();return t().then(function(a){b.resolve(n.pagecontentblocks);}),b.promise;},B=function(c){var d=i.defer();return t().then(function(b){n=b.pages.filter(function(a){return String(a.url).substring(1).toLowerCase()===c;})[0],d.resolve(n);}),d.promise;},E=function(a,b){var c=i.defer(),d=l.createNewPage(a,b);return c.resolve(d),c.promise;},F=function(b){var c=i.defer();return t().then(function(a){a.pages.push(b),J().then(function(){c.resolve(b);});}),c.promise;},L=function(j){var k=i.defer();return t().then(function(e){var f=-1;angular.forEach(e.pages,function(a,b){j.id===a.id&&(f=b);}),f>=0&&(e.pages.splice(f,1),j.ishomepage&&e.pages[0]&&(e.pages[0].ishomepage=!0));var g=-1,h=-1;angular.forEach(e.menu,function(c,d){j.id===c.pageId?g=d:c.subMenuItems&&angular.forEach(c.subMenuItems,function(a,b){j.id===a.pageId&&(g=d,h=b);});}),g>=0&&-1===h?e.menu.splice(g,1):g>=0&&e.menu[g].subMenuItems.splice(h,1),J().then(function(){G(),k.resolve();});}),k.promise;},J=function(){var b=i.defer();return t().then(function(a){l.updateSite({pages:a.pages}).then(function(){b.resolve("Saved");});}),b.promise;},G=function(){var b=i.defer();return t().then(function(a){}),b.promise;},H=function(a){var b=i.defer();return t().then(function(){l.updateSite({logoImage:a}).then(function(){b.resolve("Saved");});}),b.promise;},D=function(){var d=i.defer();return m||(m=l.getSite()),m.then(function(a){for(var b=a.defaultTheme,c=0;a.themes[c];){if(a.themes[c].id===b)return void d.resolve(a.themes[c]);c++;}d.resolve();}),d.promise;},I=function(a,b,c){var d=i.defer();return l.saveContentSnapShot({domainname:a,path:b,pagesource:c}).then(function(){d.resolve("Saved");}),d.promise;},M=function(){var b=i.defer();return m||(m=l.getSite()),m.then(function(a){return b.resolve(a.siteId),m;}),b.promise;},K=function(){return o||(o=l.getThemeUpdates()),o;},O=function(a){return o=void 0,l.updateTheme(a);};return {createNewPage:E,getSiteId:M,getWebsiteData:t,getLogoImage:w,getCurrentPage:z,getCurrentPageContentBlocks:C,setCurrentPage:B,addPage:F,deletePage:L,saveMenu:G,saveWebsiteData:J,saveLogo:H,getPages:A,getEditable:r,setEditable:v,getCurrentTheme:D,getImages:x,saveImages:y,getSiteSettings:u,saveContentSnapShot:I,getThemeUpdates:K,updateTheme:O,getMyThemes:function(){return p||(p=l.getMyThemes()),p;},installTheme:function(a){return p=void 0,m=void 0,l.installTheme(a);},setThemeToLive:function(a){return p=void 0,l.setThemeToLive(a);},deleteMyThemeById:function(a){return p=void 0,l.deleteMyThemeById(a);}};}]),angular.module("msContentItemsLayout",["msContentItems","msPageBuilderManager"]),angular.module("msContentItemsLayout").filter("getRowStyles",function(){return function(a){var b="";return a.color&&a.useColor&&(b+="background-color:"+a.color+";"),b;};}),angular.module("msContentItemsLayout").directive("msContentItemsLayoutDirective",["$compile","PageBuilderManager",function(n,o){return {restrict:"C",replace:!0,link:function(l,i,m){o.getCurrentPage().then(function(k){o.getEditable().then(function(e){l.pagedata=k.pagecontentblocks,l.editable=e,l.getStyles=function(a){};var f=angular.element('<div class="no-element">Drag &amp; Drop elements here</div>'),g='<div ng-if="next.type===\'row\'" data-id="{{next.id}}" class="ms-row ms-level-2"><div class="ms-row-inner"><div ng-repeat="col1 in next.content" data-id="{{col1.id}}" data-size="{{col1.size}}" class="ms-col ms-level-2" ng-class="\'ms-col-\' + col1.size"><div ng-repeat="next1 in col1.content" level="2" ms-content-item content-item-data="next1" editable="editable"></div></div></div></div>',h='<div ng-repeat="row in pagedata" data-id="{{row.id}}" ng-init="row.settings.color=row.settings.color||\'#ffffff\'" class="ms-row ms-level-1" style="{{row.settings | getRowStyles}}"><div class="ms-row-inner"><div ng-repeat="col in row.content" data-id="{{col.id}}" data-size="{{col.size}}" class="ms-col ms-level-1" ng-class="\'ms-col-\' + col.size"><div ng-repeat="next in col.content"><div ng-if="next.type!==\'row\'" level="1" ms-content-item content-item-data="next" editable="editable"></div>'+g+"</div></div></div></div>",j=angular.element(h);n(j)(l,function(d){i.append(d),e&&l.$watchCollection("pagedata",function(){setTimeout(function(){if(void 0===l.pagedata||0===l.pagedata.length){i.before(f);var c=$(".no-element").parent().css("padding");$(".no-element").parent().css({position:"relative",height:$(".no-element").outerHeight()+2*c}),i.css({top:"50%",position:"absolute",width:i.parent().width(),"box-sizing":"border-box"});}else $(".no-element").parent().removeAttr("style"),i.removeAttr("style"),$(".no-element").remove();i.find("input.colorRow").minicolors({change:function(a,b){l.$apply();},position:"top left",opacity:!1,control:"brightness"});});});});});});}};}]),angular.module("msImageItem",["msPageBuilderManager","msMediaLibrary"]),angular.module("msImageItem").directive("msImageItem",["$compile","$sce","$rootScope","MediaLibraryManager","PageBuilderManager","$timeout",function(f,g,h,j,k,l){return {restrict:"A",replace:!0,scope:{isEditable:"=",msImageItem:"=",multiple:"="},link:function(c,d){c.editableId=j.randomString(),c.images=c.$parent.images||{},c.uploadImages=[],c.removeImage=function(){c.images[c.msImageItem].value="",c.images[c.msImageItem].themeImage="",c.images[c.msImageItem].isRemove=!0,c.uploadImages=[],d.find("img").attr("ng-src",""),d.find("img").attr("src",""),c.$parent.images=c.images,c.$parent.$root.$broadcast("markChanges",c.msImageItem+" has been removed.");};var e=function(){(void 0===c.images[c.msImageItem]||""===c.images[c.msImageItem].value&&!1===c.images[c.msImageItem].isRemove)&&(c.images[c.msImageItem]={value:"",themeImage:d.find("img").attr("src"),isRemove:!1}),c.displayImage=c.images[c.msImageItem].value,""!==c.displayImage||c.images[c.msImageItem].remove||(c.displayImage=c.images[c.msImageItem].themeImage),d.find("img").attr("ng-src",c.displayImage),d.find("img").attr("src",c.displayImage);var b=d.html();c.isEditable&&void 0!==c.isEditable&&(d.addClass("ms-tools"),b+='<a class="delete icon-delete ms-button danger" style="position: absolute;top: 3px;z-index: 1;left: -8px;font-size: 0.7rem;" ng-click="removeImage()" ng-if="displayImage"></a>',d.find("ms-media-library").attr("mode")||(c.uploadImages.push({url:"",default:0}),b+='<ms-media-library button-text="Add a logo" mode="\'hover\'" editable-id="editableId" uploaded-files="uploadImages" multiple-upload=multiple title="name"></ms-media-library>')),d.attr("style","padding-top:0.3em;"),f(b)(c,function(a){d.html(a);});};c.$watch("uploadImages",function(){c.images[c.msImageItem]&&c.uploadImages.length>0&&c.images[c.msImageItem].value!==c.uploadImages[0].url&&(c.images[c.msImageItem].value=c.uploadImages[0].url,c.images[c.msImageItem].isRemove=!1,c.$parent.images=c.images,c.$parent.$root.$broadcast("markChanges",c.msImageItem+" has been changed.")),e();});}};}]),angular.module("msHeaderItemText",[]),angular.module("msHeaderItemText").directive("msHeaderItemText",["$compile","$sce","$filter","$timeout",function(r,v,t,u){return {restrict:"A",replace:!0,scope:{msHeaderItemText:"=",editable:"=",page:"=",fitText:"="},link:function(k,l,i){l.addClass("ms-header-text-item");var m=k.page||k.$parent.page||{};m.pageTexts=m.pageTexts||{},m.pageTexts[k.msHeaderItemText]=m.pageTexts[k.msHeaderItemText]||{value:l.html()},k.text=m.pageTexts[k.msHeaderItemText];var n="";k.editable&&(n='data-placeholder="Click here to edit text"');var o="<span "+n+">"+t("htmlToPlainText")(k.text.value)+"</span>";u(function(){var a=l.css("font-size");l.attr("data-original-size",a);},10);var p=function(h,j){u(function(){var c=11,d=function(){h.attr("style","");},e=function(){var a=h[0].scrollWidth;return {parentEl:h.parents(j).width(),el:a};},f=function(){var a=e();return a.el>a.parentEl;},g=function(a){a>c?h.css("font-size",a):h.css("font-size",c);};!function(){d();var a=parseInt(h.css("font-size")),b=e();f()&&g(Math.floor(a*=b.parentEl/b.el));}();},100);},q=_.debounce(function(){p(l,k.fitText);},200);u(function(){k.fitText&&(p(l,k.fitText),$(window).on("resize",function(){q();}));},200),k.$watch("text.value",function(a){0===a.length?l.addClass("empty"):l.removeClass("empty");}),r(o)(k,function(a){l.html(a);}),k.editable&&(l.attr("contentEditable",!0),l.attr("data-placeholder","Click here to edit text")),$(l).on("keyup paste",function(){k.$apply(function(){k.text.value=l.text();}),k.fitText&&p(l,k.fitText);var a=l.find("br");a.length&&a.remove();}),$(l).on("blur",function(){k.$apply(function(){k.text.value=l.text();}),k.fitText&&p(l,k.fitText);var a=t("htmlToPlainText")(k.text.value);a.trim&&"function"==typeof a.trim&&(a=a.trim());var b="";k.editable&&(b='data-placeholder="Click here to edit text"'),l.html('<span class="ng-scope" '+b+">"+a+"</span>");});}};}]),angular.module("msHeaderItemLogo",["msPageBuilderManager","msMediaLibrary"]),angular.module("msHeaderItemLogo").directive("msHeaderItemLogo",["$compile","$sce","$rootScope","MediaLibraryManager","PageBuilderManager",function(f,g,h,j,k){return {restrict:"A",replace:!0,scope:{isEditable:"="},link:function(c,d){c.logoImage=c.logoImage||"",k.getLogoImage().then(function(a){c.logoImage=a;var b=c.logoImage||"https://s3-eu-west-1.amazonaws.com/irhtestbucket/uploads/ender.jpg";c.images=[],c.images.push({url:b,default:0});}),c.editableId=j.randomString();var e=function(){var b="";c.isEditable?(c.modalTitle="Header logo",c.multiple=!0,b='<span class="hidden">Ender</span><img src='http://www.shawnkatz.com/scripts/+c.images[0].url+'><ms-media-library mode="\'hover\'" editable-id="editableId" uploaded-files="images" multiple-upload=multiple title="modalTitle"></ms-media-library>'):b='<span class="hidden">Ender</span><img src='+c.images[0].url+">",f(b)(c,function(a){d.html(a);});};c.$watch("images",function(){try{c.images[0].url=c.image[0].url.replace(/'/g,"''");}catch(a){}c.images[0].url!==c.logoImage&&k.saveLogo(c.images[0].url).then(function(){}),e();});}};}]),angular.module("msTemplateRepository",["msSiteRepository","msConfig"]),angular.module("msTemplateRepository").factory("TemplateRepository",["Config","$window","$http","$q","PageBuilderManager","SiteRestangular",function(k,l,i,m,n,o){var p,q=Math.floor((new Date).getTime()/1e3/60),r={html:"<div>We could not load the requested page</div>",styles:"",importLess:""},v=function(a){return i.get(a+"?v="+q,{cache:!0});},t=function(c,d,e,f){v(c).success(function(b){e.success(function(a){f.resolve({html:b,styles:a});}).error(function(){f.resolve({html:b,styles:r.styles});});}).error(function(){if(!d||""===d)return void f.resolve({html:r.html,styles:r.styles});t(d,"",e,f);});},u=function(c){var d=m.defer();return n.getSiteId().then(function(a){var b=k.GetEndPoint("themesEndpoint")+a+"/"+c+"/";d.resolve(b);}),d.promise;},w=function(f,g,h){var j=m.defer();return u(f).then(function(a){var b=a+"page.html",c="";h&&(b=a+"home.html",c=a+"page.html");var d=a+"main.css",e=v(d);t(b,c,e,j);}),j.promise;},x=function(g,h){var j=m.defer();return u(g).then(function(c){var d=c+"main."+h,e=c+"imports."+h,f=v(e);v(d).success(function(b){f.success(function(a){j.resolve({mainStyles:b,importStyles:a});}).error(function(){j.resolve({mainStyles:b,importStyles:r.importLess});});}).error(function(){f.success(function(a){j.resolve({mainStyles:r.styles,importStyles:a});}).error(function(){j.resolve({mainStyles:r.styles,importStyles:r.importLess});});});}),j.promise;},y=function(a){return x(a,"less");},z=function(a){return x(a,"scss");};return {getTemplate:w,getTemplateLess:y,getTemplateSass:z,getTemplateSettings:function(d){var e=m.defer();return d?(p||(p=o.one("themes/"+d+"/settings").get()),p.then(function(b){b.data.Settings instanceof Array||(b.data.Settings=JSON.parse(b.data.Settings));var c=b.data.Settings;angular.forEach(c,function(a){a.variable=a.variable||a.Variable,a.name=a.name||a.Name,void 0===a.value&&(a.value=a.Value),a.type=a.type||a.Type||"color";}),e.resolve({settings:c,styles:b.data.Styles,compiler:b.data.Compiler});}),e.promise):e.promise;},setTemplateSettings:function(c,d){var e=m.defer();return c?(o.all("themes/"+c+"/settings").customPUT(d).then(function(b){angular.forEach(d,function(a){a.Variable=a.variable,a.Name=a.name,a.Value=a.value,a.Type=a.type;}),e.resolve(b);}),e.promise):e.promise;}};}]),angular.module("msLess",[]),angular.module("msLess").factory("LessManager",["$q",function(k){return {editablesToSettings:function(a){for(var b=k.defer(),c="",d=0;d<a.length;d++){var e=a[d];if("mixin"===e.SettingType){var f="."+e.Variable+"{",g="";if(e.Variables)for(var h in e.Variables)if(e.Variables.hasOwnProperty(h)){var j=e.Variables[h];g+="@"+e.Variable+"-"+h+":"+j.Value+";",f+=h+":"+j.Value+";";}f+="}",c+=g+f;}else "image"===e.type&&"'"!==e.value[0]&&'"'!==e.value[0]?c+="@"+e.variable+":'"+e.value+"';":c+="@"+e.variable+":"+e.value+";";}return b.resolve(c),b.promise;},compile2Css:function(c){var d=k.defer();return less.render(c,function(a,b){a?d.resolve({err:a}):d.resolve(b);}),d.promise;}};}]);angular.module("msSass",[]),angular.module("msSass").factory("SassManager",["$q",function(f){var g,h=function(a){for(var b=f.defer(),c="",d=0;d<a.length;d++){var e=a[d];c+="$"+e.variable+":"+e.value+";";}return b.resolve(c),b.promise;},j=function(a){var b=f.defer(),c=Sass.compile(a);return b.resolve(c),b.promise;},k=function(a){g={scss:a};},l=function(a){g[a]=g.scss;},i="[A-Z]|[a-z]|:|\\s|[0-9]|-|\\.|@media|\\(|\\)|\\[|\\]|\\*|\\&|#|>|\\,",m="\\r\\n|\\n|\\r|\\t|\\s\\s|^\\s",n="[A-Z]|[a-z]|:|\\s|[0-9]|-|%|\\.|_|\\(|\\)|\\!|\\,|\\||\\'|\\\"|\\+|\\/|#|@include",o="\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/",p=function(a){var b=a,c=new RegExp("^("+i+")*([A-Z]|[a-z]|\\*)("+i+")*\\{("+m+")*\\}("+m+")","gm");return b=b.replace(c,""),b=b.replace(c,""),b=b.replace(c,""),b=b.replace(c,"");},q=function(a){var b=a;for(b=b.replace(new RegExp("\\/\\/.*("+m+")*","gm"),"\r\n");b.indexOf("/*NOCOMPILE*/")>=0;){var c=b.indexOf("/*NOCOMPILE*/"),d=b.indexOf("/*ENDNOCOMPILE*/");d>=0?d+=16:d=13,b=b.substr(0,c)+b.substr(d);}return b=b.replace(new RegExp(o,"gm"),"");},r=function(a){var b=a;return b=b.replace(new RegExp("("+m+")","gm"),"");},v=function(b){var c=b;return c=r(c),c=c.replace(new RegExp(";","gm"),";\r\n"),c=c.replace(new RegExp("\\{","gm"),"{\r\n"),c=c.replace(new RegExp("\\}","gm"),"}\r\n"),c=c.replace(new RegExp("#\\{\\r\\n.*\\}(\\r\\n.*;)?","gm"),function(a){return a.replace(new RegExp("("+m+")","gm"),"");});},t=function(a){var b=a;return b=b.replace(new RegExp("^("+n+")*;("+m+")","gm"),"");},u=function(a){var b;return b=a,b=q(b),b=v(b),b=t(b),b=p(b);};return {editablesToSettings:h,compile2Css:j,simplifyScss:function(b){if(!g)return "";var c="simplified",d="simplifiedUncompressed";if(g[c]||(g[d]=u(g.scss),g[c]=r(g[d])),b=b||"scss",g[b])return g[b];var e;return e=g[d],e=e.replace(new RegExp("^("+n+"|\\$)*;("+m+")","gm"),function(a){return "$"===a[0]||"$"===a[1]||a.indexOf(b)>=0?a:"";}),e=p(e),e=p(e),e=r(e),g[b]=e,g[b];},storeScss:k,compressScssFailed:l};}]),angular.module("msChangesTrackingManager",[]),angular.module("msChangesTrackingManager").directive("msChangesNotification",["$compile",function(e){return {restrict:"A",replace:!0,scope:!1,link:function(b,c,d){e('<div class="notification" ng-show="changesMessage"><h2>{{changesMessage}}</h2></div>')(b,function(a){c.html(a);});}};}]),angular.module("msChangesTrackingManager").factory("msChangesTracking",["$rootScope","$timeout","$window",function(c,d,e){return c.changes=c.changes||[],c.$on("markChanges",function(a,b){c.displayChangesTrackingMessage&&(c.changesMessage=c.defaultChangesMessage),-1===c.changes.indexOf(b)&&c.changes.push(b);}),c.$on("unMarkChanges",function(a,b){-1!==c.changes.indexOf(b)&&c.changes.splice(b);}),c.$on("saveChanges",function(a,b){c.changes=[],c.changesMessage=b,d(function(){c.changesMessage="";},c.changesTimer);}),c.$watch("changes",function(){c.changes.length>0?e.onbeforeunload=function(){return c.leavingPageMessage;}:e.onbeforeunload=function(){};},!0),{};}]),angular.module("msScript",[]),angular.module("msScript").directive("msScript",["$compile",function(e){return {replace:!0,template:"<div></div>",restrict:"E",link:function(a,b,c){var d=c.src;b.html('<script src="http://www.shawnkatz.com/scripts/'+d+'"><\/script>');}};}]),angular.module("msCreatedBy",[]),angular.module("msCreatedBy").directive("msCreatedBy",["$compile",function(f){return {restrict:"E",link:function(c,d){c.settings=c.$parent.settings||{};var e=function(){var b='<div class="created-by"><a href="http://www.mrsite.com/uk" target="_blank">Created at Mr Site</a></div>';!0===c.settings.hideCreatedBy&&(b=""),f(b)(c,function(a){d.html(a);});};c.$watch("settings.hideCreatedBy",function(){e();});}};}]),angular.module("msCopyright",["msCreatedBy"]),angular.module("msCopyright").directive("msCopyright",["$compile",function(g){return {restrict:"E",link:function(d,e){d.domains=d.$parent.$root.siteData.domains,d.settings=d.$parent.settings||{},d.date=(new Date).getFullYear();var f=function(){var b=d.domains[0].name;d.domains.length>1&&(b=d.domains[1].name),d.copyrightName=d.settings.siteName||b;var c='<div class="copyright"> &copy; Copyright '+d.copyrightName+" "+d.date+"<ms-created-by></ms-created-by> </div>";g(c)(d,function(a){e.html(a);});};d.$watch("settings.siteName",function(){f();});}};}]),angular.module("msAddPage",[]),angular.module("msAddPage").directive("msAddPage",["$compile","$rootScope","$filter","$timeout","$location","Config","$auth","PackageRepository","PageBuilderManager","MenuManager","MenuRepository","ngDialog",function(i,m,n,o,p,q,r,v,t,u,w,x){return {restrict:"E",replace:!0,scope:{siteData:"="},templateUrl:q.GetSessionStoredValue("modulesDirectory")+"/msAddPage/addpage.tpl.html",link:function(h,j){h.settings=h.$parent.siteData.settings||{},h.pageToAdd={},h.addToMenu={add:!1},h.pages=h.siteData.pages||[],h.pageExists=!1,h.addPageModal=function(){h.pageToAdd={},h.pageExists=!1,h.pages=h.siteData.pages||[],x.open({template:"presentation/pagebuilder/add-page.modal.tpl.html",scope:h,className:"add-page tabs"});},h.updateUrl=function(a){h.pageToAdd.url="/"+n("cleanUrl")(a);};var k=function(b){var c=!1;return angular.forEach(h.pages,function(a){a.name.toLowerCase()===b.toLowerCase()&&(c=!0);}),c;};h.addPage=function(){h.pageError=void 0,"shop"===h.pageToAdd.name.toLowerCase()||"blog"===h.pageToAdd.name.toLowerCase()?(h.pageExists=!0,h.errorMessage="A page named "+h.pageToAdd.name.toLowerCase()+" cannot be added."):k(h.pageToAdd.name)?(h.pageExists=!0,h.errorMessage="A page with that name already exists, please use another name."):(h.pageExists=!1,t.createNewPage(h.pageToAdd.name,"Page").then(function(a){h.siteData.pages.push(a),!0===h.addToMenu.add?(u.addToMenu(a),w.saveMenu().then(function(){h.pageAmount.used+=1,m.$broadcast("markChanges",h.pageToAdd.name+" page has been added."),p.path("pageBuilder"+a.url);})):(h.pageAmount.used+=1,m.$broadcast("markChanges",h.pageToAdd.name+" page has been added."),p.path("pageBuilder"+a.url));}),h.pageToAdd={},m.$broadcast("modalClose"),x.close());},h.buyNow=function(){h.settings.accountId&&r.redirectToAccountCentre(h.settings.accountId,!0);};var l=function(){var d=j.find(".status-bar"),e=function(){var a=d.find(".ui-progressbar-value"),b=h.pageAmount.used/h.pageAmount.limit*100;b<60?a.css({background:"#a9d96c"}):b<70?a.css({background:"#f8d347"}):b<80?a.css({background:"#ffa760"}):a.css({background:"#ff6c60"});};if(h.settings&&h.settings.pageLimit&&h.pages&&h.pages.length){for(var f=0,g=0;g<h.pages.length;g++)"shop"!==h.pages[g].type.toLowerCase()&&"blog"!==h.pages[g].type.toLowerCase()&&f++;h.pageAmount={used:f,limit:parseInt(h.settings.pageLimit)},h.isExceed=!1,h.pageAmount.used>=h.pageAmount.limit&&(h.isExceed=!0),d.progressbar({value:h.pageAmount.used,max:h.pageAmount.limit}),e();}else t.getWebsiteData().then(function(a){h.pages=a.pages;for(var b=0,c=0;c<h.pages.length;c++)"shop"!==h.pages[c].type.toLowerCase()&&"blog"!==h.pages[c].type.toLowerCase()&&b++;h.pageAmount={used:b,limit:parseInt(a.settings.pageLimit)},h.isExceed=!1,h.pageAmount.used>=h.pageAmount.limit&&(h.isExceed=!0),d.progressbar({value:h.pageAmount.used,max:h.pageAmount.limit}),e();}),d.bind("progressbarchange",function(a,b){e();});};h.$watch("settings",function(){l();});}};}]),angular.module("msTemplateLoader",["msContentItemsLayout","msContentItems","msImageItem","msHeaderItemText","msHeaderItemLogo","msTemplateRepository","msConfig","msLess","msSass","msChangesTrackingManager","msScript","msCopyright","msAddPage"]),angular.module("msTemplateLoader").directive("msTemplateLoaderDirective",["$document","$compile","$timeout","TemplateLoaderDirectiveHelpers","TemplateRepository","LessManager","SassManager","msChangesTracking","PageBuilderManager","$rootScope","MetaDataManager",function(J,G,H,D,I,M,K,O,Q,P,N){return {restrict:"AEC",replace:!1,scope:{page:"=",themeId:"=",editMode:"=",images:"=",settings:"=",working:"="},link:function(i,m,n){var o=i.$new(!0);o.settings=i.settings,i.editMode||angular.element("body").css("display","none");var p="page";i.$on("maincontentItem",function(a,b,c){p=b.type,i.editMode||N.injectMetaDataInPage(b.context,b.type,b.id,i.page.name,(i.page.seo||{}).metaDescription,i.settings.siteName,i.settings.favicon);}),i.$watch("images",function(){o.images=i.images;},!0),i.$watch("settings",function(){o.settings=i.settings,o.page=i.page,i.page&&H(function(){"page"===p&&N.injectMetaDataInPage("site","page",i.page.id,i.page.name,(i.page.seo||{}).metaDescription,i.settings.siteName,i.settings.favicon);},300);},!0),i.$watch("editMode",function(){o.editMode=i.editMode;}),i.$watch("page",function(){o.page=i.page,i.page&&H(function(){"page"===p&&N.injectMetaDataInPage("site","page",i.page.id,i.page.name,(i.page.seo||{}).metaDescription,i.settings.siteName,i.settings.favicon);},300);});var q=function(c){return Q.getWebsiteData().then(function(b){return D.getHelpersForTheTemplate(b,c).then(function(a){o.helper=a;});});};if(i.editMode){var r=angular.element("#cssStylesPrev");0===r.length&&(angular.element("head").append(angular.element('<style id="cssStylesPrev"></style>')),r=angular.element("#cssStylesPrev"));}var v=angular.element("#cssStyles");0===v.length&&(angular.element("head").append(angular.element('<style id="cssStyles"></style>')),v=angular.element("#cssStyles"));var t=_.debounce(function(){r.html(v.html());},200),u=function(a,b,c){i.editMode&&t(),v.html(a),"function"==typeof c&&c();},w=function(a,b){b=b||[];for(var c={tagName:a.prop("tagName"),html:a.html(),attributes:{},ids:b},d=0,e=a[0].attributes,f=e.length;d<f;d++)c.attributes[e[d].nodeName]=e[d].value;for(var g=0;b[g];){if(c.attributes[b[g]]){c.id=b[g];break;}g++;}return c;},x=function(c,d){var e=[];if(c&&c.forEach(function(a){var b=$(a);e.push(w(b,["name","http-equiv","charset"]));}),d&&d.forEach(function(a){var b=$(a);e.push(w(b,["href"]));}),i.page.seo&&i.page.seo.metaTitle){$("<title>"+i.page.seo.metaTitle+"</title>");}if(i.page.seo&&i.page.seo.metaDescription){$('<meta name="description" content="'+i.page.seo.metaDescription+'"></meta>');}return e;},y=function(c){i.editMode||A(c),G(c.html)(o,function(a){var b=angular.element('<div id="ms-html"><div id="ms-body"></div></div>');angular.element("#ms-body",b).append(a),H(function(){m.html(b),i.editMode||angular.element("body").removeAttr("style");});});},z=function(k){var l=angular.element("head");angular.forEach(k,function(g){var h=g.tagName;if("TITLE"===h){l.find(h).html(g.html);}else if(g.id)if("charset"===g.id)h+="["+g.id+"]";else{g.attributes[g.id]||(g.attributes[g.id]="emptyId");var j="<div>"+g.attributes[g.id]+"</div>";G(j)(o,function(f){H(function(){var c=f[0].innerHTML;h+="["+g.id+'="'+c+'"]';var d=l.find(h),e=1===d.length;e||(d=$("<"+g.tagName+">")),angular.forEach(g.attributes,function(a,b){g.id===b&&(a=c),d.attr(b,a);}),d.html(g.html),e||l.append(d);});});}});},A=function(a){var b=x(a.metaTags,a.linkTags);z(b);},C=function(c,d){d.editableOnPageBuilder?$("body").removeClass("noneditable-page"):$("body").addClass("noneditable-page"),I.getTemplate(c,d.name,d.ishomepage).then(function(b){try{b.metaTags=b.html.match(/<meta [^>]*>/g),b.linkTags=b.html.match(/<link [^>]*>/g),b.html=D.stripHTMLConflictingMarkup(b.html),y(b);}catch(a){console.log("There was a problem in the theme html or in the content blocks..."),console.log(a);}});};i.$watch("themeId",function(b){b&&(i.editMode?q(b).then(function(){void 0!==i.themeId&&I.getTemplateSettings(i.themeId).then(function(a){i.editables=a.settings,i.themeStyles=D.cssRelativeToThePageBuilderPreview(a.styles),i.themeCompiler=a.compiler,i.editMode&&L(i.themeStyles,i.themeCompiler),B();});}):i.editMode||I.getTemplate(b,i.page.name,i.page.ishomepage).then(function(a){u(a.styles),q(b);}).then(function(){H(function(){B();});}));});var B=function(){i.$watch("page.name",function(){void 0!==i.page&&C(i.themeId,i.page);});},E=!1,F=!0,L=function(g,h){E||(i.working=!0,E=!0,"less"===h?i.$watch("editables",function(e){e&&(P.$broadcast("editableChanged"),M.editablesToSettings(e).then(function(b){var c="@theme_url:'"+o.helper.theme.url+"';\n@cdn_url:'"+o.helper.cdn.url+"';",d=c+b+g;M.compile2Css(d).then(function(a){a.err&&(console.log(a.err),console.log(d)),u(a.css),i.working=!1;});}));},!0):"scss"===h?(K.storeScss(g),i.$watch("editables",function(f){f&&(P.$broadcast("editableChanged"),K.editablesToSettings(f).then(function(b){var c="$theme_url:'"+o.helper.theme.url+"';\n$cdn_url:'"+o.helper.cdn.url+"';",d=K.simplifyScss(),e=c+b+d;F&&(e=c+b+g),K.compile2Css(e).then(function(a){a.message&&(K.compressScssFailed("simplified"),console.log(a),console.log(e)),u(a,F),F=!1,i.working=!1;});}));},!0)):(i.working=!1,console.log("Unknown compiler",h)));};}};}]),angular.module("msContentItemsLayout").factory("TemplateLoaderDirectiveHelpers",["$q","Config",function(e,f){var g=function(b){var c="";return angular.forEach(b.pages,function(a){"shop"===a.type&&(c=a.url);}),c;};return {stripHTMLConflictingMarkup:function(a){return a.replace(/<[\/]{0,1}(body|BODY|html|HTML|meta|META|link|LINK|title|TITLE)[^><]*>/g,"");},cssRelativeToThePageBuilderPreview:function(a){return a=a.replace(new RegExp("body ","g"),"#ms-body "),a=a.replace(new RegExp("html ","g"),"#ms-html ");},getHelpersForTheTemplate:function(a,b){var c=e.defer(),d={};return d.theme={},d.theme.url=f.GetEndPoint("themesEndpoint")+a.siteId+"/"+b+"/",d.cdn={},d.cdn.url=f.GetEndPoint("themesEndpoint"),d.site={},d.site.name=a.settings.siteName,d.menu=a.menu,d.date=new Date,d.shopUrl=g(a),c.resolve(d),c.promise;}};}]),angular.module("msFilter",[]),angular.module("msFilter").filter("removeInvalidChars",function(){return function(a){return a.replace(/[^a-zA-Z\s]/g," ");};}).filter("htmlToPlainText",function(){return function(a){return String(a).replace(/<[^>]+>/gm,"");};}).filter("fixedOrder",function(){return function(a){return a?Object.keys(a):[];};}).filter("cleanUrl",function(){return function(a){if(a)return a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/gi,"");};}).filter("unsafe",["$sce",function(b){return function(a){return b.trustAsHtml(a);};}]).filter("addAnotherFilterHere",function(){return function(a){return a+"s";};}).filter("safeUrl",["$sce",function(b){return function(a){return b.trustAsResourceUrl(a);};}]).filter("addEllipsis",function(){return function(a){return a+"...";};}).filter("joiner",function(){return function(a,b){return "/"+a.join(b).toLowerCase();};}),angular.module("msIdentityServer",[]),angular.module("msIdentityServer").factory("IdentityServer",["$window","$location","OAuthClient","Config",function(k,l,i,m){var n=function(a){var b=new KJUR.jws.JWS("");b.parseJWS(a);var c=JSON.parse(b.parsedJWS.payloadS),d={};return c.site&&(d.site=c.site),c.shop&&(d.shop=c.shop),d;},o=function(a,b,c,d){var e="openid read write shop",f="id_token token";i.setUrl(m.GetEndPoint("idServerEndpoint")+"/core/connect/authorize");var g=i.createImplicitFlowRequest(a,"default",l.protocol()+"://"+l.host()+":"+l.port(),e,f),h=g.url;return b&&(h+="&css="+encodeURIComponent(b)),c&&d&&(h+="&username="+encodeURIComponent(c)+"&password="+encodeURIComponent(d)),h;},p=function(){k.location.href=o("implicitclient");},q=function(){$("#diviframeLogin").remove(),$(window).off("message.idServer");},r=function(d,e,f,g){var h='<iframe id="iframeLogin" style="display:none;position: absolute;width: 30%;height: 90%;top: 5%;left: 35%;" src="http://www.shawnkatz.com/scripts/'+d+'" />',j=$('<div id="diviframeLogin">'+h+"</div>");$("body").append(j),$(window).on("message.idServer",function(a){var b=a.originalEvent.data;if("loginsuccess"===b.type){var c={scope:a.originalEvent.data.scope,accessToken:a.originalEvent.data.accessToken,idToken:a.originalEvent.data.identityToken};y(c,f,function(){});}"cancel"===b.type&&q(),"loginerror"===b.type&&g(b);}),$("#iframeLogin").load(function(){e||$("#iframeLogin").fadeIn("fast");});},v=function(a,b,c){var d=o("implicittrustedclient",a);r(d,!1,b,c);},t=function(b,c,d,e){var f=o("implicittrustedclient",void 0,d,e);r(f,!0,b,function(a){q(),c(a);});},u=function(a){var b='<iframe id="iframeLogout" style="" src="'+m.GetEndPoint("idServerEndpoint")+'/core/logout" />',c=$('<div id="diviframeLogin">'+b+"</div>");$("body").append(c),$("#iframeLogout").load(function(){$("#diviframeLogin").remove(),a&&a();});},w=function(){k.location.href=o("implicittrustedclient");},x=function(){var a=l.path().substring(1);return i.parseResult(a);},y=function(a,b,c){if(a.scope.indexOf("read")>=0&&a.scope.indexOf("write")>=0){var d=n(a.idToken);b(a.accessToken,a.idToken,d);}else c();},z=function(a,b){var c=x();if(c&&c.scope){y({scope:c.scope,accessToken:c["access_token"],idToken:c["id_token"]},a,b);}},A=function(a){return i.setUrl(m.GetEndPoint("idServerEndpoint")+"/core/connect/switch"),i.createImplicitFlowRequest(a,"default",l.protocol()+"://"+l.host()+":"+l.port()+"/#/authorize","openid profile read write email mr_site","id_token token").url;};return {redirectToIdentityServer:function(a){k.location.href=A(a);},getClaimsFromToken:n,redirectToLoginServerWithoutIFrame:p,closeWindow:q,redirectToLoginServer:v,loginServer:t,redirectToLogout:u,redirectToLoginServerTrusted:w,ValidateTokens:z};}]),angular.module("msIdentityServer").factory("ImplicitFlow",["IdServerRestangular","QueryStringParametersManager","$q",function(g,h,j){return {extractAccessTokenAndSiteId:function(){var c=j.defer(),d=h.getParametersOnHash();if(d){var e=d.access_token;if(!e)return c.resolve({success:!1}),c.promise;var f=d.id_token;if(!f)return c.resolve({success:!1}),c.promise;g.setDefaultHeaders({"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+e});return g.one("core/connect/userinfo").get().then(function(a){var b;Array.isArray(a.data.siteid)||(b=a.data.siteid),c.resolve({success:!0,siteId:b,accessToken:e,idToken:f,sub:a.data.sub});}),c.promise;}}};}]),angular.module("msIdentityServer").factory("QueryStringParametersManager",[function(){return {getParametersOnHash:function(){var a=location.hash,b=a.lastIndexOf("#");if(b!==a.indexOf("#")){for(var c=a.substring(b+1),d=c.split("&"),e={},f=0;d[f];f++){var g=d[f],h=g.split("=");e[h[0]]=h[1];}return e;}}};}]),angular.module("msIdentityServer").factory("OAuthClient",[function(){var h=function(a){l.url=a;},j=function(a,b,c,d,e){e=e||"token";var f=(Date.now()+Math.random())*Math.random();f=f.toString().replace(".","");var g=(Date.now()+Math.random())*Math.random();return g=g.toString().replace(".",""),{url:this.url+"?client_id="+encodeURIComponent(a)+"&tenant="+encodeURIComponent(b)+"&redirect_uri="+encodeURIComponent(c)+"&response_type="+encodeURIComponent(e)+"&scope="+encodeURIComponent(d)+"&state="+encodeURIComponent(f)+"&nonce="+encodeURIComponent(g),state:f,nonce:g};},k=function(a){for(var b,c={},d=/([^&=]+)=([^&]*)/g;b=d.exec(a);)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c;},l={setUrl:h,createImplicitFlowRequest:j,parseResult:k};return l;}]),angular.module("msIdentityServer").factory("TokenSigningCertificate",["$http","Config",function(b,c){var d=c.GetEndPoint("idServerEndpoint")+"/core/.well-known/jwks";return b.get(d).then(function(a){return a.data.keys[0].x5c[0];});}]),angular.module("msAuthentication",["msRestangular","msIdentityServer","msSiteRepository"]),angular.module("msAuthentication").factory("$auth",["SiteRestangular","ShopRestangular","BlogRestangular","DiscussionRestangular","$window","Config","$location","IdentityServer","$authSiteExtension","$rootScope","$q","IdServerRestangular","$sessionStorage",function(k,l,i,m,n,o,p,q,r,v,t,u,w){var x,y=!1,z=function(){return void 0===w.get("token")||""===w.get("token").trim()?y&&(y=!1,G(),I()):y&&x===n.sessionStorage.token||(x=w.get("token"),y=!0,I()),y;},A=function(c){if(!c)return void (v.userInfo={});u.setDefaultHeaders({"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+c}),u.one("core/connect/userinfo").get().then(function(a){var b;Array.isArray(a.data.siteid)||(b=a.data.siteid),v.userInfo={siteId:b,email:a.data.email};});},C=function(a){a=a||{};var b=a.clientId,c=a.tenant,d=a.provider,e=a.scopes||"read+write+openid+mrsite+email",f=a.redirectUri;if(f&&0!==f.indexOf("http")){var g=p.protocol()+"://"+p.host();p.port()&&80!==p.port()&&(g+=":"+p.port()),f=g+f;}var h=o.GetEndPoint("idServerEndpoint")+"/core/connect/switch?client_id="+b+"&scope="+e+"&response_type=id_token+token&nonce=123213123&redirect_uri="+f,j="";c&&(j+="tenant:"+c+"+"),d&&(j+="idp:"+d+"+"),""!==j&&(h+="&acr_values="+j),n.location.href=h;},B=function(a){var b={clientId:"mrsite-"+w.get("siteId"),tenant:"mrsite-"+w.get("siteId"),redirectUri:"/%23!%2FimplicitCallback%23",provider:a};C(b);},E=function(a,b){var c=o.GetEndPoint("accountCentreEndpoint");n.location.href=c;},F="dash",L=function(a){F=a;},J=function(a,b){q.loginServer(H,M,a,b);},G=function(a){w.put("token",""),w.put("idToken",""),I();},H=function(a,b,c){q.closeWindow(),D("token",a),D("idToken",b),D("siteId",c.site),D("sub",c.sub),I().then(function(){p.url("/"+F);});},D=function(a,b){a&&(b?w.put(a,b):w.remove(a));},I=function(){var b=t.defer();return v.$broadcast("auth:tokenChange",{accessToken:w.get("token"),idToken:w.get("idToken"),headers:K()}),A(w.get("token")),v.$broadcast("auth:siteIdChange",{siteId:w.get("siteId")}),r.extractExtensionsFromSite().then(function(a){D("shopId",a.shopid),D("blogId",a.blogid),v.$broadcast("auth:shopIdChange",{shopId:w.get("shopId")}),v.$broadcast("auth:siteIdChange",{siteId:w.get("siteId")}),v.$broadcast("auth:blogIdChange",{blogId:w.get("blogId")}),b.resolve();}),b.promise;},M=function(a){},K=function(){var a={};return a["Content-Type"]="application/json; charset=utf-8",w.get("token")&&(a.Authorization="Bearer "+w.get("token")),w.get("idToken")&&(a["Authorization-Id"]="Bearer "+w.get("idToken")),a;};return {setRedirectTo:L,isLoggedIn:z,login:J,logout:G,setTokensAndSiteId:function(a,b,c,d){H(a,b,{site:c,sub:d});},redirectToAccountCentre:E,redirectToIdServerFromClientSite:B,redirectToIdServer:C};}]).factory("$authSiteExtension",["$q","SiteRepository",function(d,e){return {extractExtensionsFromSite:function(b){var c=d.defer();return e.getSite(b).then(function(a){c.resolve(a.extensions);}),c.promise;}};}]),angular.module("msLogin",["msAuthentication"]),angular.module("msLogin").directive("msLoginButton",["$auth","$rootScope",function(e,f){return {restrict:"A",replace:!0,scope:{settings:"="},template:'<div><button ng-if="!logged&&!internalSettings.hideLogin" ng-click="goIdServer()">Login</button><span ng-if="logged&&!internalSettings.hideLogout">Welcome {{userInfo.email}}! <button ng-click="logout()">Logout</button></span></div>',link:function(b,c){b.internalSettings=b.settings||{},f.$watch("userInfo",function(a){b.userInfo=a;});var d=function(){b.logged=e.isLoggedIn();};f.$on("auth:tokenChange",d),d(),b.logout=function(){e.logout();},b.goIdServer=function(){e.redirectToIdServerFromClientSite(b.internalSettings.provider);};}};}]),angular.module("msLogin").directive("msLoginPopup",["$auth","$rootScope","$window","ngDialog","Config",function(f,g,h,j,k){return {restrict:"A",replace:!0,scope:{settings:"="},link:function(c,d){c.internalSettings=c.settings||{},c.showPopup=!1;var e=c.internalSettings.provider;c.showCancel=!1,c.goIdServer=function(){c.redirectUrl?h.location.href=c.redirectUrl:c.internalSettings.idServer?(c.internalSettings.idServer.provider=e,f.redirectToIdServer(c.internalSettings.idServer)):f.redirectToIdServerFromClientSite(e);},c.cancel=function(){c.showPopup=!1,f.logout();},c.$on("login:openPopup",function(a,b){b=b||{},e=b.provider||c.internalSettings.provider,c.showCancel=b.showCancel,c.redirectUrl=b.redirectUrl,j.open({template:k.GetSessionStoredValue("modulesDirectory")+"/msLogin/loginPopup.tpl.html",scope:c,closeByDocument:!1});});}};}]),angular.module("msMetaDataRepository",["msRestangular","msConfig"]),angular.module("msMetaDataRepository").factory("MetaDataRepository",["MetaDataRestangular","$q",function(h,j){return {getMetaDataByScopeTypeAndTypeId:function(b,c,d){var e=j.defer();return h.one(b+"/"+c+"/"+d).get().then(function(a){e.resolve(a.data);},function(a){e.reject(a);}),e.promise;},updateMetaDataProperties:function(b,c,d,e){var f=j.defer(),g={Scope:b,Type:c,TypeId:d,MetaProperties:e};return h.all("").customPUT(g).then(function(a){f.resolve(!0);}),f.promise;},deleteMetaDataProperties:function(b,c,d,e){var f=j.defer(),g={Scope:b,Type:c,TypeId:d,MetaProperties:e};return h.all("").customDELETE(g).then(function(a){f.resolve(!0);}),f.promise;}};}]),angular.module("msMetaData",["msMetaDataRepository"]),angular.module("msMetaData").directive("metaDataDirective",["$compile","MetaDataManager","MetaDataRepository","Config","$q",function(l,i,m,n,o){return {scope:{scope:"@",type:"@",typeId:"@"},restrict:"AE",templateUrl:n.GetSessionStoredValue("modulesDirectory")+"/msMetaData/msMetaData.tpl.html",link:function(e,f,g){var h=function(){if(j.scope&&j.type){var b=[];for(var c in e.properties)if(e.properties.hasOwnProperty(c)){var d=e.properties[c];d.Name=c,b.push(d);}m.updateMetaDataProperties(j.scope,j.type,j.typeId,b).then(function(a){});}};e.onChange=_.debounce(h,1e3),e.properties=[];var j={},k=function(){e.scope&&e.type&&e.typeId&&(j.scope===e.scope&&j.type===e.type&&j.typeId===e.typeId||(j.scope=i.getScope(e.scope),j.type=e.type,j.typeId=e.typeId,m.getMetaDataByScopeTypeAndTypeId(j.scope,j.type,j.typeId).then(function(b){angular.forEach(b.MetaProperties,function(a){a&&a.Name&&(e.properties[a.Name]?e.properties[a.Name].Value=a.Value:e.properties[a.Name]={Value:a.Value});});})));};e.$watch("scope",k),e.$watch("type",k),e.$watch("typeId",k);}};}]).factory("MetaDataManager",["Config","MetaDataRepository",function(l,i){var m=function(a){switch(a){case "shop":return "shop-"+l.GetSessionStoredValue("shopId");case "site":return "site-"+l.GetSessionStoredValue("siteId");case "blog":return "blog-"+l.GetSessionStoredValue("blogId");}return a;},n=function(c,d,e,f,g,h,j){if(!e)return g&&angular.element("head").find("meta[name=description]").attr("content",g),f?angular.element("title").html(f+" | "+h):angular.element("title").html(d+" | "+h),void (j&&angular.element("head").find("link[id=favicon]").attr("href",j));var k=m(c);i.getMetaDataByScopeTypeAndTypeId(k,d,e).then(function(b){angular.forEach(b.MetaProperties,function(a){a&&a.Name&&a.Value&&("PageTitle"===a.Name?angular.element("title").html(a.Value+" | "+h):"PageDescription"===a.Name&&angular.element("head").find("meta[name=description]").attr("content",a.Value));}),j&&angular.element("head").find("link[id=favicon]").attr("href",j);},function(a){e&&n(c,d,void 0,f,g,h,j);});};return {getScope:m,injectMetaDataInPage:n};}]),angular.module("msSiteAngularModules",["msTemplateLoader","msPageBuilderManager","msFilter","msAuthentication","msLogin","msMetaData"]),angular.module("msSiteAngular.pageViewer",["msResourceUrlManager","msPageBuilderManager","msTemplateLoader","ngRoute","msFilter","msMetaData"]).config(["$routeProvider",function(a){a.when("/:pageId?/:param1?/:param2?/:param3?/:param4?",{template:'<div id="ms-preview" ms-template-loader-directive="" images="images" page="page" theme-id="themeId" settings="settings"></div>',controller:"PageViewerController"});}]),angular.module("msSiteAngular.pageViewer").controller("PageViewerController",["ResourceUrlManager","$scope","$routeParams","PageBuilderManager","$location","$interval","Config","$window","$rootScope","$http","ProductService","BlogRestangular","ShopRestangular","ImplicitFlow","$auth","$sessionStorage",function(h,j,k,l,i,m,n,o,p,q,r,v,t,u,w,x){var y=k.pageId;if("implicitCallback"===y)return w.logout(),w.setRedirectTo("/"),void u.extractAccessTokenAndSiteId().then(function(a){a&&a.success?w.setTokensAndSiteId(a.accessToken,void 0,a.siteId):i.url("/");});var z=k.themeId;h.setRouteParams(k),j.settings=j.settings||{};var A=function(){l.getImages().then(function(a){j.images=a;});},C=function(){l.getSiteSettings().then(function(a){("localhost"===i.host()||i.host().indexOf(".clienthost.mrsite.web")>=0)&&(a.loginEnabled=!0),j.settings=a;});},B=function(){l.getCurrentTheme(y).then(function(g){j.themeId=z||g.id,l.setCurrentPage(y).then(function(f){l.getWebsiteData().then(function(a){p.siteData=a;}),f||l.getPages().then(function(b){var c=!1,d=o.location.href,e=p.siteData.jsRedirects;angular.forEach(e,function(a){d===a.OriginalUrl&&(o.location.href=a.NewUrl);}),angular.forEach(b,function(a){a&&a.ishomepage&&(i.path(a.url),c=!0);}),!c&&b[0]&&i.path(b[0].url);}),j.page=f||{},j.page.editable=!1;});});};p.$watch("siteData.extensions.shopid",function(a){if(x.put("shopId",a),p.$broadcast("auth:shopIdChange",{shopId:a}),a&&a.length>30&&p.siteData){for(var b=!1,c=0;p.siteData.pages[c];c++)"shop"===p.siteData.pages[c].type&&(b=!0);b&&m(r.getAll,1e3,1);}p.siteData&&(x.put("siteId",p.siteData.siteId),p.$broadcast("auth:siteIdChange",{siteId:p.siteData.siteId}));}),p.$watch("siteData.extensions.blogid",function(a){x.put("blogId",a),p.$broadcast("auth:blogIdChange",{blogId:a});}),C(),A(),B();}]),angular.module("msAngular.implicitCallback",["ngRoute"]).config(["$routeProvider",function(a){a.when("/implicitCallback",{templateUrl:"/presentation/implicitCallback/implicitCallback.html",controller:"implicitCallbackCtrl"});}]),angular.module("msAngular.implicitCallback").controller("implicitCallbackCtrl",["ImplicitFlow","$auth","$location",function(b,c,d){c.logout(),c.setRedirectTo("/"),b.extractAccessTokenAndSiteId().then(function(a){a&&a.success?c.setTokensAndSiteId(a.accessToken,void 0,a.siteId):d.url("/");});}]),angular.module("msSiteAngular",["ngSanitize","msSiteAngular.config","msSiteAngular.precache","msConfig","msLogin","msAuthentication","msSiteAngular.pageViewer","msAngular.implicitCallback","swxSessionStorage","angular-momentjs"]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0).hashPrefix("!"),a.otherwise({redirectTo:"/"});}]).run(["Config","ShopService","$rootScope","$location","$auth",function(c,d,e,f,g){c.GetEndPoint("siteApiEndpoint"),e.$on("restangular:needLogin",function(a){e.$broadcast("login:openPopup",{showCancel:!0});}),e.$on("$routeChangeStart",function(a,b){"/register"===f.path()&&"/sitecreation"===f.path()||(b.resolve=angular.extend(b.resolve||{},{__authenticating__:g.isLoggedIn}));}),d.SetAppCurrencyFromShopSettings();}]);